(this["webpackJsonp@tableplus/diagram"]=this["webpackJsonp@tableplus/diagram"]||[]).push([[0],{116:function(e,t,n){e.exports={container:"body_container__3oC6s",header:"body_header__jV-GI"}},117:function(e,t,n){e.exports={container:"source_container__3TgWW","slide-in":"source_slide-in__P2Ug9",dragging:"source_dragging__1rxAg",button:"source_button__2cu3w"}},118:function(e,t,n){e.exports={container:"row_container__2yTZp",over:"row_over__2gC30"}},119:function(e,t,n){e.exports={container:"name_container__1o8SY",view:"name_view__15GrF"}},12:function(e,t,n){e.exports={container:"edge_container__1EyW3",from:"edge_from__1Ovs9",to:"edge_to__3E3uJ",path:"edge_path__x4S4v",dot:"edge_dot__2KuhC",selected:"edge_selected__1Gpep",hitarea:"edge_hitarea__3Airq"}},120:function(e,t,n){e.exports={container:"canvas_container__3Y18v",grid:"canvas_grid__nkChd"}},123:function(e,t,n){e.exports={container:"header_container__-KQI5"}},124:function(e,t,n){e.exports={container:"progress_container__1kfqj",body:"progress_body__2EtDz"}},125:function(e,t,n){e.exports={container:"footer_container__3MvUg",logo:"footer_logo__3qLuS"}},195:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://diagramplus.com/diagram-schema.json","title":"TablePlus Diagram","description":"JSON schema for Diagram by TablePlus (https://diagramplus.com/)","type":"object","definitions":{"column":{"type":"object","properties":{"id":{"type":"string"},"name":{"type":"string"},"type":{"type":"string"}},"additionalProperties":false,"required":["id","type","name"]},"row":{"type":"object","properties":{"id":{"type":"string"}},"additionalProperties":{"type":"string"},"required":["id"]},"ref-side":{"type":"object","properties":{"name":{"type":"string"},"schema":{"type":"string"},"rows":{"type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["name","rows"]},"ref":{"type":"object","properties":{"from":{"$ref":"#/definitions/ref-side"},"to":{"$ref":"#/definitions/ref-side"}},"additionalProperties":false,"required":["from","to"]},"item":{"type":"object","properties":{"id":{"type":"string"},"name":{"type":"string"},"schema":{"type":"string"},"rows":{"type":"array","items":{"$ref":"#/definitions/row"}}},"additionalProperties":false,"required":["id","name","rows"]}},"properties":{"columns":{"type":"array","items":{"$ref":"#/definitions/column"}},"schema":{"type":"string"},"items":{"type":"array","items":{"$ref":"#/definitions/item"}},"refs":{"type":"array","items":{"$ref":"#/definitions/ref"}},"$schema":{"type":"string"}},"additionalProperties":false,"required":["schema","columns","items","refs"]}')},198:function(e,t,n){e.exports={container:"active_container__3joLV","react-draggable-dragging":"active_react-draggable-dragging__1JdPr"}},200:function(e,t,n){e.exports={container:"add_container__2lSlZ","slide-in":"add_slide-in__2Hk9K"}},201:function(e,t,n){e.exports={container:"boolean_container__1bqLB"}},202:function(e,t,n){e.exports={right:"field_right__3YAJ4"}},203:function(e,t,n){e.exports={container:"remove_container__Ts2Bx","slide-in":"remove_slide-in__3caLT"}},204:function(e,t,n){e.exports={container:"remove_container__2HEZR","win-background":"remove_win-background__WJQ6a"}},205:function(e,t,n){e.exports={container:"inactive_container__2xyR0"}},206:function(e,t,n){e.exports={container:"edges_container__2FGMc"}},208:function(e,t,n){e.exports={container:"layout_container__SVyb1"}},209:function(e,t,n){e.exports={container:"mac_container__YDixB",weak:"mac_weak__3A9TF"}},219:function(e,t,n){e.exports=n(445)},442:function(e,t,n){},444:function(e,t,n){},445:function(e,t,n){"use strict";n.r(t),n.d(t,"storage",(function(){return zr}));var a=n(51),r=n(7),i={},o=[],c=function(e){var t=null,n=[];i[e]=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];if(null!==t)return o.push(["Execute",a]),t.apply(void 0,a);o.push(["Pending",a]),n.push(a)};return function(e){for(t=e;n.length>0;){var a=n.shift();o.push(["Execute pending item",a]),t.apply(void 0,Object(r.a)(a))}}};window.Diagram=i,window.Logger=o;var s,l,u,d=n(1),f=n(4),m=n(192),p=n(0),v=n.n(p),h=n(449),g=n(5),b=n(52),w=n.n(b),E=function(e){if(!e.isDragging())return null;if("row"!==e.getItemType())return null;var t=e.getClientOffset(),n=e.getItem();return null===n||null===t?null:{item:n,top:t.y,left:t.x}},y=v.a.memo((function(e){var t=e.top,n=e.left;return v.a.createElement("div",{style:{color:"var(--accent-2)"}},v.a.createElement("div",{className:w.a.icon,style:{top:t-8,left:n-8}},v.a.createElement(d.h,{path:g.a.locate,size:16})))})),_=v.a.memo((function(e){var t=Object(h.a)(E),n=v.a.useRef(null),a=null===t||void 0===t?void 0:t.item.elementRef,r=e.viewportRef;v.a.useEffect((function(){n.current=void 0===a?null:function(e,t){var n=e.current;if(null===n)throw Error("Viewport is not defined");var a=t.current;if(null===a)throw Error("Source drag is not defined");var r=a.getBoundingClientRect(),i=[r.top+r.height/2,r.left+r.width/2];return{top:i[0],left:i[1],scrollTop:n.scrollTop,scrollLeft:n.scrollLeft}}(r,a)}),[r,a]);var i=n.current;if(null===t||null===i)return null;var o=e.viewportRef.current;if(null===o)throw Error("viewport is not defined");var c=o.scrollLeft-i.scrollLeft,s=o.scrollTop-i.scrollTop;return v.a.createElement("div",{className:w.a.container},v.a.createElement("svg",{className:w.a.svg},v.a.createElement("line",{className:w.a.line,x1:i.left-c,y1:i.top-s,x2:t.left,y2:t.top})),v.a.createElement(y,{top:t.top,left:t.left}))})),x=function(e,t){var n=e.get(t.table);if(!n)throw Error('Table Ids "'.concat(t.table,'" not found'));var a=t.rows.map((function(e){var t=n.rows.get(e);if(!t)throw Error('Row id "'.concat(e,'" not found'));return t})),r=n.table;return{name:r.name,schema:r.schema,rows:a}},j=function(e){var t=e.columns.map((function(e){return e.value})),n=e.tables.map((function(e){var t=e.value.rows.map((function(e){return e.value})),n=e.value;return{id:n.id,name:n.name,schema:n.schema,rows:t}})),a=function(e){var t=new Map;return e.forEach((function(e){var n=new Map;e.value.rows.forEach((function(e){n.set(e.id,e.value.id)}));var a={name:e.value.name,schema:e.value.schema};t.set(e.id,{table:a,rows:n})})),t}(e.tables);return{columns:t,items:n,refs:e.refs.map((function(e){return{from:x(a,e.from),to:x(a,e.to)}})),schema:e.schema}},I=c("importDiagram"),S=c("importDiagramJSON"),O=c("importDiagramObject"),z=c("importDiagramBase64"),T=new TextDecoder,D=function(e,t){v.a.useEffect((function(){I((function(e){t({type:"parse-json",payload:{text:e,isAppend:!1}})})),S((function(e){t({type:"parse-json",payload:{text:e,isAppend:!1}})})),O((function(e){var n=JSON.stringify(e);t({type:"parse-json",payload:{text:n,isAppend:!1}})})),z((function(e){var n=Uint8Array.from(atob(e),(function(e){return e.charCodeAt(0)})),a=T.decode(n);t({type:"parse-json",payload:{text:a,isAppend:!1}})}))}),[t]),v.a.useEffect((function(){var t;t=function(){return JSON.stringify(j(e))},i["exportDiagram"]=t}),[e])},M=n(2),k=function(e){return"table . ".concat(e)},R=function(e){var t=document.getElementById(k(e));if(t instanceof HTMLDivElement)return t;throw Error("Element is not HTMLDivElement")},L=function(e,t){return{width:224,height:24*(t?e.value.rows.length:Math.min(e.value.rows.length,51))+64}},N=n(114),A=n.n(N),V=function(e){return 8*Math.round(e/8)},F=function(e){var t,n,a,r=new A.a.graphlib.Graph({multigraph:!0});return r.setGraph({rankdir:"LR",nodesep:96,ranksep:96,marginx:48,marginy:48}),r.setDefaultEdgeLabel((function(){return{}})),e.tables.forEach((function(e){var t=function(e){try{var t=R(e.id);if(t.dataset.name!==e.value.name)throw Error("Outdated table from previous diagram");return{width:t.clientWidth,height:t.clientHeight}}catch(n){return L(e)}}(e),n=t.width,a=t.height;r.setNode(e.id.toString(),{label:"",width:n,height:a})})),e.refs.forEach((function(e){r.setEdge(e.from.table.toString(),e.to.table.toString())})),A.a.layout(r),{tables:e.tables.map((function(e){var t=r.node(e.id.toString()),n={top:0,left:0};return n.top=V(t.y-t.height/2),n.left=V(t.x-t.width/2),Object(M.a)(Object(M.a)({},e),{},{position:n})})),refs:e.refs,size:{width:(a=null!==(t=r.graph().width)&&void 0!==t?t:-1,320*Math.ceil(a/320)),height:V(null!==(n=r.graph().height)&&void 0!==n?n:-1)}}},P=function(e){return e.height*e.width},q=function(e){var t=e.map((function(e){return{id:e.tables[0].id,width:e.size.width,height:e.size.height}})),n=function(e){var t=e.reduce((function(e,t){return e>t.width?e:t.width}),-1/0),n=e.reduce((function(e,t){return e+P(t)}),0),a=2*Math.sqrt(n/2),r=Math.max(a,t);return Math.ceil(r/320)}(t),a=Array(n).fill(0),r=new Map,i=function(e){return a.map((function(t,n){return{leftIndex:n,top:function(e,t){if(e+t>a.length)return 1/0;for(var n=-1/0,r=0;r<t;r++){var i=a[e+r];n=Math.max(i,n)}return n}(n,e)}})).reduce((function(e,t){return t.top<e.top?t:e}))};return t.sort((function(e,t){return P(t)-P(e)})).forEach((function(e){for(var t=e.width/320,n=i(t),o=n.top+e.height,c=0;c<t;c++)a[n.leftIndex+c]=o;r.set(e.id,{left:320*n.leftIndex,top:n.top})})),r},H=function(e){var t,n,a=e.diagrams,r=e.masonry,i=0,o=0;a.forEach((function(e){var t=r.get(e.tables[0].id);if(void 0===t)throw Error("position is undefined");var n=t.left+e.size.width;i=Math.max(i,n);var a=t.top+e.size.height;o=Math.max(o,a)}));var c=[i+96,o+96];i=c[0],o=c[1];var s=null!==(t=null===(n=document.getElementById("canvas"))||void 0===n?void 0:n.parentElement)&&void 0!==t?t:null;return null!==s&&(i=Math.max(s.clientWidth,i),o=Math.max(s.clientHeight,o)),{width:i,height:o}},C=function(e){var t=[];if(e.diagrams.forEach((function(n){var a=e.masonry.get(n.tables[0].id);if(void 0===a)throw Error("translate is undefined");n.tables.forEach((function(e){var n={top:a.top+e.position.top+48,left:a.left+e.position.left+48};t.push(Object(M.a)(Object(M.a)({},e),{},{position:n}))}))})),t.length===e.originalDiagram.tables.length)return t;throw Error("new tables and old tables have different length")},B=function(e){var t=[],n=new Map,a=new Map;e.tables.forEach((function(e){a.set(e.id,e)}));var r=new Map;return e.refs.forEach((function(e){var t,n,a=[e.from.table,e.to.table],i=a[0],o=a[1];r.set(i,(null!==(t=r.get(i))&&void 0!==t?t:[]).concat(e)),r.set(o,(null!==(n=r.get(o))&&void 0!==n?n:[]).concat(e))})),e.tables.forEach((function(e){if(!0!==n.get(e.id)){var i={tables:[],refs:[],size:{width:0,height:0}};!function e(t,n){var a,r,i=t.diagram,o=t.done,c=t.refMap,s=t.tableMap;!0!==o.get(n.id)&&(i.tables.push(n),null===(a=c.get(n.id))||void 0===a||a.forEach((function(e){i.refs.includes(e)||i.refs.push(e)})),o.set(n.id,!0),(null!==(r=c.get(n.id))&&void 0!==r?r:[]).forEach((function(n){var a=s.get(n.from.table),r=s.get(n.to.table);if(void 0===a||void 0===r)throw Error('"fromTable" or "toTable" is undefined');e(t,a),e(t,r)})))}({diagram:i,done:n,tableMap:a,refMap:r},e),t.push(i)}})),t.forEach((function(e){F(e)})),t},U=function(e){var t=B(e);t=t.map(F);var n,a=q(t);return{columns:(n={originalDiagram:e,masonry:a,diagrams:t}).originalDiagram.columns,tables:C(n),refs:n.originalDiagram.refs,size:H(n),schema:n.originalDiagram.schema}},J=function(e,t,n){var a,r=null!==(a=n.schema)&&void 0!==a?a:e,i=t.get("".concat(r," . ").concat(n.name));if(void 0===i)throw Error('Table Ids "'.concat(n.name,'" not found'));var o=n.rows.map((function(e){var t=i.rows.get(e);if(void 0===t)throw Error('Row id "'.concat(e,'" not found'));return t}));return{table:i.table,rows:o}},W=function(e,t){return{value:{rows:e.rows.map((function(e,t){return{id:t,value:e}})),name:e.name,id:e.id,schema:e.schema},position:{top:0,left:0},id:t}},K=function(e,t){return{id:t,value:e}},G=function(e){var t=e.schema,n=e.columns.map(K),a=e.items.map(W),r=function(e,t){var n=new Map;return t.forEach((function(t){var a,r=new Map;t.value.rows.forEach((function(e){r.set(e.value.id,e.id)}));var i=null!==(a=t.value.schema)&&void 0!==a?a:e,o="".concat(i," . ").concat(t.value.name);n.set(o,{table:t.id,rows:r})})),n}(t,a),i=e.refs.map(function(e,t){return function(n,a){return{id:a,from:J(e,t,n.from),to:J(e,t,n.to)}}}(t,r));return U({tables:a,refs:i,columns:n,size:{width:0,height:0},schema:t})},Y=n(194),Q=n.n(Y),Z=n(195),$=new Q.a({strictDefaults:!0,strictKeywords:!0}),X=$.compile(Z),ee=n(75),te=n(196),ne=n(216),ae=n(218),re=function(e){Object(te.a)(n,e);var t=Object(ne.a)(n);function n(e){var a;return Object(ee.a)(this,n),(a=t.call(this,e)).name="SemanticError",a}return n}(Object(ae.a)(Error)),ie=function(e,t){return new re("".concat(e," has an invalid reference to ").concat(t))},oe=function(e,t,n){var a=e.items.find((function(n){return n.name===t.name&&function(e,t,n){var a,r;return(null!==(a=t.schema)&&void 0!==a?a:e.schema)===(null!==(r=n.schema)&&void 0!==r?r:e.schema)}(e,t,n)}));if(!a)throw ie("Ref #".concat(n),'table "'.concat(t.name,'"'));t.rows.forEach((function(e){if(!a.rows.some((function(t){return t.id===e})))throw ie("Ref #".concat(n,".rows"),'row "'.concat(e,'"'))}))},ce=function(e){!function(e){var t=e.items.map((function(e){return e.id}));if(new Set(t).size!==t.length)throw Error("items.ids are not unique")}(e),e.items.forEach((function(e){!function(e){var t=e.rows.map((function(e){return e.id}));if(new Set(t).size!==t.length)throw Error("tables.".concat(e.id,".rows.ids are not unique"))}(e)})),e.refs.forEach((function(t,n){oe(e,t.from,n),oe(e,t.to,n)}))},se=function(e,t){for(var n=new Set(e),a=1,r=t(a);n.has(r);)r=t(a+=1);return r},le=function(e,t){return se(e,(function(e){return 1===e?t:"".concat(t,"_").concat(e)}))},ue=function(e){return se(e,(function(e){return e}))},de=function(e){var t=e.map((function(e){return e.value.id}));return{id:ue(e.map((function(e){return e.id}))),value:{id:le(t,"column")}}},fe=function(e,t){var n=function(e,t){return function(t){if(t.id!==e.tableId)return t;var n=de(t.value.rows),a=t.value.rows.concat(n);return Object(M.a)(Object(M.a)({},t),{},{value:Object(M.a)(Object(M.a)({},t.value),{},{rows:a})})}}(t,e.columns);return Object(M.a)(Object(M.a)({},e),{},{tables:e.tables.map(n)})},me=function(e,t){return Math.max(t.position.left,e)},pe=function(e){return{top:96,left:e.reduce(me,0)+320}},ve=function(e,t){var n=Math.max(e.width,t.left+320);return n===e.width?e:Object(M.a)(Object(M.a)({},e),{},{width:n})},he=function(e,t){try{var n=JSON.parse(t.text);!function(e){if(X(e))return!0;var t=X.errors;throw SyntaxError($.errorsText(t,{dataVar:"diagram"}))}(n),ce(n);var a=G(n);return t.isAppend?function(e,t){if(e.columns.length!==t.columns.length)throw Error("Cannot merge diagrams with different columns");var n=e.tables.map((function(e){return e.id})),a=pe(e.tables);a.top=a.top-96,a.left=a.left-96;var i=Object(r.a)(e.tables);t.tables.forEach((function(e){var t=ue(n);n.push(t);var r={top:e.position.top+a.top,left:e.position.left+a.left};i.push(Object(M.a)(Object(M.a)({},e),{},{id:t,position:r}))}));var o=a.left+t.size.width,c=Object(M.a)(Object(M.a)({},e.size),{},{width:o});return Object(M.a)(Object(M.a)({},e),{},{tables:i,size:c})}(e,a):a}catch(i){return window.alert(function(e){if(!(e instanceof Error))throw e;return["There was an error while parsing your json:\n","".concat(e.name,": ").concat(e.message)].join(" ")}(i)),e}},ge=function(e,t){var n=e.refs.filter((function(e){return e.id!==t.id}));return Object(M.a)(Object(M.a)({},e),{},{refs:n})},be=function(e,t){switch(t.type){case"add-ref":return function(e,t){var n=e.refs.filter((function(e){return!function(e,t){return e.from.table===t.from.table&&e.from.rows.some((function(e){return t.from.rows.includes(e)}))}(e,t)})),a=e.refs.map((function(e){return e.id})),r=Object(M.a)(Object(M.a)({},t),{},{id:ue(a)});return n.push(r),Object(M.a)(Object(M.a)({},e),{},{refs:n})}(e,t.payload);case"remove-ref":return ge(e,t.payload);case"remove-multiple-refs":return function(e,t){var n=e;return t.ids.forEach((function(e){n=ge(n,{id:e})})),n}(e,t.payload);default:return e}},we=function(e,t){return t.table===e.tableId&&t.rows.includes(e.rowId)},Ee=function(e,t){var n=e.tables.map(function(e){return function(t){if(t.id!==e.tableId)return t;var n=t.value.rows.filter((function(t){return t.id!==e.rowId}));return Object(M.a)(Object(M.a)({},t),{},{value:Object(M.a)(Object(M.a)({},t.value),{},{rows:n})})}}(t)),a=e.refs.filter((function(e){return!function(e,t){return we(e,t.from)||we(e,t.to)}(t,e)}));return a.length===e.refs.length&&(a=e.refs),Object(M.a)(Object(M.a)({},e),{},{tables:n,refs:a})},ye=function(e){return function(t){if(t.id!==e.tableId)return t;var n=t.value.rows.map(function(e){return function(t){if(t.id!==e.rowId)return t;var n=Object(M.a)({},t.value);return n[e.property]=e.value,Object(M.a)(Object(M.a)({},t),{},{value:n})}}(e));return Object(M.a)(Object(M.a)({},t),{},{value:Object(M.a)(Object(M.a)({},t.value),{},{rows:n})})}},_e=function(e,t){if(function(e,t){var n,a=t.tableId,r=t.rowId,i=t.property,o=t.value,c=null===(n=e.tables.find((function(e){return e.id===a})))||void 0===n?void 0:n.value.rows.find((function(e){return e.id===r}));if(!c)throw Error('Row "'.concat(a,".").concat(r,'" not found'));return c.value[i]===o}(e,t))return e;var n=e.tables.map(ye(t));return Object(M.a)(Object(M.a)({},e),{},{tables:n})},xe=function(e,t){var n=e.tables.filter((function(e){return e.id!==t.id})),a=e.refs.filter((function(e){return!function(e,t){return t.from.table===e.id||t.to.table===e.id}(t,e)}));return Object(M.a)(Object(M.a)({},e),{},{tables:n,refs:a})},je=function(e,t){var n=e.tables.map(function(e){return function(t){return t.id!==e.id?t:Object(M.a)(Object(M.a)({},t),{},{value:Object(M.a)(Object(M.a)({},t.value),{},{name:e.name})})}}(t));return Object(M.a)(Object(M.a)({},e),{},{tables:n})},Ie=function(e,t){switch(t.type){case"add-table":return function(e,t){var n,a=e.tables.map((function(e){return e.value.id})),r=le(a,"table"),i=de([]),o={id:null!==(n=t.id)&&void 0!==n?n:ue(e.tables.map((function(e){return e.id}))),value:{name:r,id:r,schema:"new",rows:[i]},position:pe(e.tables)};return Object(M.a)(Object(M.a)({},e),{},{tables:e.tables.concat(o),size:ve(e.size,o.position)})}(e,t.payload);case"remove-table":return xe(e,t.payload);case"remove-multiple-tables":return function(e,t){var n=e;return t.ids.forEach((function(e){n=xe(n,{id:e})})),n}(e,t.payload);case"update-table-name":return je(e,t.payload);case"set-table-position":return function(e,t){return Object(M.a)(Object(M.a)({},e),{},{tables:e.tables.map((function(e){return e.id!==t.id?e:Object(M.a)(Object(M.a)({},e),{},{position:t.position})}))})}(e,t.payload);default:return e}},Se=["localhost","diagramplus.com"],Oe=Se.includes(window.location.hostname)||window.location.hostname.startsWith("192.168.1")?"web":navigator.platform.toLowerCase().includes("mac")?"mac":"web",ze=v.a.createContext(Oe),Te=function(){return v.a.useContext(ze)},De=c("setPlatform"),Me=G({columns:[{id:"0",name:"name",type:"string"},{id:"1",name:"type",type:"string"},{id:"2",name:"nullable",type:"boolean"}],schema:"main",items:[],refs:[]}),ke=G({columns:[{id:"0",name:"name",type:"string"},{id:"1",name:"type",type:"string"},{id:"2",name:"nullable",type:"boolean"}],schema:"primary",items:[{id:"employees",name:"employees",rows:[{id:"emp_no",name:"emp_no",type:"int(11)",nullable:"FALSE"},{id:"birth_date",name:"birth_date",type:"date",nullable:"TRUE"},{id:"first_name",name:"first_name",type:"varchar(14)",nullable:"TRUE"},{id:"last_name",name:"last_name",type:"varchar(16)",nullable:"TRUE"}]},{id:"departments",name:"departments",schema:"secondary",rows:[{id:"dept_no",name:"dept_no",type:"char(4)",nullable:"FALSE"},{id:"dept_name",name:"dept_name",type:"varchar(40)",nullable:"FALSE"}]},{id:"dept_emp",name:"dept_emp",rows:[{id:"dept_no",name:"dept_no",type:"char(4)",nullable:"FALSE"},{id:"emp_no",name:"emp_no",type:"int(11)",nullable:"FALSE"},{id:"from_date",name:"from_date",type:"date",nullable:"TRUE"},{id:"to_date",name:"to_date",type:"date",nullable:"TRUE"}]}],refs:[{from:{name:"dept_emp",schema:"primary",rows:["dept_no"]},to:{name:"departments",schema:"secondary",rows:["dept_no"]}},{from:{name:"dept_emp",rows:["emp_no"]},to:{name:"employees",rows:["emp_no"]}}]}),Re=["There was an error while parsing the locally saved diagram. The app will ","now fallback to a sample diagram.\n\n","Your previous diagram is still available in your localStorage under the ",'key "'.concat("diagram",'-invalid". Please contact us if you need help '),"retrieving it."].join(""),Le=function(){var e=v.a.useContext(a.b);if(null===e)throw Error("Storage context not found");var t=Te();return v.a.useMemo((function(){return"web"===t?{get:function(){return function(e){var t=e.getItem("diagram");if(null===t)return ke;try{return JSON.parse(t)}catch(n){return e.setItem("".concat("diagram","-invalid"),t),window.alert(Re),ke}}(e)},set:function(t){return function(e,t){e.setItem("diagram",JSON.stringify(t))}(e,t)}}:{get:function(){return Me},set:function(){}}}),[e,t])},Ne=function(e){var t=e.history,n=e.dispatch;p.useEffect((function(){var e=function(e){return function(t){if((t.ctrlKey||t.metaKey)&&!(t.target instanceof HTMLInputElement)&&!(t.target instanceof HTMLTextAreaElement))switch(t.key){case"z":if(0===e.history.past.length)return;return e.dispatch({type:"undo"});case"Z":case"y":if(0===e.history.future.length)return;return e.dispatch({type:"redo"})}}}({history:t,dispatch:n});return document.addEventListener("keyup",e),function(){return document.removeEventListener("keyup",e)}}),[t,n])},Ae=n(115),Ve=(s=function(e,t){var n=e;return n=function(e,t){switch(t.type){case"add-row":return fe(e,t.payload);case"remove-row":return Ee(e,t.payload);case"update-row":return _e(e,t.payload);default:return e}}(n=Ie(n,t),t),n=function(e,t){switch(t.type){case"set-layout":switch(t.payload.type){case"auto":return U(e);default:return e}default:return e}}(n=function(e,t){switch(t.type){case"parse-json":return he(e,t.payload);default:return e}}(n=be(n,t),t),t)},function(e,t){switch(t.type){case"undo":var n=Object(Ae.a)(e.past),a=n[0];return{past:n.slice(1),present:a,future:[e.present].concat(Object(r.a)(e.future))};case"redo":var i=Object(Ae.a)(e.future),o=i[0],c=i.slice(1);return{past:[e.present].concat(Object(r.a)(e.past)),present:o,future:c};default:var l=s(e.present,t),u=[e.present].concat(Object(r.a)(e.past));return{past:u=u.length<20?u:u.slice(0,20),present:l,future:[]}}}),Fe=n(197),Pe=n.n(Fe),qe=n(198),He=n.n(qe),Ce=n(12),Be=n.n(Ce),Ue=function(e){return"edge . ".concat(e)},Je=function(e,t,n){return"edge . ".concat(e," . ").concat(t," . ").concat(null!==n&&void 0!==n?n:0)},We=function(e,t,n){var a=Je(e,t,n),r=document.getElementById(a);if(r instanceof SVGElement)return r;throw Error("Element is not SVGElement")},Ke=function(e){return{cx:e.x.toString(),cy:e.y.toString()}},Ge=function(e){return p.createElement(p.Fragment,null,e.points.inners.map((function(t,n){return p.createElement("circle",Object.assign({key:n,id:Je(e.edge.id,"from",n),className:Be.a.from},Ke(t),{r:"4"}))})))},Ye=function(e,t){return"row . ".concat(e," . ").concat(t)},Qe=function(e,t){var n=t.top,a=t.left,r=R(e.table);return e.rows.map((function(t){var i=function(e,t){var n=document.getElementById(Ye(e,t));return n instanceof HTMLDivElement?n:null}(e.table,t);if(null!==i){var o=function(e,t){var n=0,a=0,r=e;do{var i=[n+r.offsetTop,a+r.offsetLeft];n=i[0],a=i[1];var o=r.offsetParent;if(!(o instanceof HTMLElement))break;r=o}while(r!==t);return{top:n,left:a}}(i,r),c=o.top,s=o.left,l=c+n+i.clientHeight/2,u=s+a;return{top:l,left:u,right:u+i.clientWidth}}return{top:n+r.clientHeight/2,left:a,right:a+r.clientWidth}}))},Ze=n(199),$e=null!==(l=window.ResizeObserver)&&void 0!==l?l:Ze.a,Xe={attributeFilter:["data-is-visible"]},et=function(e){if(0===e.length)return"";if(1===e.length)throw Error("points.length must be 0 or 2+");return["M".concat(e[0].x,",").concat(e[0].y)].concat(Object(r.a)(e.slice(1).map((function(e){return"L".concat(e.x,",").concat(e.y)})))).join(" ")},tt=function(e){return e.reduce((function(t,n,a){if(0===a)return 0;var r=n.x,i=n.y,o=e[a-1],c=o.x,s=o.y;return t+Math.sqrt(Math.pow(r-c,2)+Math.pow(i-s,2))}),0)},nt=function(e){return function(t){return{x:"left"===e?t.left:t.right,y:t.top}}},at=function(e,t){return{x:e[0].x+32*("right"===t?1:-1),y:e[0].y}},rt=function(e){var t=e.edgesMids,n=e.edge,a=function(e){var t=[e.from[0],e.to[0]],n=t[0],a=t[1],r="right",i="right";n.right<=a.left-96?(r="right",i="left"):n.left>=a.right+96&&(r="left",i="right");var o=e.from.map(nt(r)),c=at(o,r),s=e.to.map(nt(i));return{from:{inners:o,side:r,outer:c},to:{inners:s,side:i,outer:at(s,i)}}}(e.boxes),r=a.from,i=a.to,o=function(e){var t=e.from,n=e.to;if(t.side!==n.side){var a=(t.outer.x+n.outer.x)/2;return[{x:a,y:t.outer.y},{x:a,y:n.outer.y}]}if(t.side===n.side){var r=Math.max(t.outer.x,n.outer.x);return[{x:r,y:t.outer.y},{x:r,y:n.outer.y}]}throw Error("never")}({from:r,to:i});return void 0!==t&&(o=function(e){var t,n=e.edgesMids,a=n.edgesMap,r=n.usedMids,i=e.midPoints[0].x,o=null===(t=a.get(e.edge.id))||void 0===t?void 0:t.mid;if(o===i)return e.midPoints;var c=r;if(void 0!==o&&c.delete(o),c.has(i)){var s=function(e,t){for(var n=t,a=1;e.has(n);)n=t+8*a,a=a>0?-a:1-a;return n}(c,i);return a.set(e.edge.id,{detail:e.edge,mid:s}),c.add(s),e.midPoints.map((function(e){return Object(M.a)(Object(M.a)({},e),{},{x:s})}))}return a.set(e.edge.id,{detail:e.edge,mid:i}),c.add(i),e.midPoints}({edgesMids:t,edge:n,midPoints:o})),{from:r,mid:o,to:i}},it=function(e){var t,n=function(e){return{from:Qe(e.edge.from,e.fromTable.position),to:Qe(e.edge.to,e.toTable.position)}}(e),a=null===(t=e.edgesMids)||void 0===t?void 0:t.current,i=e.edge,o=rt({edgesMids:a,edge:i,boxes:n});return{points:o,path:function(e){var t=e.from,n=e.mid,a=e.to,i=[t.inners[0]].concat(Object(r.a)(n),[a.inners[0]]),o=t.inners.slice(1).flatMap((function(e){return[e,t.outer]})),c=a.inners.slice(1).flatMap((function(e){return[e,a.outer]}));return{main:et(i),length:tt(i),from:et(o),to:et(c)}}(o)}},ot=function(e){var t=e.edge,n=e.fromTable,a=e.toTable,r=e.edgesMids,i=function(e){var t=p.useState({}),n=Object(f.a)(t,2),a=n[0],r=n[1];return p.useLayoutEffect((function(){var t=R(e.from.table),n=R(e.to.table),a=function(){return r({})},i=new $e(function(e){return function(){e()}}(a));i.observe(t),i.observe(n);var o=new MutationObserver(function(e){return function(t){t.forEach((function(t){"attributes"===t.type&&"data-is-visible"===t.attributeName&&e()}))}}(a));return o.observe(t,Xe),o.observe(n,Xe),function(){o.disconnect(),i.disconnect()}}),[e]),a}(t),o=p.useState(null),c=Object(f.a)(o,2),s=c[0],l=c[1],u=p.useRef(0);return p.useLayoutEffect((function(){return window.clearTimeout(u.current),u.current=window.setTimeout((function(){var e=it({edge:t,fromTable:n,toTable:a,edgesMids:r});l(e)}),0),function(){return window.clearTimeout(u.current)}}),[t,n,a,r,i]),s},ct=function(e,t,n){return"left"===e?"rotate(180, ".concat(t,", ").concat(n,")"):""},st=function(e,t){var n=t.x,a=t.y;return{transform:ct(e,n,a),points:["".concat(n+9,",").concat(a-4),"".concat(n+9,",").concat(a+4),"".concat(n+1,",").concat(a)].join(" ")}},lt=function(e){return p.createElement(p.Fragment,null,e.points.inners.map((function(t,n){return p.createElement("polygon",Object.assign({key:n,className:Be.a.to,id:Je(e.edge.id,"to",n)},st(e.points.side,t)))})))},ut=function(e,t){Object.entries(e).forEach((function(e){var n=Object(f.a)(e,2),a=n[0],r=n[1];t.setAttribute(a,r)}))},dt=function(e){return function(t,n){var a={left:e.table.position.left+n.x,top:e.table.position.top+n.y},r=Object(M.a)(Object(M.a)({},e.table),{},{position:a});e.relatedEdges.forEach(function(e){return function(t){var n=t.edge,a=t.table,r=n.to.table===e.id?[a,e]:[e,a],i=Object(f.a)(r,2),o=i[0],c=i[1],s=it({edge:n,fromTable:o,toTable:c}),l=s.path,u=s.points;We(n.id,"path-main").setAttribute("d",l.main),u.from.inners.forEach((function(e,t){var a=We(n.id,"from",t),r=Ke(e);ut(r,a)})),u.to.inners.forEach((function(e,t){var a=We(n.id,"to",t),r=st(u.to.side,e);ut(r,a)}));try{We(n.id,"highlight").setAttribute("path","")}catch(d){}}}(r))}},ft=function(e){return 16*Math.round(e/16)},mt=function(e){return function(t,n){if(0!==n.x||0!==n.y){var a={left:ft(e.table.position.left+n.x),top:ft(e.table.position.top+n.y)};e.diagramDispatch({type:"set-table-position",payload:{id:e.table.id,position:a}})}}},pt=function(e,t){return e.filter((function(e){return e.type===t})).map((function(e){return e.value}))},vt=function(e){return{tables:new Set(pt(e,"table")),refs:new Set(pt(e,"ref"))}},ht=n(200),gt=n.n(ht),bt=function(e){return function(){var t={tableId:e.tableId};e.diagramDispatch({type:"add-row",payload:t})}},wt=function(e){return v.a.createElement("div",{className:gt.a.container},v.a.createElement(d.c,{onClick:bt(e),icon:g.a.add,size:d.c.size.small,style:d.c.style.flat,isFullWidth:!0},"Add"))},Et=n(116),yt=n.n(Et),_t=function(e,t){return t?e.previousElementSibling:e.nextElementSibling},xt=function(e,t){var n=e.closest(".table-row");if(null===n)throw Error(".table-row is null");for(var a=_t(n,t);null!==a;){if(a.classList.contains("table-row"))return a;a=_t(a,t)}return null},jt=function(e,t){if("first"===t){var n=e.querySelector(".row-control");if(null!==n)return n}else{var a=e.querySelectorAll(".row-control"),r=a["last"===t?a.length-1:t];if(void 0!==r)return r}throw Error(".table-row doesn't have .row-control")},It=function(e,t){switch(t){case"ArrowRight":case"ArrowLeft":var n="ArrowLeft"===t,a=_t(e,n);if(null!==a&&a.classList.contains("row-control"))return a;var i=xt(e,n);return null===i?null:jt(i,n?"last":"first");case"ArrowUp":case"ArrowDown":var o=xt(e,"ArrowUp"===t);if(null===o)return null;var c=function(e){var t=e.closest(".table-row");if(null===t)throw Error(".table-row is null");var n=t.querySelectorAll(".row-control"),a=Object(r.a)(n).indexOf(e);if(-1!==a)return a;throw Error("curr is not a child of parent")}(e);return jt(o,c)}return null},St=function(e){var t=e.target;if(t instanceof HTMLElement&&!(t instanceof HTMLInputElement)){var n=t.closest(".row-control");if(null!==n){e.preventDefault();var a=It(n,e.key);null!==a&&function(e){var t=e.querySelector("select,input,button,[tabindex]");if(t instanceof HTMLElement)return t.focus();throw Error("No focusable element under row-control")}(a)}}},Ot=function(e){switch(e.key){case"ArrowUp":case"ArrowRight":case"ArrowDown":case"ArrowLeft":return St(e)}},zt=n(84),Tt=n.n(zt),Dt=[d.q.secondary,d.r.weak,Tt.a.container,d.u.muted].join(" "),Mt=function(e,t){var n=[Tt.a.field,1===t?Tt.a.rightField:""].join(" ");return v.a.createElement("div",{key:e.id,className:n,children:e.value.name})},kt=function(e){return v.a.createElement("div",{className:Dt},v.a.createElement(d.g,{size:8}),v.a.createElement("div",{className:d.c.size.small.main},v.a.createElement(d.h,{path:g.a.blank,size:d.c.size.small.iconSize})),e.columns.slice(0,e.isExpand?void 0:2).map(Mt),v.a.createElement(d.c,{onClick:function(){return e.setIsExpand((function(e){return!e}))},style:d.c.style.flat,size:d.c.size.small,icon:(t=e.isExpand,t?g.a.doubleChevronLeft:g.a.doubleChevronRight)}),v.a.createElement(d.g,{size:8}));var t},Rt=n(451),Lt=n(452),Nt=n(190),At=n(117),Vt=n.n(At),Ft=function(e){var t=v.a.useRef(null),n=e.rowId,a=e.tableId,r=Object(Lt.a)({item:{type:"row",rowId:n,tableId:a,elementRef:t},begin:function(){return function(e){if(null!==e.edge){var t={id:e.edge.id};e.diagramDispatch({type:"remove-ref",payload:t})}}(e)},end:function(t,n){return function(e,t){var n=t.getDropResult();if(null!==n){var a={from:{table:e.tableId,rows:[e.rowId]},to:{table:n.tableId,rows:[n.rowId]}};e.diagramDispatch({type:"add-ref",payload:a})}}(e,n)},collect:function(t){return function(e,t){if(!1===t.isDragging())return!1;if("row"!==t.getItemType())return!1;var n=t.getItem(),a=n.tableId,r=n.rowId;return e.tableId===a&&e.rowId===r}(e,t)}}),i=Object(f.a)(r,3),o=i[0],c=i[1],s=i[2];v.a.useEffect((function(){s(Object(Nt.a)())}),[s]),v.a.useEffect((function(){c(t)}),[c]);var l=v.a.useState(!1),u=Object(f.a)(l,2),m=u[0],p=u[1],h=o||m||null!==e.edge,b=v.a.createElement(d.h,{path:h?g.a.selection:g.a.circle,size:d.c.size.small.iconSize});return v.a.createElement("div",{ref:t,className:Vt.a.container,onMouseEnter:function(){return p(!0)},onMouseLeave:function(){return p(!1)}},v.a.createElement("div",{className:[o?Vt.a.dragging:"",d.c.style.flat.main,d.c.size.small.main,"react-draggable-cancel"].join(" "),children:b}))},Pt=n(201),qt=n.n(Pt),Ht=["T","t","1","Y","y"],Ct=function(e){return p.createElement("div",{className:[qt.a.container].join(" ")},p.createElement(d.n,{value:(t=e.value,!!Ht.includes(t.charAt(0))),setValue:function(t){e.setValue(t?"TRUE":"FALSE")},options:[{value:!0,label:"TRUE"},{value:!1,label:"FALSE"}],style:d.n.style.flat,size:d.n.size.small}));var t},Bt=n(202),Ut=n.n(Bt),Jt={current:!1,timeout:0},Wt=n(53),Kt=n.n(Wt),Gt=function(e){return p.createElement("div",{className:Kt.a.edit},p.createElement(d.i,{key:e.value,defaultValue:e.value,style:d.i.style.flat,size:d.i.size.small,autoFocus:!0,onBlur:function(t){e.setValue(t.currentTarget.value),e.setIsEdit(!1)},onKeyDown:function(e){"Tab"===e.key&&(window.clearTimeout(Jt.timeout),Jt.current=!0,Jt.timeout=window.setTimeout((function(){Jt.current=!1}),500))},onKeyUp:function(t){"Enter"===t.key&&(e.setValue(t.currentTarget.value),e.setIsEdit(!1),function(e){window.setTimeout((function(){var t=e.viewRef.current;if(null===t)throw Error("View is null");t.focus()}),0)}(e))}}))},Yt=[Kt.a.view,d.s.always,d.i.size.small.main,"react-draggable-cancel","row-input-string-view"].join(" "),Qt=function(e){var t=e.value;return 0!==t.length?p.createElement("span",null,t):p.createElement("span",{className:Kt.a.empty},"<empty>")},Zt=function(e){return p.createElement("div",{tabIndex:0,children:p.createElement(Qt,{value:e.value}),className:Yt,onDoubleClick:function(){e.setIsEdit(!0)},onFocus:function(){Jt.current&&e.setIsEdit(!0)},onKeyUp:function(t){"Enter"===t.key&&e.setIsEdit(!0)},ref:e.viewRef})},$t=function(e){var t=p.useState(!1),n=Object(f.a)(t,2),a=n[0],r=n[1],i=p.useRef(null),o=Object(M.a)(Object(M.a)({},e),{},{isEdit:a,setIsEdit:r,viewRef:i});return p.createElement("div",{className:[Kt.a.container].join(" ")},a?p.createElement(Gt,o):p.createElement(Zt,o))},Xt=function(e){return function(t){var n=e.tableId,a=e.row,r=[e.column.value.name,a.id],i=r[0],o=r[1];if(t!==a.value[i]){var c={tableId:n,rowId:o,property:i,value:t};e.diagramDispatch({type:"update-row",payload:c})}}},en=function(e){var t;return v.a.createElement("div",{className:e.isRight?"".concat(Ut.a.right," ").concat(d.u.muted):""},function(e){var t=e.column.value.type;switch(t){case"boolean":return Ct;case"string":return $t;default:throw Error('Unknown column type "'.concat(t,'"'))}}(e)({value:null!==(t=e.row.value[e.column.value.name])&&void 0!==t?t:"",setValue:Xt(e)}))},tn=function(e){var t={tableId:e.tableId,rowId:e.rowId};e.diagramDispatch({type:"remove-row",payload:t})},nn=n(203),an=n.n(nn),rn=function(e){return function(){var t={tableId:e.tableId,rowId:e.row.id};e.diagramDispatch({type:"remove-row",payload:t})}},on=function(e){return v.a.createElement("div",{className:[an.a.container].join(" ")},v.a.createElement(d.c,{onClick:rn(e),style:d.c.style.flat,size:d.c.size.small,icon:g.a.remove}))},cn=n(118),sn=n.n(cn),ln=v.a.memo((function(e){e.tableId,e.row.id,e.row.value.id;var t,n=(t={tableId:e.tableId,rowId:e.row.id},Object(Rt.a)({accept:"row",drop:function(){return{tableId:t.tableId,rowId:t.rowId}},collect:function(e){return e.isOver()}})),a=Object(f.a)(n,2),r=a[0],i=a[1];return v.a.createElement("div",Object.assign({},function(e){var t=v.a.useRef(!1);return{onKeyDown:function(e){["Delete","Backspace"].includes(e.key)&&e.target instanceof HTMLInputElement&&(t.current=""===e.target.value)},onKeyUp:function(n){["Delete","Backspace"].includes(n.key)&&(n.target instanceof HTMLInputElement?t.current&&tn(e):tn(e))}}}({diagramDispatch:e.diagramDispatch,tableId:e.tableId,rowId:e.row.id}),{className:"".concat(sn.a.container," ").concat(r?sn.a.over:""),ref:i}),v.a.createElement(d.g,{size:8}),e.isEdit&&v.a.createElement("div",{className:"row-control"},v.a.createElement(on,{tableId:e.tableId,row:e.row,diagramDispatch:e.diagramDispatch})),e.columns.slice(0,e.isExpand?void 0:2).map((function(t,n){return v.a.createElement("div",{className:"row-control",key:t.id},v.a.createElement(en,{tableId:e.tableId,row:e.row,column:t,diagramDispatch:e.diagramDispatch,isRight:1===n}))})),e.isEdit&&v.a.createElement(Ft,{tableId:e.tableId,rowId:e.row.id,diagramDispatch:e.diagramDispatch,edge:e.edge}),v.a.createElement(d.g,{size:8}))})),un=function(e,t){return function(n){var a;return p.createElement("div",{className:"table-row",id:Ye(e.tableId,n.id),key:n.id},p.createElement(ln,{row:n,edge:null!==(a=t.get(n.id))&&void 0!==a?a:null,tableId:e.tableId,isEdit:e.isTableEdit,isExpand:e.isTableExpand,columns:e.columns,diagramDispatch:e.diagramDispatch}))}},dn=function(e){return p.createElement(d.a,{color:"secondary"},p.createElement(d.b,{color:"weak"}),p.createElement("div",{style:{marginTop:-1}}),p.createElement(d.c,{style:d.c.style.flat,size:d.c.size.small,isFullWidth:!0,onClick:function(){return e.show()},children:"".concat(e.count," columns hidden")}),p.createElement("div",{style:{marginTop:-1}}),p.createElement(d.b,{color:"weak"}))},fn=function(e){return p.createElement(d.c,{style:d.c.style.flat,size:d.c.size.small,isFullWidth:!0,onClick:function(){return e.hide()},children:"Hide columns"})},mn=function(e){var t=p.useState(!1),n=Object(f.a)(t,2),a=n[0],r=n[1],i=function(e,t){var n=new Map;return t.forEach((function(t){t.edge.from.table===e&&t.edge.from.rows.forEach((function(e){n.set(e,t.edge)}))})),n}(e.tableId,e.relatedEdges),o=function(e,t){var n=50-t.size,a=[],r=[];return e.forEach((function(e){n>0||t.has(e.id)?(0!==r.length&&a.push(r),r=[],a.push(e),n-=1):r.push(e)})),0!==r.length&&a.push(r),a}(e.rows,i),c=function(e,t,n,a){return function(r,i){return Array.isArray(r)?n?p.createElement(p.Fragment,{key:r[0].id},r.map(un(e,t))):p.createElement(dn,{key:"hidden-".concat(i),count:r.length,show:function(){return a(!0)}}):un(e,t)(r)}}(e,i,a,r),s=o.length!==e.rows.length;return p.useEffect((function(){s&&r(e.isRowsExpand)}),[e.isRowsExpand,s]),p.createElement(p.Fragment,null,o.map(c),a&&p.createElement(fn,{hide:function(){return r(!1)}}))},pn=function(e){return function(t){var n=t.relatedTarget;t.currentTarget.contains(n)||t.target instanceof HTMLButtonElement||e.setIsEdit(!0)}},vn=function(e){var t=v.a.useState(!1),n=Object(f.a)(t,2),a=n[0],r=n[1];return v.a.useEffect((function(){e.isEdit||r(!1)}),[e.isEdit]),v.a.createElement("div",{className:yt.a.container,onFocus:pn(e)},v.a.createElement(d.g,{size:8}),e.isEdit&&v.a.createElement("div",{className:yt.a.header},v.a.createElement(kt,{columns:e.columns,isExpand:a,setIsExpand:r})),v.a.createElement("div",{onKeyDown:Ot},v.a.createElement(mn,{rows:e.table.value.rows,tableId:e.table.id,isTableEdit:e.isEdit,isTableExpand:a,columns:e.columns,isRowsExpand:e.isRowsExpand,relatedEdges:e.relatedEdges,diagramDispatch:e.diagramDispatch})),(e.isEdit||0===e.table.value.rows.length)&&v.a.createElement(wt,{tableId:e.table.id,diagramDispatch:e.diagramDispatch}),v.a.createElement(d.g,{size:8}))},hn=n(54),gn=n.n(hn),bn=n(119),wn=n.n(bn),En=function(e){var t=v.a.useRef({x:0,y:0}),n=v.a.useState(!1),a=Object(f.a)(n,2),r=a[0],i=a[1];return v.a.createElement("div",{className:wn.a.container,style:{width:208}},r?v.a.createElement(d.i,{key:e.table.value.name,defaultValue:e.table.value.name,onBlur:function(t){!function(e,t){var n=t.currentTarget.value;if(n!==e.table.value.name){var a={id:e.table.id,name:n};e.diagramDispatch({type:"update-table-name",payload:a})}}(e,t),i(!1)},onFocus:function(){e.setIsEdit(!1)},style:d.i.style.flat,size:d.i.size.small,autoFocus:!0}):v.a.createElement("div",{className:[wn.a.view,d.i.size.small.main].join(" "),onMouseDown:function(e){t.current.x=e.clientX,t.current.y=e.clientY},onClick:function(e){var n=t.current,a=n.x,r=n.y,o=e.clientX,c=e.clientY;a===o&&r===c&&i(!0)}},e.table.value.name))},yn=n(204),_n=n.n(yn),xn=function(e){return v.a.createElement("div",{className:[_n.a.container,d.q.primary].join(" ")},v.a.createElement(d.c,{style:d.c.style.flat,onClick:function(){var t={id:e.tableId};e.diagramDispatch({type:"remove-table",payload:t})},icon:g.a.cross,size:d.c.size.small}))},jn=function(e){return v.a.createElement("div",{className:"".concat(gn.a.container," ").concat(e.isEdit?gn.a.edit:"")},v.a.createElement("div",{className:gn.a.main},v.a.createElement(En,{table:e.table,setIsEdit:e.setIsEdit,diagramDispatch:e.diagramDispatch}),v.a.createElement("div",{className:gn.a.remove},v.a.createElement(xn,{tableId:e.table.id,diagramDispatch:e.diagramDispatch}))))},In=function(e,t){if(!e)return function(e){var n=e.relatedTarget;e.currentTarget.contains(n)||t(!1)}},Sn=n(85),On=n.n(Sn),zn=function(e,t){var n=[On.a.container,d.q.primary,d.r.strong];return e.isSelected&&n.push(On.a.selected),t&&n.push(On.a.edit),n.join(" ")},Tn=function(e){return{type:"ref",value:e.edge.id}},Dn=function(e){return function(){e.setSelectIds((function(t){var n=e.relatedEdges.map(Tn);return n.push({type:"table",value:e.table.id}),function(e,t){if(e.length!==t.length)return!1;var n=vt(e),a=n.tables,r=n.refs;return t.every((function(e){return!("table"!==e.type||!a.has(e.value))||!("ref"!==e.type||!r.has(e.value))}))}(t,n)?t:n}))}},Mn=v.a.memo((function(e){e.table.id,e.table.value.id;var t=v.a.useState(!1),n=Object(f.a)(t,2),a=n[0],r=n[1],i=Object(h.a)(function(e){return function(t){var n=t.getItem();return null!==n&&("row"===n.type&&n.tableId===e.table.id)}}(e));return v.a.createElement("div",{className:zn(e,a),onBlur:In(i,r),tabIndex:0,onFocus:Dn(e)},v.a.createElement(jn,{table:e.table,isEdit:a,setIsEdit:r,diagramDispatch:e.diagramDispatch}),v.a.createElement(d.b,{color:"weak"}),v.a.createElement("div",{style:{marginTop:-1}}),v.a.createElement(vn,{table:e.table,isEdit:a,setIsEdit:r,isRowsExpand:e.isRowsExpand,relatedEdges:e.relatedEdges,diagramDispatch:e.diagramDispatch,columns:e.columns}))})),kn=function(e){var t=v.a.useRef(null);return v.a.createElement(Pe.a,{position:{x:0,y:0},onDrag:dt(e),onStop:mt(e),nodeRef:t,scale:e.zoom,cancel:"input, button, select, .react-draggable-cancel"},v.a.createElement("div",{ref:t,className:He.a.container},v.a.createElement(Mn,{table:e.table,isSelected:e.isSelected,setSelectIds:e.setSelectId,isRowsExpand:e.isRowsExpand,columns:e.columns,relatedEdges:e.relatedEdges,diagramDispatch:e.diagramDispatch})))},Rn=n(205),Ln=[n.n(Rn).a.container,d.q.primary,d.r.strong].join(" "),Nn=function(e){return p.createElement("div",{className:Ln,style:L(e.table,e.isRowsExpand)})},An=v.a.memo((function(e){var t=v.a.useRef(null),n=v.a.useState(!1),a=Object(f.a)(n,2),r=a[0],i=a[1];v.a.useEffect((function(){var n,a=(n=i,function(e){e.forEach((function(e){n(e.isIntersecting)}))}),r=new IntersectionObserver(a,{threshold:0,root:e.viewportRef.current});if(null===t.current)throw Error("ref is null");return r.observe(t.current),function(){return r.disconnect()}}),[e.viewportRef]);var o=r||e.forceVisible;return v.a.createElement("div",{id:k(e.table.id),style:{position:"absolute",top:e.table.position.top,left:e.table.position.left,zIndex:e.isSelected?1:0},ref:t,"data-name":e.table.value.name,"data-is-visible":o},o?v.a.createElement(kn,{table:e.table,columns:e.columns,diagramDispatch:e.diagramDispatch,relatedEdges:e.relatedEdges,isRowsExpand:e.isRowsExpand,isSelected:e.isSelected,setSelectId:e.setSelectId,zoom:e.zoom}):v.a.createElement(Nn,{isRowsExpand:e.isRowsExpand,table:e.table}))})),Vn=function(e,t){var n=e.current;if(null===n)throw Error("start is null");var a={left:t.nativeEvent.offsetX,top:t.nativeEvent.offsetY},r=Math.min(n.top,a.top),i=Math.max(n.left,a.left),o=Math.max(n.top,a.top),c=Math.min(n.left,a.left);return{top:r,left:c,width:i-c,height:o-r}},Fn=function(e,t){e.style.opacity=t},Pn={top:0,left:0,width:0,height:0},qn=function(e,t){e.style.width="".concat(t.width,"px"),e.style.height="".concat(t.height,"px"),e.style.transform="translate(".concat(t.left,"px, ").concat(t.top,"px)")},Hn=function(e,t){var n=e.current;if(null===n)throw Error("boxRef is null");"start"===t?(qn(n,Pn),Fn(n,"1")):"stop"===t?Fn(n,"0"):qn(n,t)},Cn=n(86),Bn=n.n(Cn),Un=function(e){if("true"!==e.element.dataset.isVisible)return!1;var t,n,a=e.element,r=a.clientWidth,i=a.clientHeight,o=e.position,c={width:r,height:i,top:o.top,left:o.left};return t=e.target,n=c,!(t.left>n.left+n.width)&&!(n.left>t.left+t.width)&&!(t.top>n.top+n.height)&&!(n.top>t.top+t.height)},Jn=function(e,t){return e.map((function(e){return{type:t,value:e}}))},Wn=function(e,t){var n=function(e,t){return e.diagram.tables.filter((function(e){return Un({target:t,position:e.position,element:R(e.id)})})).map((function(e){return e.id}))}(e,t),a=function(e,t){var n=new Set(t);return e.diagram.refs.filter((function(e){return n.has(e.from.table)||n.has(e.to.table)})).map((function(e){return e.id}))}(e,n);return[].concat(Object(r.a)(Jn(n,"table")),Object(r.a)(Jn(a,"ref")))},Kn=function(e,t){t?e.classList.add("temp-selected"):e.classList.remove("temp-selected")},Gn=function(e,t){var n=new Set;t.tables.forEach((function(t){var a=R(t.id),r=t.position,i=Un({target:e,element:a,position:r});i&&n.add(t.id),Kn(a,i)})),t.refs.forEach((function(e){var t=n.has(e.from.table)||n.has(e.to.table),a=function(e){var t=document.getElementById(Ue(e));if(t instanceof SVGGElement)return t;throw Error("Element is not SVGGElement")}(e.id);Kn(a,t)}))},Yn=function(e,t){var n=e.current;if(null===n)throw Error("containerRef is null");n.style.zIndex=t?"2":"0"},Qn=[],Zn=v.a.memo((function(e){var t=v.a.useRef(null),n=v.a.useRef(!1),a=v.a.useRef(null),r=v.a.useRef(null),i=v.a.useRef(!1);return v.a.createElement("div",{className:Bn.a.container,tabIndex:0,onKeyDown:function(e){" "===e.key&&(i.current=!0)},onKeyUp:function(e){" "===e.key&&(i.current=!1)},onMouseDown:function(o){if(!0!==i.current){var c=o.nativeEvent,s=c.offsetX,l=c.offsetY;t.current={left:s,top:l},n.current=!0,Yn(r,!0),Hn(a,"start"),e.setSelectIds(Qn)}},onMouseMove:function(r){if(!1!==n.current){var i=Vn(t,r);Hn(a,i),Gn(i,e.diagram)}},onMouseUp:function(i){if(!1!==n.current){n.current=!1,document.querySelectorAll(".".concat("temp-selected")).forEach((function(e){e.classList.remove("temp-selected")})),Yn(r,!1),Hn(a,"stop");var o=Vn(t,i),c=Wn({diagram:e.diagram},o);e.setSelectIds(c),t.current=null}},ref:r},v.a.createElement("div",{ref:a,className:Bn.a.box},v.a.createElement("div",{className:Bn.a.boxBg})))})),$n=n(120),Xn=n.n($n),ea=function(e){return function(){e.setSelectIds([{type:"ref",value:e.refId}])}},ta=function(e){return p.createElement("circle",{className:Be.a.dot,r:"4"},p.createElement("animateMotion",{dur:"".concat(e.path.length/150,"s"),repeatCount:"indefinite",id:Je(e.edge.id,"highlight"),path:e.path.main}))},na=function(e){var t=[Be.a.container];return e.isSelected&&t.push(Be.a.selected),t.join(" ")},aa=v.a.memo((function(e){e.edge.from.rows,e.edge.to.rows;var t=e.edge,n=e.fromTable,a=e.toTable,r=e.edgesMids,i=ot({edge:t,fromTable:n,toTable:a,edgesMids:r});if(null===i)return null;var o=i.path,c=i.points;return v.a.createElement("g",{id:Ue(e.edge.id),className:na(e)},v.a.createElement("path",{id:Je(t.id,"path-main"),className:Be.a.path,d:o.main}),v.a.createElement("path",{className:Be.a.path,d:o.from}),v.a.createElement("path",{className:Be.a.path,d:o.to}),v.a.createElement(Ge,{edge:e.edge,points:c.from}),v.a.createElement(lt,{edge:e.edge,points:c.to}),e.isSelected&&v.a.createElement(ta,{edge:e.edge,path:o}),v.a.createElement("path",{className:Be.a.hitarea,d:o.main,onClick:ea({refId:e.edge.id,setSelectIds:e.setSelectIds})}))})),ra=n(206),ia=n.n(ra),oa=function(e){var t=function(t){var n=e.tablesMap.get(t.table);if(void 0!==n)return n;throw Error("Table is undefined")},n=function(e){var t=p.useRef({edgesMap:new Map,usedMids:new Set});return p.useEffect((function(){var n=new Set(e.edges.map((function(e){return e.id})));t.current.edgesMap.forEach((function(e,a){n.has(a)||(t.current.usedMids.delete(e.mid),t.current.edgesMap.delete(a))}))}),[e.edges]),t}({edges:e.diagram.refs});return p.createElement("svg",{className:ia.a.container,width:e.diagram.size.width,height:e.diagram.size.height},e.diagram.refs.map((function(a){return p.createElement(aa,{key:a.id,edge:a,isSelected:e.selectedRefs.has(a.id),setSelectIds:e.setSelectIds,fromTable:t(a.from),toTable:t(a.to),edgesMids:n,diagramDispatch:e.diagramDispatch})})))},ca=function(e,t){var n=[e,e.diagram.size],a=n[0].zoom,r=n[1],i=r.width,o=r.height,c=(a-1)/2,s="".concat(o*c,"px ").concat(i*c,"px");return{width:i,height:o,transform:1!==a?"scale(".concat(a,")"):"",margin:s,fontSize:"web"===t?void 0:12}},sa=function(e,t){return e.set(t.id,t),e},la=[],ua=function(e){var t=e.diagram,n=t.refs,a=t.tables,r=v.a.useMemo((function(){return a.reduce(sa,new Map)}),[a]),i=v.a.useMemo((function(){return n.reduce(function(e){return function(t,n){var a,r,i=e.get(n.to.table),o=e.get(n.from.table),c=n.from.table,s=null!==(a=t.get(c))&&void 0!==a?a:[];t.set(c,s.concat({edge:n,table:i}));var l=n.to.table,u=null!==(r=t.get(l))&&void 0!==r?r:[];return t.set(l,u.concat({edge:n,table:o})),t}}(r),new Map)}),[n,r]),o=Te();return v.a.createElement("div",{id:"canvas",className:[Xn.a.container,d.q.secondary].join(" "),style:ca(e,o)},v.a.createElement("div",{className:Xn.a.grid}),v.a.createElement(Zn,{diagram:e.diagram,setSelectIds:e.setSelectIds}),v.a.createElement(oa,{diagram:e.diagram,diagramDispatch:e.diagramDispatch,setSelectIds:e.setSelectIds,selectedRefs:e.selectedRefs,tablesMap:r}),e.diagram.tables.map((function(t){var n;return v.a.createElement(An,{key:t.id,table:t,isSelected:e.selectedTables.has(t.id),setSelectId:e.setSelectIds,isRowsExpand:e.isRowsExpand,columns:e.diagram.columns,relatedEdges:null!==(n=i.get(t.id))&&void 0!==n?n:la,diagramDispatch:e.diagramDispatch,viewportRef:e.viewportRef,zoom:e.zoom,forceVisible:e.forceVisible})})))},da=n(121),fa=n.n(da),ma=(n(442),function(e){return function(t){t.target instanceof HTMLInputElement||" "===t.key&&(t.preventDefault(),e.drag||(e.setDrag(!0),e.element.classList.add("dragscroll"),fa.a.reset(),e.element.addEventListener("keyup",function(e){return function t(){e.setDrag(!1),e.element.classList.remove("dragscroll"),fa.a.reset(),e.element.removeEventListener("keyup",t)}}(e))))}}),pa={behavior:"smooth",block:"center",inline:"center"},va=function(e){return v.a.createElement(d.c,{onClick:function(){var t=ue(e.tables.map((function(e){return e.id})));e.diagramDispatch({type:"add-table",payload:{id:t}}),window.setTimeout((function(){e.setSelectIds([{type:"table",value:t}]),R(t).scrollIntoView(pa)}),0)},size:e.buttonSize,icon:g.a.plus,children:"Table"})},ha=n(13),ga=n.n(ha),ba=n(25),wa=n(122),Ea=n.n(wa),ya={svg:"data:image/svg+xml;charset=utf-8,",png:"data:image/png;base64,"},_a=function(){var e=Object(ba.a)(ga.a.mark((function e(t){return ga.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.format,e.next="png"===e.t0?3:"svg"===e.t0?6:9;break;case 3:return e.next=5,Ea.a.toPng(t.canvas);case 5:return e.abrupt("return",e.sent);case 6:return e.next=8,Ea.a.toSvg(t.canvas);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xa=function(){var e=Object(ba.a)(ga.a.mark((function e(t){return ga.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return window.setTimeout((function(){return e()}),t)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ja=function(){var e=Object(ba.a)(ga.a.mark((function e(t){var n,a,r;return ga.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setTableVisible(!0),xa(100),e.next=4,_a(t);case 4:return n=e.sent,t.setTableVisible(!1),a=ya[t.format],r=n.replace(a,""),e.abrupt("return",{prefix:a,body:r});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ia=n(207),Sa=["&%23xA;","&%239;"],Oa=function(e){if(e.prefix.includes("base64"))return e.body;if(e.prefix.includes("utf-8")){var t=e.body;return Sa.forEach((function(e){t=t.replaceAll(e,"")})),Object(Ia.a)(t)}throw Error("Unknown file prefix: ".concat(e.prefix))},za=function(e){switch(e.platform){case"mac":return function(e){var t={data:Oa(e.file),ext:e.format,name:"diagram",title:"Save diagram as\u2026"};window.webkit.messageHandlers.saveFile.postMessage(t)}(e);case"web":return function(e){var t=document.createElement("a");t.download="diagram.".concat(e.format),t.href="".concat(e.file.prefix).concat(e.file.body),t.click()}(e)}},Ta=function(){var e=Object(ba.a)(ga.a.mark((function e(t,n,a){var r,i;return ga.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=document.getElementById("canvas"))){e.next=3;break}throw Error("Canvas is null");case 3:return e.next=5,ja({canvas:r,format:a,setTableVisible:t});case 5:i=e.sent,za({file:i,format:a,platform:n});case 7:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Da=["MySQL","MariaDB","SQLite","PostgreSQL","Cassandra","Snowflake","MicrosoftSQLServer"],Ma=function(e){var t=Te(),n=[{label:"Save as Image (PNG)",fn:function(){return Ta(e.setTableVisible,t,"png")}},{label:"Save as Web page (SVG)",fn:function(){return Ta(e.setTableVisible,t,"svg")}},{label:"\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500",fn:function(){},disabled:!0}].concat(Object(r.a)(Da.map((function(n){return{label:"Export to ".concat(n),fn:function(){return function(e,t,n){if("web"===t)return window.alert("Export to SQL requires TablePlus app");var a={data:j(e),driver:n};window.webkit.messageHandlers.exportSQL.postMessage(a)}(e.diagram,t,n)}}}))));return v.a.createElement(d.d,{icon:g.a.share,actions:n,size:e.buttonSize})},ka=function(e){return function(t){switch(t){case"undo":return e.dispatch({type:"undo"});case"redo":return e.dispatch({type:"redo"});default:throw Error('Unknown value: "'.concat(t,'"'))}}},Ra={key:"undo",icon:g.a.undo,value:"undo"},La={key:"redo",icon:g.a.redo,value:"redo"},Na=function(e){return v.a.createElement(d.p,{value:"",setValue:ka(e),options:[Object(M.a)(Object(M.a)({},Ra),{},{disabled:0===e.past.length}),Object(M.a)(Object(M.a)({},La),{},{disabled:0===e.future.length})],size:e.buttonSize})},Aa=n(208),Va=n.n(Aa),Fa={type:"set-layout",payload:{type:"auto"}},Pa=function(e){return[{label:"Expand all columns and Arrange",fn:function(){e.setIsRowsExpand(!0),window.setTimeout((function(){return e.diagramDispatch(Fa)}),0)}},{label:"Collapse columns and Arrange",fn:function(){e.setIsRowsExpand(!1),window.setTimeout((function(){return e.diagramDispatch(Fa)}),0)}}]},qa=function(e){return v.a.createElement("div",{className:Va.a.container},v.a.createElement(d.c,{icon:g.a.layoutAuto,onClick:function(){e.diagramDispatch(Fa)},children:"Arrange",size:e.buttonSize}),v.a.createElement(d.d,{actions:Pa(e),icon:g.a.caret,size:e.buttonSize}))},Ha="https://diagramplus.com/samples",Ca=function(){var e=Object(ba.a)(ga.a.mark((function e(t,n){var a,r,i;return ga.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n).then((function(e){return e.json()}));case 2:a=e.sent,r=JSON.stringify(a),i={text:r,isAppend:!1},t.diagramDispatch({type:"parse-json",payload:i});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ba=function(e){return p.createElement(d.d,{actions:[{label:"Import from Database (require TablePlus app)",disabled:!0,fn:function(){}},{label:"\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500",fn:function(){},disabled:!0},{label:"Load sample 1 (3 small tables)",fn:function(){return Ca(e,"".concat(Ha,"/1.json"))}},{label:"Load sample 2 (Table with many columns)",fn:function(){return Ca(e,"".concat(Ha,"/2.json"))}},{label:"Load sample 3 (28 tables)",fn:function(){return Ca(e,"".concat(Ha,"/3.json"))}},{label:"Load sample 4 (1710 tables)",fn:function(){return Ca(e,"".concat(Ha,"/4.json"))}}]})},Ua=function(e,t){var n,a=t.filter((n=e,function(e){return[e.from.table,e.to.table].includes(n)})).map((function(e){return{type:"ref",value:e.id}}));return a.push({type:"table",value:e}),a},Ja={behavior:"smooth",block:"center",inline:"center"},Wa=function(e){var t=e.diagram,n=e.setSelectIds,a=v.a.useMemo((function(){var e=new Set;return t.tables.forEach((function(t){e.add(t.value.name)})),Object(r.a)(e)}),[t.tables]),i=v.a.useState(""),o=Object(f.a)(i,2),c=o[0],s=o[1],l=function(e){!1!==a.includes(e)&&function(e,t,n){var a=e.tables.find((function(e){return e.value.name===n}));if(void 0===a)throw Error("table is undefined");t(Ua(a.id,e.refs)),R(a.id).scrollIntoView(Ja)}(t,n,e)};return v.a.createElement("div",{style:{flex:"1 1 0px"}},v.a.createElement(d.i,{icon:g.a.search,placeholder:"Find table\u2026",value:c,setValue:function(e){s(e),l(e)},list:{id:"header-search",values:a},onKeyUp:function(e){"Enter"===e.key&&l(c)},size:e.inputSize}))},Ka=n(123),Ga=n.n(Ka),Ya=n(209),Qa=n.n(Ya),Za=[{value:"theme-light",icon:g.a.flash,key:"light"},{value:"theme-auto",label:"System",key:"auto"},{value:"theme-dark",icon:g.a.moon,key:"dark"}],$a=function(e){return v.a.createElement(d.p,{value:e.theme,setValue:e.setTheme,options:Za,size:e.buttonSize})},Xa=function(e){return function(t){switch(t){case"reset":return e.setZoom(1);case"in":if(e.zoom>=2)return;return e.setZoom(e.zoom+.25);case"out":if(e.zoom<=.25)return;return e.setZoom(e.zoom-.25);default:throw Error('Unknown value: "'.concat(t,'"'))}}},er=function(e){return v.a.createElement(d.p,{value:null,setValue:Xa(e),options:[{key:"out",icon:g.a.zoomOut,value:"out"},{label:"".concat(100*e.zoom,"%"),value:"reset"},{key:"in",icon:g.a.zoomIn,value:"in"}],size:e.buttonSize})},tr={web:"",mac:Qa.a.container},nr=v.a.memo((function(e){var t=Te(),n=function(e){switch(e){case"mac":return[d.c.size.small,d.i.size.small];default:return[d.c.size.medium,d.i.size.medium]}}(t),a=Object(f.a)(n,2),r=a[0],i=a[1],o=function(e){var t="web"===e?v.a.createElement(d.b,{color:"weak"}):null;return v.a.createElement(v.a.Fragment,null,v.a.createElement(d.g,{size:16})," ",t," ",v.a.createElement(d.g,{size:16}))}(t);return v.a.createElement("div",{className:[Ga.a.container,tr[t]].join(" ")},v.a.createElement("div",{className:Ga.a.platformPad}),v.a.createElement(d.g,{size:16}),"web"===t&&v.a.createElement(v.a.Fragment,null,v.a.createElement(Ba,{diagramDispatch:e.diagramDispatch}),o),v.a.createElement(va,{buttonSize:r,tables:e.diagram.tables,diagramDispatch:e.diagramDispatch,setSelectIds:e.setSelectIds}),v.a.createElement(d.g,{size:16}),v.a.createElement(Na,{buttonSize:r,past:e.diagramPast,future:e.diagramFuture,dispatch:e.diagramDispatch}),o,v.a.createElement(Wa,{inputSize:i,diagram:e.diagram,setSelectIds:e.setSelectIds}),o,v.a.createElement(qa,{buttonSize:r,setIsRowsExpand:e.setIsRowsExpand,diagramDispatch:e.diagramDispatch}),v.a.createElement(d.g,{size:16}),v.a.createElement(er,{buttonSize:r,viewportRef:e.viewportRef,zoom:e.zoom,setZoom:e.setZoom}),v.a.createElement(d.g,{size:16}),v.a.createElement(Ma,{buttonSize:r,diagram:e.diagram,setTableVisible:e.setTableVisible}),"web"===t&&v.a.createElement(v.a.Fragment,null,o,v.a.createElement($a,{buttonSize:r,theme:e.theme,setTheme:e.setTheme})),v.a.createElement(d.g,{size:16}))})),ar=n(124),rr=n.n(ar),ir=c("setProgressIndicator"),or=function(){var e=v.a.useState(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],r=v.a.useState(void 0),i=Object(f.a)(r,2),o=i[0],c=i[1];return v.a.useEffect((function(){ir((function(e,t){a(e),c(t)}))}),[]),!1===n?null:v.a.createElement("div",{className:[rr.a.container,d.q.secondary].join(" ")},v.a.createElement("div",{className:rr.a.body},v.a.createElement(d.m,{size:24,value:!0===n?null:n}),void 0!==o&&v.a.createElement(v.a.Fragment,null,v.a.createElement(d.g,{size:16}),v.a.createElement("div",null,o))))},cr=function(e){var t=e.ids,n=e.diagram;p.useEffect((function(){var e=function(e){return function(e,t){var n;if(!(t.target instanceof HTMLInputElement)&&!(t.target instanceof HTMLTextAreaElement)&&0!==e.ids.length){var a=vt(e.ids).tables;if(0!==a.size){var r={columns:e.diagram.columns,tables:e.diagram.tables.filter((function(e){return a.has(e.id)})),refs:e.diagram.refs.filter((function(e){return a.has(e.from.table)&&a.has(e.to.table)})),size:{width:0,height:0},schema:e.diagram.schema},i=j(r),o=JSON.stringify(i);null===(n=t.clipboardData)||void 0===n||n.setData("text/plain",o),t.preventDefault()}}}({ids:t,diagram:n},e)};return document.addEventListener("copy",e),function(){return document.removeEventListener("copy",e)}}),[t,n])},sr=function(e,t){return e.filter((function(e){return e.type===t})).map((function(e){return e.value}))},lr=function(e){var t=e.dispatch;p.useEffect((function(){var e=function(e){return function(e,t){var n,a;if(!(t.target instanceof HTMLInputElement)&&!(t.target instanceof HTMLTextAreaElement)){var r={text:null!==(n=null===(a=t.clipboardData)||void 0===a?void 0:a.getData("text/plain"))&&void 0!==n?n:"",isAppend:!0};e.dispatch({type:"parse-json",payload:r})}}({dispatch:t},e)};return document.addEventListener("paste",e),function(){return document.removeEventListener("paste",e)}}),[t])},ur=n(55),dr=n.n(ur),fr=function(){var e=function(){var e=Le(),t=v.a.useReducer(Ve,void 0,(function(){return{past:[],present:e.get(),future:[]}})),n=Object(f.a)(t,2),a=n[0],r=n[1];D(a.present,r),Ne({history:a,dispatch:r});var i=e.set;return v.a.useEffect((function(){i(a.present)}),[a.present,i]),{history:a,dispatch:r}}(),t=v.a.useState(1),n=Object(f.a)(t,2),a=n[0],r=n[1],i=v.a.useRef(null),o=function(){var e=p.useState([]),t=Object(f.a)(e,2),n=t[0],a=t[1],r=p.useMemo((function(){return vt(n)}),[n]),i=r.tables,o=r.refs;return{ids:n,setIds:a,tables:i,refs:o}}(),c=Object(m.a)(),s=v.a.useState(!1),l=Object(f.a)(s,2),u=l[0],h=l[1],g=v.a.useState(!1),b=Object(f.a)(g,2),w=b[0],E=b[1];return cr({diagram:e.history.present,ids:o.ids}),lr({dispatch:e.dispatch}),function(e){var t=v.a.useState(!1),n=Object(f.a)(t,2),a=n[0],r=n[1];v.a.useEffect((function(){var t=e.current;if(null!==t){var n={drag:a,setDrag:r,element:t};t.tabIndex=0;var i=ma(n);return t.addEventListener("keydown",i),function(){return t.removeEventListener("keydown",i)}}}),[a,e])}(i),v.a.createElement("div",{className:dr.a.container},v.a.createElement("div",{className:dr.a.header},v.a.createElement(nr,{diagram:e.history.present,diagramPast:e.history.past,diagramFuture:e.history.future,diagramDispatch:e.dispatch,theme:c.theme,setTheme:c.setTheme,viewportRef:i,zoom:a,setZoom:r,setTableVisible:h,setIsRowsExpand:E,setSelectIds:o.setIds})),v.a.createElement(d.b,{color:"strong"}),v.a.createElement("div",{className:"".concat(dr.a.body," ").concat(d.q.secondary)},v.a.createElement("div",{className:dr.a.viewport,tabIndex:0,ref:i,onKeyUp:function(t){!function(e){var t=e.ids,n=e.event,a=e.diagramDispatch;!1!==["Backspace","Delete"].includes(n.key)&&(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement||(a({type:"remove-multiple-refs",payload:{ids:sr(t,"ref")}}),a({type:"remove-multiple-tables",payload:{ids:sr(t,"table")}}),n.stopPropagation()))}({ids:o.ids,diagramDispatch:e.dispatch,event:t})}},v.a.createElement(ua,{diagram:e.history.present,diagramDispatch:e.dispatch,isRowsExpand:w,zoom:a,viewportRef:i,forceVisible:u,selectedRefs:o.refs,selectedTables:o.tables,setSelectIds:o.setIds})),v.a.createElement(or,null)),v.a.createElement(_,{viewportRef:i}))},mr=n(87),pr=n.n(mr),vr=n(210),hr=n.n(vr),gr=n(217),br=n(212),wr=n(125),Er=n.n(wr),yr=function(){return v.a.createElement("a",{className:Er.a.logo,href:"https://tableplus.com",target:"_blank",rel:"noopener noreferrer"},v.a.createElement("img",{alt:"TablePlus logo",src:hr.a,width:"auto",height:32}))},_r=function(){return v.a.createElement("div",{className:Er.a.container},v.a.createElement(d.g,{size:16}),v.a.createElement(br.a,{dataText:"diagram"}),v.a.createElement(d.f,null),v.a.createElement(gr.a,{offlineMode:!1}),v.a.createElement(d.g,{size:16}),v.a.createElement(yr,null),v.a.createElement(d.g,{size:16}))},xr=function(){var e=Te();return v.a.createElement("div",{className:[pr.a.container,d.t.custom].join(" ")},v.a.createElement("div",{className:pr.a.body},v.a.createElement(fr,null)),"web"===e&&v.a.createElement(v.a.Fragment,null,v.a.createElement(d.b,{color:"strong"}),v.a.createElement("div",{className:pr.a.footer},v.a.createElement(_r,null))))},jr=(n(444),n(214)),Ir=n(215),Sr=n(23),Or=n.n(Sr),zr=new a.a("diagram");"5"!==(u=zr).getItem("version")&&(u.clear(),u.setItem("version","5"));var Tr=function(){var e=function(){var e=v.a.useState(Oe),t=Object(f.a)(e,2),n=t[0],a=t[1];return v.a.useEffect((function(){De((function(e){a(e)}))}),[]),n}();return v.a.createElement(v.a.StrictMode,null,v.a.createElement(a.b.Provider,{value:zr},v.a.createElement(jr.a,{options:Ir.a},v.a.createElement(ze.Provider,{value:e},v.a.createElement(xr,null)))))};Or.a.render(v.a.createElement(Tr,null),document.getElementById("root"))},52:function(e,t,n){e.exports={container:"layer_container__1DSen",svg:"layer_svg__1kDpM",line:"layer_line__24WBc",icon:"layer_icon__1W0JP"}},53:function(e,t,n){e.exports={container:"string_container__6Pyow",view:"string_view__1oiV8",weak:"string_weak__3HpXd",edit:"string_edit__2m0iK",empty:"string_empty__3u9-r"}},54:function(e,t,n){e.exports={container:"header_container__1QU6W",main:"header_main__1XQwN",edit:"header_edit__3vvV8",remove:"header_remove__SIzDW",title:"header_title__l4mqY"}},55:function(e,t,n){e.exports={container:"view_container__2oDm-",body:"view_body__1Z1mW",viewport:"view_viewport__1l3sB",header:"view_header__3f7ol"}},84:function(e,t,n){e.exports={container:"header_container__2zpDr","slide-in":"header_slide-in__TPuT0",field:"header_field__nquLg",rightField:"header_rightField__3R_Ju"}},85:function(e,t,n){e.exports={container:"main_container__24nAp",selected:"main_selected__1OzJ8",edit:"main_edit__KBdPX"}},86:function(e,t,n){e.exports={container:"drag_container__1_FJJ",box:"drag_box__2nmY1",boxBg:"drag_boxBg__32YQk"}},87:function(e,t,n){e.exports={container:"app_container__2pv2U",body:"app_body__3dFS1",footer:"app_footer__1cpy9"}}},[[219,1,2]]]);
//# sourceMappingURL=main.45dd1145.chunk.js.map