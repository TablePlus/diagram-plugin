{"version":3,"sources":["app/edge/canvas/marker/marker.module.scss","app/table/active/body/body.module.scss","app/row/row.module.scss","app/table/active/header/name/name.module.scss","app/view/canvas/canvas.module.scss","app/view/progress/progress.module.scss","app/app/footer/footer.module.scss","app/edge/canvas/canvas.module.css","app/table/active/active.module.css","app/table/active/body/add/add.module.scss","app/row/field/boolean/boolean.module.css","app/row/field/field.module.scss","app/row/remove/remove.module.scss","app/table/active/header/remove/remove.module.css","app/table/blank/blank.module.css","app/view/header/style/mac.module.scss","app/view/header/style/win.module.scss","app/app/footer/logo.png","app/app/footer/privacy/privacy.module.scss","app/edge/edge.module.scss","error/report/report.module.scss","app/app/footer/links/links.module.scss","diagram/state/undo/undo.ts","app/row/drag/layer/layer.tsx","diagram/edit/convert/from.ts","utils/external.ts","diagram/state/external/external.ts","app/table/utils.ts","diagram/layout/dagree.ts","diagram/layout/masonry.ts","diagram/layout/merge.ts","diagram/layout/split.ts","diagram/layout/layout.ts","diagram/edit/convert/to.ts","diagram/schema/schema.ts","diagram/schema/semantic.ts","diagram/state/reducer/id.ts","diagram/state/reducer/row/add.ts","diagram/state/reducer/table/add.ts","diagram/state/reducer/import/raw.ts","diagram/state/reducer/import/append.ts","diagram/state/reducer/import/import.ts","diagram/state/reducer/ref/remove.ts","diagram/state/reducer/ref/ref.ts","diagram/state/reducer/ref/add.ts","diagram/state/reducer/row/remove.ts","diagram/state/reducer/row/update.ts","diagram/state/reducer/table/remove.ts","diagram/state/reducer/table/update-name.ts","diagram/state/reducer/table/table.ts","diagram/state/reducer/table/position.ts","diagram/state/reducer/table/row.ts","utils/platform.ts","diagram/state/storage/fallback.ts","diagram/state/storage/storage.ts","diagram/state/undo/shortcut.ts","diagram/state/use-diagram.ts","diagram/state/reducer/reducer.ts","diagram/state/reducer/row/row.ts","diagram/state/reducer/layout/layout.ts","app/view/select/edge.ts","app/row/dom.ts","app/edge/state/box.ts","app/edge/state/observe.ts","app/edge/state/path.ts","app/edge/state/point.ts","app/edge/state/mid.ts","app/edge/state/state.ts","app/edge/utils.ts","app/edge/highlight.tsx","app/edge/edge.tsx","app/edge/canvas/marker/marker.tsx","app/edge/canvas/canvas.tsx","app/table/active/drag/move.ts","app/table/active/drag/stop.ts","app/view/select/select.ts","app/table/active/body/add/add.tsx","app/table/active/body/events/navigate.ts","app/table/active/body/header/header.tsx","app/row/drag/source/source.tsx","app/row/field/boolean/boolean.tsx","app/row/field/string/leave.ts","app/row/field/string/string.tsx","app/row/field/field.tsx","app/row/key.ts","app/row/remove/remove.tsx","app/row/row.tsx","app/row/drag/drop/drop.ts","app/table/rows/headless.tsx","app/table/rows/edge-map.ts","app/table/rows/group.ts","app/table/active/body/rows/hidden.tsx","app/table/active/body/rows/rows.tsx","app/table/active/body/body.tsx","app/table/active/header/name/name.tsx","app/table/active/header/remove/remove.tsx","app/table/active/header/header.tsx","app/table/active/main/event.ts","app/table/active/main/main.tsx","app/table/active/active.tsx","app/table/blank/blank.tsx","app/table/inactive/inactive.tsx","app/table/table.tsx","app/view/select/canvas/drag/box.ts","app/view/select/canvas/drag/overlap.ts","app/view/select/canvas/drag/element.ts","app/view/select/canvas/drag/drag.tsx","app/view/canvas/canvas.tsx","app/view/drag/use-drag.ts","app/view/header/add.tsx","app/view/header/export/image/safari-fix.ts","app/view/header/export/image/get.ts","app/view/header/export/image/save.ts","app/view/header/export/image/image.ts","app/view/header/export/sql/sql.ts","app/view/header/export/export.tsx","app/view/header/history.tsx","app/view/header/import/import.tsx","app/view/header/layout/layout.tsx","app/view/select/table.ts","app/view/header/search.tsx","app/view/header/theme/theme.tsx","app/view/header/utils/div.tsx","app/view/header/zoom.tsx","app/view/header/header.tsx","app/view/header/utils/size.ts","app/view/progress/progress.tsx","app/view/select/canvas/copy.ts","app/view/select/canvas/delete.ts","app/view/select/canvas/paste.ts","app/view/theme/theme.ts","app/view/view.tsx","app/app/footer/links/links.tsx","app/app/footer/privacy/privacy.tsx","app/app/footer/footer.tsx","app/app/app.tsx","error/report/item/item.tsx","error/report/report.tsx","error/error.tsx","utils/version.ts","index.tsx","app/row/drag/layer/layer.module.scss","app/row/field/string/string.module.scss","app/table/active/header/header.module.scss","app/view/view.module.scss","error/report/item/item.module.css","app/table/active/body/header/header.module.scss","app/row/drag/source/source.module.scss","app/table/active/main/main.module.scss","app/view/select/canvas/drag/drag.module.css","app/view/header/style/header.module.scss","app/app/app.module.scss"],"names":["module","exports","orgReducer","collect","monitor","isDragging","getItemType","offset","getClientOffset","item","getItem","top","y","left","x","ToIcon","React","memo","style","color","className","s","icon","path","icons","locate","size","RowDragLayer","props","dragging","useDragLayer","initialRef","useRef","dragTargetRef","elementRef","viewportRef","useEffect","current","undefined","sourceRef","viewport","Error","source","box","getBoundingClientRect","height","width","scrollTop","scrollLeft","getInitialState","initial","diffLeft","diffTop","container","svg","line","x1","y1","x2","y2","makeRefSide","map","side","ids","get","table","rows","editId","realId","name","schema","makeDiagramFromEdit","edit","columns","column","value","items","tables","row","id","idsMap","Map","forEach","set","idsTable","makeIdsMap","refs","ref","from","to","globalFns","globalLogger","addExternalFnDirect","fn","addExternalFn","internalFn","pendingArgs","args","push","length","shift","registerLegacy","registerJson","registerObject","registerBase64","getTableElementId","tableId","getTableElement","element","document","getElementById","HTMLDivElement","getTableEstimatedSize","GRID_CELL","isRowsExpand","Math","min","MAX_ROWS_COUNT","roundPoint","num","round","applyDagreeLayout","diagram","g","dagre","graphlib","Graph","multigraph","setGraph","rankdir","nodesep","TABLE_MARGIN_SINGLE","ranksep","marginx","marginy","setDefaultEdgeLabel","dataset","clientWidth","clientHeight","e","Utils","setNode","toString","label","setEdge","layout","prev","node","position","graph","TABLE_CLIENT_WIDTH","ceil","area","getMasonryLayout","diagrams","nodes","columnsCount","minWidth","reduce","max","Infinity","totalArea","sum","expectedWidth","sqrt","getColumnCount","tops","Array","fill","positions","getAppendPosition","_top","index","leftIndex","start","i","getRangeMaxTop","sort","a","b","target","newHeight","getSize","masonry","right","bottom","window","screen","availWidth","availHeight","getTables","params","translate","originalDiagram","splitDiagram","bigDiagram","done","tableMap","refMap","concat","pushTableToDiagram","state","includes","fromTable","toTable","applyAutoLayout","fallbackSchema","makeTable","raw","makeColumn","makeEditFromDiagram","tuple","makeRef","ajv","Ajv","strictDefaults","strictKeywords","ajvValidate","compile","DiagramRefError","message","refError","validateRefSide","find","isSameSchema","rowId","some","validateSemanticMutable","Set","validateItemsIds","validateRowsIds","filter","error","console","warn","getGenericId","makeId","counter","has","getStringId","prefix","getNumberId","getDefaultRow","valueIds","addRow","payload","update","updateTable","toMaxLeft","getTableNewPosition","getNewSize","importRaw","data","errors","SyntaxError","errorsText","dataVar","validateSchema","next","isAppend","original","t","appendDiagram","importJson","JSON","parse","text","diagramImportReducer","action","type","decoder","TextDecoder","bytes","Uint8Array","atob","c","charCodeAt","decode","importBase64","removeRef","diagramRefReducer","isFromPayload","prevIds","addRef","removeMultipleRefs","isSideRelated","removeRow","isRelated","property","updateEditRow","updateRow","attribute","isSame","removeTable","updateTableName","updateName","diagramTableReducer","addTable","removeMultipleTables","setTablePosition","isExpand","setTableRowsExpand","setAllTablesRowsExpand","webDomains","location","hostname","startsWith","platform","navigator","toLowerCase","PlatformContext","createContext","usePlatform","useContext","registerExternal","emptyDiagram","fallbackDiagram","nullable","parseErrorMessage","join","setDiagram","localStorage","setItem","stringify","useDiagramStorage","stored","alert","getDiagram","useDiagramUndoShortcut","past","future","dispatch","listener","event","ctrlKey","metaKey","HTMLInputElement","HTMLTextAreaElement","key","makeListener","addEventListener","removeEventListener","undoReducer","diagramRowReducer","diagramLayoutReducer","present","slice","useDiagram","diagramDispatch","storage","useReducer","history","storageSet","selectOnRefClick","setSelectIds","refId","getRowElementId","getEdgeSideBoxes","edge","tablePosition","tableTop","tableLeft","getRowElement","offsetTop","offsetLeft","parent","offsetParent","HTMLElement","getOffsetUntil","rowTop","rowLeft","mutationInit","attributes","attributeFilter","getAnchorAxis","A","B","r","abs","getAnchor","isDiagonal","pushPoint","points","C","X","Y","getEdgePath","mid","paths","inners","_","_points","last","getPathD","E","outer","D","getPoints","point","pow","toPoint","getOuterPoint","getEdgePoints","edgesMids","boxes","fromSide","toSide","fromInners","fromOuter","toInners","getEndPoints","midX","getMidPoints","edgesMap","usedMids","midPoints","result","getClosestAvailable","detail","add","avoidMidCollision","getEdgeState","getEdgeBoxes","useEdgeState","changed","setChanged","resize","ResizeObserver","resizeCb","observe","mutation","MutationObserver","records","record","attributeName","mutationCb","disconnect","useEdgeObserve","setState","clearTimeout","setTimeout","newState","getEdgeElementId","edgeId","getEdgeSubElementId","getEdgeSubElement","SVGElement","EdgeHighlight","dot","dur","repeatCount","getClassName","array","isSelected","selected","Edge","d","hitarea","onClick","From","viewBox","refX","refY","markerWidth","markerHeight","markerUnits","cx","cy","To","orient","EdgeMarkers","EdgesCanvas","getTable","tablesMap","edges","useEdgesMids","selectedRefs","onTableDragMove","_event","relatedEdges","relatedEdge","related","setAttribute","updateEdgeElements","onTableDragStop","filterId","getSelectSets","TableBodyAdd","Button","small","flat","isFullWidth","getSibling","isPrevious","previousElementSibling","nextElementSibling","getNextParent","curr","isUp","currParent","closest","nextParent","classList","contains","getChildControl","first","querySelector","all","querySelectorAll","control","getNextControl","isLeft","indexOf","getControlIndex","navigate","preventDefault","wrapper","focus","focusChildControl","navigateViaArrowKeys","background","secondary","borderColor","weak","muted","renderColumn","cls","field","rightField","children","TableBodyHeader","main","blank","iconSize","setIsExpand","doubleChevronLeft","doubleChevronRight","RowDragSource","useDrag","begin","beginDrag","end","_item","getDropResult","endDrag","collectDrag","dragRefCallback","previewRef","getEmptyImage","useState","isHover","setIsHover","isActive","iconNode","selection","circle","onMouseEnter","onMouseLeave","button","TRUE_PREFIX","RowInputBoolean","charAt","setValue","bool","options","Select","timeout","Edit","defaultValue","Input","autoFocus","onBlur","currentTarget","setIsEdit","onKeyDown","onKeyUp","view","viewRef","focusView","viewClass","outline","always","ViewValue","empty","View","tabIndex","onDoubleClick","onFocus","RowInputString","isEdit","internal","updateRowField","RowFieldInput","isRight","getInput","dispatchRemoveRow","RowRemoveButton","remove","Row","useDrop","accept","drop","isOver","dropRef","isEmpty","useRowKeyUpListeners","over","isTableEdit","isTableColumnsExpand","Item","isArray","getRow","bind","edgeMap","getHiddenRows","TableRowsHeadless","getTableRowsEdgeMap","slotCount","prevGroup","groupTableRows","getHideRowsButton","TableHiddenRows","marginTop","count","TableHideRowsButton","RowContainer","isColumnsExpand","TableBodyRows","relatedTarget","HTMLButtonElement","TableBody","header","HeaderName","onMouseDown","clientX","clientY","TableHeaderRemove","primary","cross","TableHeader","onTableBlur","isRowDragging","getCls","strong","toEdgeId","every","TableMain","isMyRow","TableActive","dragRef","onDrag","onStop","nodeRef","scale","zoom","cancel","setSelectId","TableBlank","Field","flex","overflow","textAlign","rowStyle","display","padding","containerProps","lineHeight","borderStyle","borderWidth","headerStyle","fontWeight","HiddenRows","TableInactive","_edgeMap","Table","isVisible","setSelfVisible","setIsVisible","callback","entries","entry","isIntersecting","observer","IntersectionObserver","threshold","root","zIndex","data-name","data-is-visible","isCapture","getInnerTable","getDragBox","startRef","nativeEvent","offsetX","offsetY","setOpacity","opacity","emptyBox","setSize","transform","setDragBoxStyles","boxRef","isTableOverlap","getIds","getOverlapIds","getOverlapTables","getOverlapRefs","setClass","isOverlap","setTempSelect","SVGGElement","getEdgeElement","setContainerStyles","emptyIds","SelectDragLayer","isDraggingRef","containerRef","spaceLockRef","onMouseMove","onMouseUp","boxBg","getContainerStyle","halfMargin","margin","fontSize","toTablesMap","emptyArray","Canvas","useMemo","fromKey","fromEdges","toKey","toEdges","toRelatedEdgesMap","grid","selectedTables","drag","setDrag","dragscroll","reset","me","scrollOption","behavior","block","inline","HeaderAddTable","scrollIntoView","plus","prototype","CSSStyleDeclaration","Object","defineProperty","getPropertyValue","this","getPropertyValueOriginal","endsWith","prefixes","png","getImageData","format","domtoimage","toPng","canvas","toSvg","sleep","Promise","resolve","getExportImageFile","setIsCapture","body","replace","badWords","toBase64","file","clean","word","split","encode","saveExportImageFile","link","createElement","download","href","click","saveWithLink","ext","title","webkit","messageHandlers","postMessage","chrome","webview","exportAsImage","exportSqlDrivers","HeaderExport","actions","disabled","driver","exportAsSql","share","HeaderHistory","undo","redo","selfSamples","loadRemote","url","fetch","then","response","json","HeaderImport","layoutAction","setExpandAndArrange","getActions","HeaderLayout","layoutAuto","caret","getTableRelatedIds","HeaderSearch","_setValue","focusIfNecessary","focusTable","search","placeholder","newValue","list","values","input","flash","moon","HeaderTheme","theme","setTheme","HeaderBigDiv","HeaderZoom","zoomOut","setZoom","select","zoomIn","getStyle","sMac","sWin","ViewHeader","Moai","medium","getHeaderSize","platformPad","diagramPast","diagramFuture","ViewProgress","progress","setProgress","setText","useCanvasCatchCopy","clipboardData","setData","catchCopy","filterIds","useCanvasCatchPaste","getData","catchPaste","initialTheme","documentElement","useTheme","getInitial","setIds","useSelect","useDragToScroll","stopPropagation","catchDelete","TPLink","rel","FooterLinks","tptop","nobreak","FooterPrivacy","dataText","Logo","logo","alt","src","Footer","App","scrollbar","custom","footer","useReportItem","setHas","ReportItem","ErrorReport","isUncaught","contact","log","sending","setSending","report","method","headers","onDone","description","highlight","backdrop","onClickOutside","Description","reload","ErrorWrapper","ErrorBoundary","hasError","clear","Diagram","Logger","Root","setPlatform","usePlatformProvider","StrictMode","Provider","HTML5toTouch","ReactDOM","render"],"mappings":"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","file":"static/js/main.d20394fe.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"marker_container__1M8sa\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"body_container__3oC6s\",\"header\":\"body_header__jV-GI\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"row_container__2yTZp\",\"over\":\"row_over__2gC30\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"name_container__1o8SY\",\"view\":\"name_view__15GrF\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"canvas_container__3Y18v\",\"grid\":\"canvas_grid__nkChd\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"progress_container__1kfqj\",\"body\":\"progress_body__2EtDz\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"footer_container__3MvUg\",\"logo\":\"footer_logo__3qLuS\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"canvas_container__KH5yw\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"active_container__3joLV\",\"react-draggable-dragging\":\"active_react-draggable-dragging__1JdPr\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"add_container__2lSlZ\",\"slide-in\":\"add_slide-in__2Hk9K\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"boolean_container__1bqLB\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"right\":\"field_right__3YAJ4\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"remove_container__Ts2Bx\",\"slide-in\":\"remove_slide-in__3caLT\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"remove_container__2HEZR\",\"win-background\":\"remove_win-background__WJQ6a\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"blank_container__3L-Iq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"mac_container__YDixB\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"win_container__Ote90\"};","module.exports = \"data:image/png;base64,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\"","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"privacy_container__1BD1S\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"edge_container__1EyW3\",\"from\":\"edge_from__1Ovs9\",\"to\":\"edge_to__3E3uJ\",\"path\":\"edge_path__x4S4v\",\"dot\":\"edge_dot__2KuhC\",\"selected\":\"edge_selected__1Gpep\",\"hitarea\":\"edge_hitarea__3Airq\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"report_container__2lwO5\",\"backdrop\":\"report_backdrop__3x5uS\",\"main\":\"report_main__9yJhe\",\"body\":\"report_body__1p5xp\",\"footer\":\"report_footer__1K0r-\",\"title\":\"report_title__3w0zK\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"links_container__1D7C_\",\"nobreak\":\"links_nobreak__2Iiva\"};","import { debugLog } from \"utils/debug\";\nimport React from \"react\";\n\nexport interface UndoState<S> {\n    past: S[];\n    present: S;\n    future: S[];\n}\n\nexport type UndoAction = { type: \"undo\" } | { type: \"redo\" };\n\nexport const createUndoInitial = <S>(initial: S): UndoState<S> => ({\n    past: [],\n    present: initial,\n    future: [],\n});\n\ntype Action = { type: string };\n\nexport const createUndoReducer = <S, A extends Action>(\n    orgReducer: React.Reducer<S, A>\n) => (prev: UndoState<S>, action: UndoAction | A): UndoState<S> => {\n    switch (action.type) {\n        case \"undo\": {\n            const [present, ...past] = prev.past;\n            const future = [prev.present, ...prev.future];\n            return { past, present, future };\n        }\n        case \"redo\": {\n            const [present, ...future] = prev.future;\n            const past = [prev.present, ...prev.past];\n            return { past, present, future };\n        }\n        default: {\n            debugLog(\"Undo create new past\");\n            const present = orgReducer(prev.present, action as any);\n            let past = [prev.present, ...prev.past];\n            past = past.length < 20 ? past : past.slice(0, 20);\n            return { past, present, future: [] };\n        }\n    }\n};\n","import React from \"react\";\nimport { useDragLayer, DragLayerMonitor } from \"react-dnd\";\nimport { icons } from \"@moai/icon\";\nimport { Icon } from \"@moai/core\";\nimport s from \"./layer.module.scss\";\nimport { RowDragItem } from \"../drag\";\nimport { debugLog } from \"utils/debug\";\n\ninterface DraggingProps {\n    item: RowDragItem;\n    top: number;\n    left: number;\n}\n\nconst collect = (monitor: DragLayerMonitor): DraggingProps | null => {\n    if (!monitor.isDragging()) return null;\n    if (monitor.getItemType() !== \"row\") return null;\n    const offset = monitor.getClientOffset();\n    const item = monitor.getItem();\n    if (item === null || offset === null) return null;\n    return { item, top: offset.y, left: offset.x };\n};\n\ninterface InitialState {\n    scrollLeft: number;\n    scrollTop: number;\n    top: number;\n    left: number;\n}\n\ninterface Props {\n    viewportRef: React.RefObject<HTMLDivElement>;\n}\n\nconst getInitialState = (\n    viewportRef: React.RefObject<HTMLDivElement>,\n    sourceRef: React.RefObject<HTMLDivElement>\n): InitialState => {\n    const viewport = viewportRef.current;\n    if (viewport === null) throw Error(\"Viewport is not defined\");\n    const source = sourceRef.current;\n    if (source === null) throw Error(\"Source drag is not defined\");\n    const box = source.getBoundingClientRect();\n    const [top, left] = [box.top + box.height / 2, box.left + box.width / 2];\n    const { scrollTop, scrollLeft } = viewport;\n    return { top, left, scrollTop, scrollLeft };\n};\n\nconst ToIconPure = ({ top, left }: { top: number; left: number }) => (\n    <div style={{ color: \"var(--accent-2)\" }}>\n        <div className={s.icon} style={{ top: top - 8, left: left - 8 }}>\n            <Icon path={icons.locate} size={16} />\n        </div>\n    </div>\n);\n\nconst ToIcon = React.memo(ToIconPure);\n\nconst RowDragLayerPure = (props: Props) => {\n    debugLog(\"RowDragLayer\");\n\n    const dragging = useDragLayer(collect);\n    const initialRef = React.useRef<InitialState | null>(null);\n\n    // Reset initial state based on is dragging or not\n    const dragTargetRef = dragging?.item.elementRef;\n    const { viewportRef } = props;\n    React.useEffect(() => {\n        initialRef.current =\n            dragTargetRef === undefined\n                ? null\n                : getInitialState(viewportRef, dragTargetRef);\n    }, [viewportRef, dragTargetRef]);\n\n    const initial = initialRef.current;\n    if (dragging === null || initial === null) return null;\n    const viewport = props.viewportRef.current;\n    if (viewport === null) throw Error(\"viewport is not defined\");\n\n    const diffLeft = viewport.scrollLeft - initial.scrollLeft;\n    const diffTop = viewport.scrollTop - initial.scrollTop;\n\n    return (\n        <div className={s.container}>\n            <svg className={s.svg}>\n                <line\n                    className={s.line}\n                    x1={initial.left - diffLeft}\n                    y1={initial.top - diffTop}\n                    x2={dragging.left}\n                    y2={dragging.top}\n                />\n            </svg>\n            <ToIcon top={dragging.top} left={dragging.left} />\n        </div>\n    );\n};\n\nexport const RowDragLayer = React.memo(RowDragLayerPure);\n","import * as Raw from \"../../diagram\";\nimport * as Edit from \"../edit\";\n\n// Prepared maps from EDIT ids to [name, schema] to speed up EditRef conversion\ntype Ids = {\n    table: { name: string; schema: string | undefined };\n    rows: Map<number, string>;\n};\ntype IdsMap = Map<number, Ids>;\n\nconst makeIdsMap = (tables: Edit.EditTable[]): IdsMap => {\n    const idsMap = new Map<number, Ids>();\n    tables.forEach((table) => {\n        const rows = new Map<number, string>();\n        table.value.rows.forEach((row) => void rows.set(row.id, row.value.id));\n        const idsTable = { name: table.value.name, schema: table.value.schema };\n        idsMap.set(table.id, { table: idsTable, rows });\n    });\n    return idsMap;\n};\n\nconst makeRefSide = (map: IdsMap, side: Edit.EditRefSide): Raw.RefSide => {\n    const ids = map.get(side.table);\n    if (!ids) throw Error(`Table Ids \"${side.table}\" not found`);\n    const rows = side.rows.map((editId) => {\n        const realId = ids.rows.get(editId);\n        if (!realId) throw Error(`Row id \"${editId}\" not found`);\n        return realId;\n    });\n    const { name, schema } = ids.table;\n    return { name, schema, rows };\n};\n\nexport const makeDiagramFromEdit = (edit: Edit.EditDiagram): Raw.Diagram => {\n    const columns: Raw.Column[] = edit.columns.map((column) => column.value);\n    const items: Raw.Item[] = edit.tables.map((table) => {\n        const rows: Raw.Row[] = table.value.rows.map((row) => row.value);\n        const { id, name, schema } = table.value;\n        return { id, name, schema, rows };\n    });\n    const idsMap = makeIdsMap(edit.tables);\n    const refs: Raw.Ref[] = edit.refs.map((ref) => ({\n        from: makeRefSide(idsMap, ref.from),\n        to: makeRefSide(idsMap, ref.to),\n    }));\n    return { columns, items, refs, schema: edit.schema };\n};\n","type VoidFn = (...args: any[]) => void;\n\n// Functions for outside to use\nconst globalFns: { [name: string]: Function } = {};\n\nexport const globalLogger: [string, any][] = [[\"Initialized\", {}]];\n\nexport const addExternalFnDirect = (name: string, fn: Function) => {\n    globalFns[name] = fn;\n};\n\nexport const addExternalFn = (name: string): ((fn: VoidFn) => void) => {\n    let internalFn: VoidFn | null = null;\n    const pendingArgs: any[][] = [];\n\n    // External\n    const externalFn = (...args: any[]) => {\n        if (internalFn !== null) {\n            globalLogger.push([\"Execute\", args]);\n            return internalFn(...args);\n        } else {\n            globalLogger.push([\"Pending\", args]);\n            pendingArgs.push(args);\n        }\n    };\n    globalFns[name] = externalFn;\n\n    // Register\n    const registerFn = (fn: VoidFn) => {\n        internalFn = fn;\n        while (pendingArgs.length > 0) {\n            const args = pendingArgs.shift();\n            globalLogger.push([\"Execute pending item\", args]);\n            (internalFn as VoidFn)(...args);\n        }\n    };\n    return registerFn;\n};\n\nexport const initExternalFns = () => {\n    (window as any).Diagram = globalFns;\n    (window as any).Logger = globalLogger;\n};\n","import { makeDiagramFromEdit } from \"diagram/edit/convert/from\";\nimport React from \"react\";\nimport { addExternalFn, addExternalFnDirect } from \"utils/external\";\nimport { EditDiagram } from \"../../edit/edit\";\nimport {\n    ImportBase64Payload,\n    ImportJsonPayload,\n} from \"../reducer/import/import\";\nimport { ImportRawPayload } from \"../reducer/import/raw\";\nimport { DiagramAction } from \"../reducer/reducer\";\n\nconst registerLegacy = addExternalFn(\"importDiagram\");\nconst registerJson = addExternalFn(\"importDiagramJSON\");\nconst registerObject = addExternalFn(\"importDiagramObject\");\nconst registerBase64 = addExternalFn(\"importDiagramBase64\");\n\nexport const useDiagramExternal = (\n    diagram: EditDiagram,\n    diagramDispatch: React.Dispatch<DiagramAction>\n) => {\n    React.useEffect(() => {\n        registerLegacy((text: string) => {\n            const payload: ImportJsonPayload = { text, isAppend: false };\n            diagramDispatch({ type: \"import-json\", payload });\n        });\n        registerJson((text: string) => {\n            const payload: ImportJsonPayload = { text, isAppend: false };\n            diagramDispatch({ type: \"import-json\", payload });\n        });\n        registerObject((raw: object) => {\n            const payload: ImportRawPayload = { raw, isAppend: false };\n            diagramDispatch({ type: \"import-raw\", payload });\n        });\n        registerBase64((text: string) => {\n            const payload: ImportBase64Payload = { text, isAppend: false };\n            diagramDispatch({ type: \"import-base64\", payload });\n        });\n    }, [diagramDispatch]);\n\n    React.useEffect(() => {\n        addExternalFnDirect(\"exportDiagram\", () => {\n            return JSON.stringify(makeDiagramFromEdit(diagram));\n        });\n    }, [diagram]);\n};\n","import { EditTable } from \"diagram/edit/edit\";\n\nexport const MAX_ROWS_COUNT = 50;\nexport const GRID_CELL = 16;\nexport const TABLE_CLIENT_WIDTH = GRID_CELL * 14;\n// When expand (edit mode) Table will take 2xGRID_CELL each side\nexport const TABLE_MARGIN_SINGLE = GRID_CELL * 2 + GRID_CELL;\nexport const TABLE_MARGIN_DOUBLE = TABLE_MARGIN_SINGLE * 2;\nexport const TABLE_OFFSET_WIDTH = TABLE_CLIENT_WIDTH + TABLE_MARGIN_DOUBLE;\n\nexport const getTableElementId = (tableId: number) => `table . ${tableId}`;\n\nexport const getTableElement = (tableId: number): HTMLDivElement => {\n    const element = document.getElementById(getTableElementId(tableId));\n    if (element instanceof HTMLDivElement) return element;\n    throw Error(\"Element is not HTMLDivElement\");\n};\n\ninterface Size {\n    width: number;\n    height: number;\n}\n\nexport const getTableEstimatedSize = (table: EditTable): Size => {\n    // We hide rows when there are more\n    const count = table.isRowsExpand\n        ? table.value.rows.length\n        : Math.min(table.value.rows.length, MAX_ROWS_COUNT + 1);\n    // Use an estimated value based on the number of rows (these values\n    // come from manually measuring the initial render)\n    return { width: TABLE_CLIENT_WIDTH, height: count * 24 + 64 };\n};\n\nexport const getTableSize = (table: EditTable): Size => {\n    // Try to get exact size if possible\n    try {\n        const element = getTableElement(table.id);\n        // Double check to avoid using one from previous diagram. This happens\n        // when import a new layout\n        if (element.dataset.name !== table.value.name)\n            throw Error(\"Outdated table from previous diagram\");\n        return { width: element.clientWidth, height: element.clientHeight };\n    } catch (e) {\n        // If can't find the element then use estimated size\n        // (This happens when the algo is run before rendering, like in import)\n        return getTableEstimatedSize(table);\n    }\n};\n","import * as Utils from \"app/table/utils\";\nimport dagre from \"dagre\";\nimport { TablePosition } from \"diagram/edit/layout\";\nimport { LayoutDiagram } from \"./layout\";\n\nconst roundPoint = (num: number) => Math.round(num / 8) * 8;\nconst roundWidth = (num: number) =>\n    Math.ceil(num / Utils.TABLE_OFFSET_WIDTH) * Utils.TABLE_OFFSET_WIDTH;\n\nexport const applyDagreeLayout = (diagram: LayoutDiagram): LayoutDiagram => {\n    const g = new dagre.graphlib.Graph({ multigraph: true });\n    g.setGraph({\n        rankdir: \"LR\",\n        nodesep: Utils.TABLE_MARGIN_DOUBLE,\n        ranksep: Utils.TABLE_MARGIN_DOUBLE,\n        marginx: Utils.TABLE_MARGIN_SINGLE,\n        marginy: Utils.TABLE_MARGIN_SINGLE,\n    });\n    g.setDefaultEdgeLabel(() => ({}));\n\n    // nodes\n    diagram.tables.forEach((table) => {\n        const { width, height } = Utils.getTableSize(table);\n        g.setNode(table.id.toString(), { label: \"\", width, height });\n    });\n\n    // edges\n    diagram.refs.forEach((ref) => {\n        g.setEdge(ref.from.table.toString(), ref.to.table.toString());\n    });\n\n    dagre.layout(g);\n\n    return {\n        tables: diagram.tables.map((prev) => {\n            const box = g.node(prev.id.toString()); // @TODO check undefined?\n            // Note that dagre's x y is center, not top left\n            const position: TablePosition = { top: 0, left: 0 };\n            position.top = roundPoint(box.y - box.height / 2);\n            position.left = roundPoint(box.x - box.width / 2);\n            return { ...prev, position };\n        }),\n        refs: diagram.refs,\n        size: {\n            width: roundWidth(g.graph().width ?? -1), // @TODO throw Error?\n            height: roundPoint(g.graph().height ?? -1),\n        },\n    };\n};\n","import { TABLE_OFFSET_WIDTH } from \"app/table/utils\";\nimport { LayoutDiagram } from \"./layout\";\n\ninterface Position {\n    top: number;\n    left: number;\n}\n\ninterface AppendPosition {\n    top: number;\n    leftIndex: number;\n}\n\nexport interface MasonryNode {\n    id: number;\n    width: number;\n    height: number;\n}\n\nexport type MasonryMap = Map<number, Position>;\n\nconst area = (node: MasonryNode) => node.height * node.width;\n\n// Try to make a 2:1 rectangle\nconst getColumnCount = (nodes: MasonryNode[]): number => {\n    // Should be bigger than the biggest node's width\n    const minWidth = nodes.reduce((max, node) => {\n        return max > node.width ? max : node.width;\n    }, -Infinity);\n    // Total area\n    const totalArea = nodes.reduce((sum, node) => sum + area(node), 0);\n    const expectedWidth = Math.sqrt(totalArea / 2) * 2;\n    const width = Math.max(expectedWidth, minWidth);\n    // 1 column is TABLE_OFFSET_WIDTH px wide\n    return Math.ceil(width / TABLE_OFFSET_WIDTH);\n};\n\nexport const getMasonryLayout = (diagrams: LayoutDiagram[]): MasonryMap => {\n    const nodes: MasonryNode[] = diagrams.map((diagram) => ({\n        id: diagram.tables[0].id,\n        width: diagram.size.width,\n        height: diagram.size.height,\n    }));\n\n    const columnsCount = getColumnCount(nodes);\n    const tops = Array(columnsCount).fill(0);\n    const positions = new Map<number, Position>();\n\n    // Max top is the actual top if a target of \"width\" is put at \"start\"\n    const getRangeMaxTop = (start: number, columns: number): number => {\n        if (start + columns > tops.length) return Infinity;\n        let max = -Infinity;\n        for (let i = 0; i < columns; i++) {\n            const top = tops[start + i];\n            max = Math.max(top, max);\n        }\n        return max;\n    };\n\n    const getAppendPosition = (columns: number): AppendPosition => {\n        // Actual top if put target at \"index\"\n        const candidates = tops.map((_top, index) => {\n            const height = getRangeMaxTop(index, columns);\n            return { leftIndex: index, top: height };\n        });\n        // Pick the one with smallest top\n        return candidates.reduce((prev, current) =>\n            current.top < prev.top ? current : prev\n        );\n    };\n\n    const appendTarget = (target: MasonryNode) => {\n        const columns = target.width / TABLE_OFFSET_WIDTH;\n        const position = getAppendPosition(columns);\n        // Update \"tops\" map\n        const newHeight = position.top + target.height;\n        for (let i = 0; i < columns; i++) {\n            tops[position.leftIndex + i] = newHeight;\n        }\n        // Set position\n        positions.set(target.id, {\n            left: position.leftIndex * TABLE_OFFSET_WIDTH,\n            top: position.top,\n        });\n    };\n\n    nodes\n        .sort((a, b) => area(b) - area(a)) // Put big table first\n        .forEach(appendTarget);\n    return positions;\n};\n","import {\n    TABLE_MARGIN_DOUBLE as MARGIN_DOUBLE,\n    TABLE_MARGIN_SINGLE as MARGIN_SINGLE,\n} from \"app/table/utils\";\nimport { EditDiagram, EditTable } from \"diagram/edit/edit\";\nimport { TablePosition } from \"diagram/edit/layout\";\nimport { LayoutDiagram } from \"./layout\";\nimport { MasonryMap } from \"./masonry\";\n\ninterface Params {\n    originalDiagram: EditDiagram;\n    diagrams: LayoutDiagram[];\n    masonry: MasonryMap;\n}\n\ninterface Size {\n    width: number;\n    height: number;\n}\n\nconst getSize = ({ diagrams, masonry }: Params): Size => {\n    let [width, height] = [0, 0];\n    diagrams.forEach((diagram) => {\n        const position = masonry.get(diagram.tables[0].id);\n        if (position === undefined) throw Error(`position is undefined`);\n        const right = position.left + diagram.size.width;\n        width = Math.max(width, right);\n        const bottom = position.top + diagram.size.height;\n        height = Math.max(height, bottom);\n    });\n    [width, height] = [width + MARGIN_DOUBLE, height + MARGIN_DOUBLE];\n\n    // Scrollbar is 16 - 20px\n    width = Math.max(window.screen.availWidth - 20, width);\n    height = Math.max(window.screen.availHeight, height);\n\n    return { width, height };\n};\n\nconst getTables = (params: Params): EditTable[] => {\n    const tables: EditTable[] = [];\n    params.diagrams.forEach((diagram) => {\n        const translate = params.masonry.get(diagram.tables[0].id);\n        if (translate === undefined) throw Error(\"translate is undefined\");\n        diagram.tables.forEach((prev) => {\n            const position: TablePosition = {\n                top: translate.top + prev.position.top + MARGIN_SINGLE,\n                left: translate.left + prev.position.left + MARGIN_SINGLE,\n            };\n            tables.push({ ...prev, position });\n        });\n    });\n    if (tables.length === params.originalDiagram.tables.length) return tables;\n    throw Error(\"new tables and old tables have different length\");\n};\n\nexport const mergeDiagram = (params: Params): EditDiagram => ({\n    columns: params.originalDiagram.columns,\n    tables: getTables(params),\n    refs: params.originalDiagram.refs,\n    size: getSize(params),\n    schema: params.originalDiagram.schema,\n});\n","import { EditDiagram, EditRef, EditTable } from \"diagram/edit/edit\";\nimport { applyDagreeLayout } from \"./dagree\";\nimport { LayoutDiagram } from \"./layout\";\n\ninterface State {\n    diagram: LayoutDiagram;\n    done: Map<number, boolean>;\n    tableMap: Map<number, EditTable>;\n    refMap: Map<number, EditRef[]>;\n}\n\nconst pushTableToDiagram = (state: State, table: EditTable): void => {\n    const { diagram, done, refMap, tableMap } = state;\n    if (done.get(table.id) === true) return;\n    diagram.tables.push(table);\n    refMap.get(table.id)?.forEach((ref) => {\n        if (diagram.refs.includes(ref)) return;\n        diagram.refs.push(ref);\n    });\n    done.set(table.id, true);\n    (refMap.get(table.id) ?? []).forEach((ref) => {\n        const fromTable = tableMap.get(ref.from.table);\n        const toTable = tableMap.get(ref.to.table);\n        if (fromTable === undefined || toTable === undefined)\n            throw Error(`\"fromTable\" or \"toTable\" is undefined`);\n        pushTableToDiagram(state, fromTable);\n        pushTableToDiagram(state, toTable);\n    });\n};\n\n/**\n * Split a Diagram into a group of diagrams where each diagram only contains\n * nodes that are connected to each other (from one node can go to another).\n */\nexport const splitDiagram = (bigDiagram: EditDiagram): LayoutDiagram[] => {\n    // Sub diagrams split from bigDiagram\n    const diagrams: LayoutDiagram[] = [];\n    // Tables that are put into a sub diagram\n    const done = new Map<number, boolean>();\n\n    // Table id to instance for quick reference\n    const tableMap = new Map<number, EditTable>();\n    bigDiagram.tables.forEach((table) => {\n        tableMap.set(table.id, table);\n    });\n\n    // Table id to related refs for quick reference\n    const refMap = new Map<number, EditRef[]>();\n    bigDiagram.refs.forEach((ref) => {\n        const [from, to] = [ref.from.table, ref.to.table];\n        refMap.set(from, (refMap.get(from) ?? []).concat(ref));\n        refMap.set(to, (refMap.get(to) ?? []).concat(ref));\n    });\n\n    bigDiagram.tables.forEach((table) => {\n        if (done.get(table.id) === true) return;\n        const size = { width: 0, height: 0 }; // Will provide later\n        const diagram: LayoutDiagram = { tables: [], refs: [], size };\n        pushTableToDiagram({ diagram, done, tableMap, refMap }, table);\n        diagrams.push(diagram);\n    });\n\n    diagrams.forEach((diagram) => {\n        applyDagreeLayout(diagram);\n    });\n\n    return diagrams;\n};\n","import * as Edit from \"diagram/edit/edit\";\nimport { DiagramSize } from \"diagram/edit/layout\";\nimport { applyDagreeLayout } from \"./dagree\";\nimport { getMasonryLayout } from \"./masonry\";\nimport { mergeDiagram } from \"./merge\";\nimport { splitDiagram } from \"./split\";\n\n/**\n * Like EditDiagram but only contains enough data for layout purpose. Most\n * notably there is no \"columns\".\n */\nexport interface LayoutDiagram {\n    refs: Edit.EditRef[];\n    tables: Edit.EditTable[];\n    size: DiagramSize;\n}\n\n// Split -> Dagree -> Masonry -> Merge\nexport const applyAutoLayout = (\n    originalDiagram: Edit.EditDiagram\n): Edit.EditDiagram => {\n    // Split the diagram into sub diagrams\n    let diagrams = splitDiagram(originalDiagram);\n    // Arrange each diagram with dagree\n    diagrams = diagrams.map(applyDagreeLayout);\n    // Arrange sub diagrams into a big canvas\n    const masonry = getMasonryLayout(diagrams);\n    // Merge sub diagrams back into one diagram\n    return mergeDiagram({ originalDiagram, masonry, diagrams });\n};\n","import * as Raw from \"diagram/diagram\";\nimport * as Edit from \"diagram/edit/edit\";\nimport { applyAutoLayout } from \"diagram/layout/layout\";\n\n// Prepared maps from table's [name, schema] to EDIT ids to speed up EditRef\n// conversion\ntype Ids = { table: number; rows: Map<string, number> };\ntype IdsMap = Map<string, Ids>; // string here is \"<schema> . <name>\"\n\nconst makeIdsMap = (\n    fallbackSchema: string,\n    tables: Edit.EditTable[]\n): IdsMap => {\n    const idsMap = new Map<string, Ids>();\n    tables.forEach((table) => {\n        const rows = new Map<string, number>();\n        table.value.rows.forEach((row) => void rows.set(row.value.id, row.id));\n        const schema = table.value.schema ?? fallbackSchema;\n        const tuple = `${schema} . ${table.value.name}`;\n        idsMap.set(tuple, { table: table.id, rows });\n    });\n    return idsMap;\n};\n\nconst makeRefSide = (\n    fallbackSchema: string,\n    map: IdsMap,\n    side: Raw.RefSide\n): Edit.EditRefSide => {\n    const schema = side.schema ?? fallbackSchema;\n    const ids = map.get(`${schema} . ${side.name}`);\n    if (ids === undefined) throw Error(`Table Ids \"${side.name}\" not found`);\n    const rows = side.rows.map((editId) => {\n        const realId = ids.rows.get(editId);\n        if (realId === undefined) throw Error(`Row id \"${editId}\" not found`);\n        return realId;\n    });\n    return { table: ids.table, rows };\n};\n\nconst makeTable = (raw: Raw.Item, index: number): Edit.EditTable => {\n    const rows = raw.rows.map((value, id) => ({ id, value }));\n    const { name, id, schema } = raw;\n    const value: Edit.EditTableValue = { rows, name, id, schema };\n    const position = { top: 0, left: 0 }; // we will provide below\n    return { value, position, id: index, isRowsExpand: false };\n};\n\nconst makeColumn = (raw: Raw.Column, index: number): Edit.EditColumn => {\n    return { id: index, value: raw };\n};\n\nconst makeRef = (schema: string, idsMap: IdsMap) => {\n    return (raw: Raw.Ref, index: number): Edit.EditRef => ({\n        id: index,\n        from: makeRefSide(schema, idsMap, raw.from),\n        to: makeRefSide(schema, idsMap, raw.to),\n    });\n};\n\nexport const makeEditFromDiagram = (diagram: Raw.Diagram): Edit.EditDiagram => {\n    const schema = diagram.schema;\n    const columns: Edit.EditColumn[] = diagram.columns.map(makeColumn);\n    const tables: Edit.EditTable[] = diagram.items.map(makeTable);\n    const idsMap = makeIdsMap(schema, tables);\n    const refs: Edit.EditRef[] = diagram.refs.map(makeRef(schema, idsMap));\n    const size = { width: 0, height: 0 };\n    const edit: Edit.EditDiagram = { tables, refs, columns, size, schema };\n    return applyAutoLayout(edit);\n};\n","import Ajv from \"ajv\";\nimport { Diagram } from \"diagram/diagram\";\nimport schema from \"./schema.json\";\n\nconst ajv = new Ajv({ strictDefaults: true, strictKeywords: true });\nconst ajvValidate = ajv.compile(schema);\n\nexport const validateSchema = (data: Diagram) => {\n    const valid = ajvValidate(data);\n    if (valid) return true;\n    const { errors } = ajvValidate;\n    throw SyntaxError(ajv.errorsText(errors, { dataVar: \"diagram\" }));\n};\n","import { Diagram, Item, RefSide } from \"../diagram\";\n\n// ReferenceError of reference... sorry for the naming\nclass DiagramRefError extends Error {\n    constructor(message: string) {\n        super(message);\n        this.name = \"DiagramRefError\";\n    }\n}\n\nconst refError = (name: string, target: string) => {\n    return new DiagramRefError(`${name} has an invalid reference to ${target}`);\n};\n\nconst isSameSchema = (diagram: Diagram, side: RefSide, item: Item): boolean => {\n    const a = side.schema ?? diagram.schema;\n    const b = item.schema ?? diagram.schema;\n    return a === b;\n};\n\nconst validateRefSide = (diagram: Diagram, side: RefSide, index: number) => {\n    const table = diagram.items.find((item) => {\n        return item.name === side.name && isSameSchema(diagram, side, item);\n    });\n    if (!table) throw refError(`Ref #${index}`, `table \"${side.name}\"`);\n    side.rows.forEach((rowId) => {\n        if (table.rows.some((row) => row.id === rowId)) return;\n        throw refError(`Ref #${index}.rows`, `row \"${rowId}\"`);\n    });\n};\n\nconst validateRowsIds = (item: Item) => {\n    const ids = item.rows.map((row) => row.id);\n    if (new Set(ids).size === ids.length) return;\n    throw Error(`tables.${item.id}.rows.ids are not unique`);\n};\n\nconst validateItemsIds = (diagram: Diagram) => {\n    const ids = diagram.items.map((item) => item.id);\n    if (new Set(ids).size === ids.length) return;\n    throw Error(\"items.ids are not unique\");\n};\n\n/**\n * Mutable because it also tries to fix recoverable issues like ref with\n * invalid references\n */\nexport const validateSemanticMutable = (diagram: Diagram): void => {\n    // tables\n    validateItemsIds(diagram);\n    diagram.items.forEach((item) => {\n        validateRowsIds(item);\n    });\n    // refs\n    diagram.refs = diagram.refs.filter((ref, index) => {\n        try {\n            validateRefSide(diagram, ref.from, index);\n            validateRefSide(diagram, ref.to, index);\n        } catch (error) {\n            // When a ref has invalid references, we simply remove it instead\n            // of throwing error\n            if (error instanceof DiagramRefError) {\n                console.warn(error);\n                return false;\n            }\n            throw error;\n        }\n        return true;\n    });\n};\n","const getGenericId = <T>(ids: T[], makeId: (counter: number) => T): T => {\n    const set = new Set(ids);\n    let counter = 1;\n    let id = makeId(counter);\n    while (set.has(id)) {\n        counter = counter + 1;\n        id = makeId(counter);\n    }\n    return id;\n};\n\nexport const getStringId = (ids: string[], prefix: string) =>\n    getGenericId(ids, (counter) =>\n        counter === 1 ? prefix : `${prefix}_${counter}`\n    );\n\nexport const getNumberId = (ids: number[]) =>\n    getGenericId(ids, (counter) => counter);\n","import { EditColumn, EditTable, EditRow } from \"diagram/edit/edit\";\nimport { DiagramReducer } from \"../reducer\";\nimport { getStringId, getNumberId } from \"../id\";\n\nexport interface AddRowPayload {\n    tableId: number;\n}\n\ntype Payload = AddRowPayload;\n\nexport const getDefaultField = (column: EditColumn) => {\n    switch (column.value.type) {\n        case \"boolean\":\n            return false;\n        case \"string\":\n            return \"\";\n    }\n};\n\nexport const getDefaultRow = (rows: EditRow[]): EditRow => {\n    const valueIds = rows.map((row) => row.value.id);\n    return {\n        id: getNumberId(rows.map((row) => row.id)),\n        value: { id: getStringId(valueIds, \"column\") },\n    };\n};\n\nconst updateTable = (payload: Payload, columns: EditColumn[]) => {\n    return (table: EditTable): EditTable => {\n        if (table.id !== payload.tableId) return table;\n        const row = getDefaultRow(table.value.rows);\n        const rows = table.value.rows.concat(row);\n        return { ...table, value: { ...table.value, rows } };\n    };\n};\n\nexport const addRow: DiagramReducer<Payload> = (diagram, payload) => {\n    const update = updateTable(payload, diagram.columns);\n    return { ...diagram, tables: diagram.tables.map(update) };\n};\n","import { TABLE_CLIENT_WIDTH, TABLE_MARGIN_DOUBLE } from \"app/table/utils\";\nimport * as Edit from \"diagram/edit/edit\";\nimport { DiagramSize, TablePosition } from \"diagram/edit/layout\";\nimport { getNumberId, getStringId } from \"../id\";\nimport { DiagramReducer } from \"../reducer\";\nimport { getDefaultRow } from \"../row/add\";\n\nexport interface AddTablePayload {\n    id?: number;\n}\n\ntype Payload = AddTablePayload;\n\nconst toMaxLeft = (prev: number, table: Edit.EditTable) =>\n    Math.max(table.position.left, prev);\n\nconst leftToRight = TABLE_CLIENT_WIDTH + TABLE_MARGIN_DOUBLE;\n\n// For now we will just put it on the right side of the most right table\nexport const getTableNewPosition = (\n    tables: Edit.EditTable[]\n): TablePosition => {\n    const maxLeft = tables.reduce(toMaxLeft, 0);\n    return { top: TABLE_MARGIN_DOUBLE, left: maxLeft + leftToRight };\n};\n\nconst getNewSize = (\n    size: DiagramSize,\n    position: TablePosition\n): DiagramSize => {\n    const width = Math.max(size.width, position.left + leftToRight);\n    return width === size.width ? size : { ...size, width };\n};\n\nexport const addTable: DiagramReducer<Payload> = (diagram, payload) => {\n    // value\n    const valueIds = diagram.tables.map((table) => table.value.id);\n    const name = getStringId(valueIds, \"table\");\n    const row = getDefaultRow([]);\n    // edit table\n    const table: Edit.EditTable = {\n        id: payload.id ?? getNumberId(diagram.tables.map((table) => table.id)),\n        value: { name, id: name, schema: \"new\", rows: [row] },\n        position: getTableNewPosition(diagram.tables),\n        isRowsExpand: false,\n    };\n    return {\n        ...diagram,\n        tables: diagram.tables.concat(table),\n        size: getNewSize(diagram.size, table.position),\n    };\n};\n","import { Diagram } from \"diagram/diagram\";\nimport { makeEditFromDiagram } from \"diagram/edit/convert/to\";\nimport { validateSchema } from \"diagram/schema/schema\";\nimport { validateSemanticMutable } from \"diagram/schema/semantic\";\nimport { DiagramReducer } from \"../reducer\";\nimport { appendDiagram } from \"./append\";\nimport { ImportPayload } from \"./import\";\n\nexport interface ImportRawPayload extends ImportPayload {\n    raw: object;\n}\n\ntype Payload = ImportRawPayload;\n\nexport const importRaw: DiagramReducer<Payload> = (prev, payload) => {\n    const raw = payload.raw as Diagram;\n    // This throws error if the payload is not valid (e.g. typo). For now we\n    // will just let it goes up to trigger the global error catcher since it's\n    // not recoverable\n    validateSchema(raw);\n    validateSemanticMutable(raw); // This may MUTATE the diagram\n    const next = makeEditFromDiagram(raw);\n    if (!payload.isAppend) return next;\n    return appendDiagram(prev, next);\n};\n","import { TABLE_MARGIN_DOUBLE } from \"app/table/utils\";\nimport { EditDiagram } from \"diagram/edit/edit\";\nimport { DiagramSize, TablePosition } from \"diagram/edit/layout\";\nimport { getNumberId } from \"../id\";\nimport { getTableNewPosition } from \"../table/add\";\n\nexport const appendDiagram = (\n    original: EditDiagram,\n    target: EditDiagram\n): EditDiagram => {\n    if (original.columns.length !== target.columns.length)\n        throw Error(\"Cannot merge diagrams with different columns\");\n\n    const ids = original.tables.map((t) => t.id);\n\n    // @TODO should not have this fix\n    const offset = getTableNewPosition(original.tables);\n    offset.top = offset.top - TABLE_MARGIN_DOUBLE;\n    offset.left = offset.left - TABLE_MARGIN_DOUBLE;\n\n    const tables = [...original.tables];\n    target.tables.forEach((table) => {\n        // @TODO this is slow because we need to create new ids everytime\n        // a faster way should be letting getId to accept Set\n        const id = getNumberId(ids);\n        ids.push(id); // Avoid using this id next time\n        const position: TablePosition = {\n            top: table.position.top + offset.top,\n            left: table.position.left + offset.left,\n        };\n        tables.push({ ...table, id, position });\n    });\n\n    const width = offset.left + target.size.width;\n    const size: DiagramSize = { ...original.size, width };\n    return { ...original, tables, size };\n};\n","import { DiagramReducer } from \"../reducer\";\nimport { importRaw, ImportRawPayload } from \"./raw\";\n\nexport interface ImportPayload {\n    isAppend: boolean;\n}\nexport interface ImportJsonPayload extends ImportPayload {\n    text: string;\n}\nexport interface ImportBase64Payload extends ImportPayload {\n    text: string;\n}\n\nexport type DiagramImportActions =\n    | { type: \"import-raw\"; payload: ImportRawPayload }\n    | { type: \"import-json\"; payload: ImportPayload & { text: string } }\n    | { type: \"import-base64\"; payload: ImportPayload & { text: string } };\n\nconst importJson: DiagramReducer<ImportJsonPayload> = (diagram, payload) => {\n    const raw = JSON.parse(payload.text);\n    return importRaw(diagram, { ...payload, raw });\n};\n\ntype Base64Reducer = DiagramReducer<ImportBase64Payload>;\nconst importBase64: Base64Reducer = (diagram, payload) => {\n    const decoder = new TextDecoder();\n    const bytes = Uint8Array.from(atob(payload.text), (c) => c.charCodeAt(0));\n    const text = decoder.decode(bytes);\n    return importJson(diagram, { ...payload, text });\n};\n\nexport const diagramImportReducer: DiagramReducer = (diagram, action) => {\n    switch (action.type) {\n        case \"import-raw\":\n            return importRaw(diagram, action.payload);\n        case \"import-json\":\n            return importJson(diagram, action.payload);\n        case \"import-base64\":\n            return importBase64(diagram, action.payload);\n        default:\n            return diagram;\n    }\n};\n","import { DiagramReducer } from \"../reducer\";\n\nexport interface RemoveRefPayload {\n    id: number;\n}\n\nexport interface RemoveMultipleRefsPayload {\n    ids: number[];\n}\n\ntype Payload = RemoveRefPayload;\ntype MultiplePayload = RemoveMultipleRefsPayload;\n\nexport const removeRef: DiagramReducer<Payload> = (diagram, payload) => {\n    const refs = diagram.refs.filter((ref) => ref.id !== payload.id);\n    return { ...diagram, refs };\n};\n\ntype MultipleReducer = DiagramReducer<MultiplePayload>;\nexport const removeMultipleRefs: MultipleReducer = (diagram, payload) => {\n    let next = diagram;\n    payload.ids.forEach((id) => {\n        next = removeRef(next, { id });\n    });\n    return next;\n};\n","import { DiagramReducer } from \"../reducer\";\nimport { addRef, AddRefPayload } from \"./add\";\nimport {\n    removeMultipleRefs,\n    RemoveMultipleRefsPayload,\n    removeRef,\n    RemoveRefPayload,\n} from \"./remove\";\n\nexport type DiagramRefActions =\n    | { type: \"add-ref\"; payload: AddRefPayload }\n    | { type: \"remove-ref\"; payload: RemoveRefPayload }\n    | { type: \"remove-multiple-refs\"; payload: RemoveMultipleRefsPayload };\n\nexport const diagramRefReducer: DiagramReducer = (diagram, action) => {\n    switch (action.type) {\n        case \"add-ref\":\n            return addRef(diagram, action.payload);\n        case \"remove-ref\":\n            return removeRef(diagram, action.payload);\n        case \"remove-multiple-refs\":\n            return removeMultipleRefs(diagram, action.payload);\n        default:\n            return diagram;\n    }\n};\n","import { EditRef } from \"diagram/edit/edit\";\nimport { DiagramReducer } from \"../reducer\";\nimport { getNumberId } from \"../id\";\n\ninterface AddRefSide {\n    table: number;\n    rows: number[];\n}\n\nexport interface AddRefPayload {\n    from: AddRefSide;\n    to: AddRefSide;\n}\n\ntype Payload = AddRefPayload;\n\nconst isFromPayload = (ref: EditRef, payload: Payload): boolean =>\n    ref.from.table === payload.from.table &&\n    ref.from.rows.some((id) => payload.from.rows.includes(id));\n\nexport const addRef: DiagramReducer<Payload> = (diagram, payload) => {\n    // Must remove related ref(s) before adding the new one\n    const refs = diagram.refs.filter((ref) => !isFromPayload(ref, payload));\n    // New ref\n    const prevIds = diagram.refs.map((ref) => ref.id);\n    const ref = { ...payload, id: getNumberId(prevIds) };\n    refs.push(ref);\n    return { ...diagram, refs };\n};\n","import { EditRef, EditRefSide, EditTable } from \"diagram/edit/edit\";\nimport { DiagramReducer } from \"../reducer\";\n\nexport interface RemoveRowPayload {\n    tableId: number;\n    rowId: number;\n}\n\ntype Payload = RemoveRowPayload;\n\nconst isSideRelated = (payload: Payload, side: EditRefSide): boolean =>\n    side.table === payload.tableId && side.rows.includes(payload.rowId);\n\nconst isRelated = (payload: Payload, ref: EditRef): boolean =>\n    isSideRelated(payload, ref.from) || isSideRelated(payload, ref.to);\n\nconst updateTable = (payload: Payload) => (table: EditTable): EditTable => {\n    if (table.id !== payload.tableId) return table;\n    const rows = table.value.rows.filter((row) => row.id !== payload.rowId);\n    return { ...table, value: { ...table.value, rows } };\n};\n\nexport const removeRow: DiagramReducer<Payload> = (diagram, payload) => {\n    const tables = diagram.tables.map(updateTable(payload));\n    let refs = diagram.refs.filter((ref) => !isRelated(payload, ref));\n    if (refs.length === diagram.refs.length) refs = diagram.refs;\n    return { ...diagram, tables, refs };\n};\n","import { EditDiagram, EditRow, EditTable } from \"diagram/edit/edit\";\nimport { DiagramReducer } from \"../reducer\";\n\nexport interface UpdateRowPayload {\n    tableId: number;\n    rowId: number;\n    property: string;\n    value: string;\n}\n\ntype Payload = UpdateRowPayload;\n\nconst updateEditRow = (payload: Payload) => (row: EditRow): EditRow => {\n    if (row.id !== payload.rowId) return row;\n    const value = { ...row.value }; // EditRow.value or Diagram.Row\n    value[payload.property] = payload.value;\n    return { ...row, value };\n};\n\nconst updateTable = (payload: Payload) => (table: EditTable): EditTable => {\n    if (table.id !== payload.tableId) return table;\n    const rows = table.value.rows.map(updateEditRow(payload));\n    return { ...table, value: { ...table.value, rows } };\n};\n\nconst isSame = (diagram: EditDiagram, payload: Payload): boolean => {\n    const { tableId, rowId, property: attribute, value } = payload;\n    const row = diagram.tables\n        .find((table) => table.id === tableId) // table\n        ?.value.rows.find((row) => row.id === rowId); // row\n    if (!row) throw Error(`Row \"${tableId}.${rowId}\" not found`);\n    return row.value[attribute] === value;\n};\n\nexport const updateRow: DiagramReducer<Payload> = (diagram, payload) => {\n    if (isSame(diagram, payload)) return diagram;\n    const tables = diagram.tables.map(updateTable(payload));\n    return { ...diagram, tables };\n};\n","import { EditRef } from \"diagram/edit/edit\";\nimport { DiagramReducer } from \"../reducer\";\n\nexport interface RemoveTablePayload {\n    id: number;\n}\n\nexport interface RemoveMultipleTablesPayload {\n    ids: number[];\n}\n\ntype Payload = RemoveTablePayload;\ntype MultiplePayload = RemoveMultipleTablesPayload;\n\nconst isRelated = (payload: Payload, ref: EditRef): boolean =>\n    ref.from.table === payload.id || ref.to.table === payload.id;\n\nexport const removeTable: DiagramReducer<Payload> = (diagram, payload) => {\n    const tables = diagram.tables.filter((table) => table.id !== payload.id);\n    const refs = diagram.refs.filter((ref) => !isRelated(payload, ref));\n    return { ...diagram, tables, refs };\n};\n\ntype MultipleReducer = DiagramReducer<MultiplePayload>;\nexport const removeMultipleTables: MultipleReducer = (diagram, payload) => {\n    let next = diagram;\n    payload.ids.forEach((id) => {\n        next = removeTable(next, { id });\n    });\n    return next;\n};\n","import { EditTable } from \"diagram/edit/edit\";\nimport { DiagramReducer } from \"../reducer\";\n\nexport interface UpdateTableNamePayload {\n    id: number;\n    name: string;\n}\n\ntype Payload = UpdateTableNamePayload;\n\nconst updateName = (payload: Payload) => (table: EditTable): EditTable => {\n    if (table.id !== payload.id) return table;\n    return { ...table, value: { ...table.value, name: payload.name } };\n};\n\nexport const updateTableName: DiagramReducer<Payload> = (diagram, payload) => {\n    const tables = diagram.tables.map(updateName(payload));\n    return { ...diagram, tables };\n};\n","import { DiagramReducer } from \"../reducer\";\nimport { addTable, AddTablePayload } from \"./add\";\nimport { setTablePosition, SetTablePositionPayload } from \"./position\";\nimport { removeMultipleTables, RemoveMultipleTablesPayload, removeTable, RemoveTablePayload } from \"./remove\"; // prettier-ignore\nimport { updateTableName, UpdateTableNamePayload } from \"./update-name\";\nimport { SetTableRowsExpandPayload, SetAllTablesRowsExpandPayload, setTableRowsExpand, setAllTablesRowsExpand } from \"./row\"; // prettier-ignore\n\nexport type DiagramTableActions =\n    | { type: \"remove-table\"; payload: RemoveTablePayload }\n    | { type: \"remove-multiple-tables\"; payload: RemoveMultipleTablesPayload }\n    | { type: \"add-table\"; payload: AddTablePayload }\n    | { type: \"set-table-position\"; payload: SetTablePositionPayload }\n    | { type: \"set-table-rows-expand\"; payload: SetTableRowsExpandPayload }\n    | { type: \"set-all-tables-rows-expand\"; payload: SetAllTablesRowsExpandPayload } // prettier-ignore\n    | { type: \"update-table-name\"; payload: UpdateTableNamePayload };\n\nexport const diagramTableReducer: DiagramReducer = (diagram, action) => {\n    switch (action.type) {\n        case \"add-table\":\n            return addTable(diagram, action.payload);\n        case \"remove-table\":\n            return removeTable(diagram, action.payload);\n        case \"remove-multiple-tables\":\n            return removeMultipleTables(diagram, action.payload);\n        case \"update-table-name\":\n            return updateTableName(diagram, action.payload);\n        case \"set-table-position\":\n            return setTablePosition(diagram, action.payload);\n        case \"set-table-rows-expand\":\n            return setTableRowsExpand(diagram, action.payload);\n        case \"set-all-tables-rows-expand\":\n            return setAllTablesRowsExpand(diagram, action.payload);\n        default:\n            return diagram;\n    }\n};\n","import { TablePosition } from \"diagram/edit/layout\";\nimport { DiagramReducer } from \"../reducer\";\n\nexport interface SetTablePositionPayload {\n    id: number;\n    position: TablePosition;\n}\n\ntype Reducer = DiagramReducer<SetTablePositionPayload>;\n\nexport const setTablePosition: Reducer = (diagram, payload) => ({\n    ...diagram,\n    tables: diagram.tables.map((table) => {\n        if (table.id !== payload.id) return table;\n        return { ...table, position: payload.position };\n    }),\n});\n","import { DiagramReducer } from \"../reducer\";\n\nexport interface SetTableRowsExpandPayload {\n    id: number;\n    isExpand: boolean;\n}\n\nexport type SetAllTablesRowsExpandPayload = boolean;\n\ntype Reducer = DiagramReducer<SetTableRowsExpandPayload>;\nexport const setTableRowsExpand: Reducer = (diagram, payload) => {\n    const tables = diagram.tables.map((table) => {\n        if (table.id !== payload.id) return table;\n        return { ...table, isRowsExpand: payload.isExpand };\n    });\n    return { ...diagram, tables };\n};\n\ntype AllReducer = DiagramReducer<SetAllTablesRowsExpandPayload>;\nexport const setAllTablesRowsExpand: AllReducer = (diagram, payload) => {\n    const tables = diagram.tables.map((table) => {\n        return { ...table, isRowsExpand: payload };\n    });\n    return { ...diagram, tables };\n};\n","import React from \"react\";\nimport { addExternalFn } from \"utils/external\";\n\nexport type Platform = \"web\" | \"mac\" | \"win\";\n\nconst webDomains = [\"localhost\", \"diagramplus.com\"];\n\nconst initial: Platform = (() => {\n    if (webDomains.includes(window.location.hostname)) return \"web\";\n    if (window.location.hostname.startsWith(\"192.168.1\")) return \"web\";\n    const platform = navigator.platform.toLowerCase();\n    if (platform.includes(\"mac\")) return \"mac\";\n    if (platform.includes(\"win\")) return \"win\";\n    return \"web\";\n})();\n\nexport const PlatformContext = React.createContext<Platform>(initial);\n\n/**\n * The platform the app is running on. This is not navigator.platform, but to\n * separate between running directly in browsers and embedded in desktop apps\n */\nexport const usePlatform = (): Platform => {\n    return React.useContext(PlatformContext);\n};\n\nconst registerExternal = addExternalFn(\"setPlatform\");\n\nexport const usePlatformProvider = (): Platform => {\n    const [platform, setPlatform] = React.useState<Platform>(initial);\n    React.useEffect(() => {\n        const external = (text: Platform): void => void setPlatform(text);\n        registerExternal(external);\n    }, []);\n    return platform;\n};\n","import { makeEditFromDiagram } from \"diagram/edit/convert/to\";\nimport { EditDiagram } from \"diagram/edit/edit\";\n\nexport const emptyDiagram: EditDiagram = makeEditFromDiagram({\n    columns: [\n        { id: \"0\", name: \"name\", type: \"string\" },\n        { id: \"1\", name: \"type\", type: \"string\" },\n        { id: \"2\", name: \"nullable\", type: \"boolean\" },\n    ],\n    schema: \"main\",\n    items: [],\n    refs: [],\n});\n\nexport const fallbackDiagram: EditDiagram = makeEditFromDiagram({\n    columns: [\n        { id: \"0\", name: \"name\", type: \"string\" },\n        { id: \"1\", name: \"type\", type: \"string\" },\n        { id: \"2\", name: \"nullable\", type: \"boolean\" },\n    ],\n    schema: \"primary\",\n    items: [\n        {\n            id: \"employees\",\n            name: \"employees\",\n            rows: [\n                {\n                    id: \"emp_no\",\n                    name: \"emp_no\",\n                    type: \"int(11)\",\n                    nullable: \"FALSE\",\n                },\n                {\n                    id: \"birth_date\",\n                    name: \"birth_date\",\n                    type: \"date\",\n                    nullable: \"TRUE\",\n                },\n                {\n                    id: \"first_name\",\n                    name: \"first_name\",\n                    type: \"varchar(14)\",\n                    nullable: \"TRUE\",\n                },\n                {\n                    id: \"last_name\",\n                    name: \"last_name\",\n                    type: \"varchar(16)\",\n                    nullable: \"TRUE\",\n                },\n            ],\n        },\n        {\n            id: \"departments\",\n            name: \"departments\",\n            schema: \"secondary\",\n            rows: [\n                {\n                    id: \"dept_no\",\n                    name: \"dept_no\",\n                    type: \"char(4)\",\n                    nullable: \"FALSE\",\n                },\n                {\n                    id: \"dept_name\",\n                    name: \"dept_name\",\n                    type: \"varchar(40)\",\n                    nullable: \"FALSE\",\n                },\n            ],\n        },\n        {\n            id: \"dept_emp\",\n            name: \"dept_emp\",\n            rows: [\n                {\n                    id: \"dept_no\",\n                    name: \"dept_no\",\n                    type: \"char(4)\",\n                    nullable: \"FALSE\",\n                },\n                {\n                    id: \"emp_no\",\n                    name: \"emp_no\",\n                    type: \"int(11)\",\n                    nullable: \"FALSE\",\n                },\n                {\n                    id: \"from_date\",\n                    name: \"from_date\",\n                    type: \"date\",\n                    nullable: \"TRUE\",\n                },\n                {\n                    id: \"to_date\",\n                    name: \"to_date\",\n                    type: \"date\",\n                    nullable: \"TRUE\",\n                },\n            ],\n        },\n    ],\n    refs: [\n        {\n            from: { name: \"dept_emp\", schema: \"primary\", rows: [\"dept_no\"] },\n            to: { name: \"departments\", schema: \"secondary\", rows: [\"dept_no\"] },\n        },\n        {\n            from: { name: \"dept_emp\", rows: [\"emp_no\"] },\n            to: { name: \"employees\", rows: [\"emp_no\"] },\n        },\n    ],\n});\n","import { EditDiagram } from \"diagram/edit/edit\";\nimport * as React from \"react\";\nimport { usePlatform } from \"utils/platform\";\nimport { emptyDiagram, fallbackDiagram } from \"./fallback\";\n\nexport const EDIT_DIAGRAM_STORAGE_KEY = \"diagram\";\n\nconst parseErrorMessage = [\n    \"There was an error while parsing the locally saved diagram. The app will \",\n    \"now fallback to a sample diagram.\\n\\n\",\n    \"Your previous diagram is still available in your localStorage under the \",\n    `key \"${EDIT_DIAGRAM_STORAGE_KEY}-invalid\". Please contact us if you need help `,\n    \"retrieving it.\",\n].join(\"\");\n\nconst getDiagram = (): EditDiagram => {\n    const stored = window.localStorage.getItem(EDIT_DIAGRAM_STORAGE_KEY);\n    if (stored === null) return fallbackDiagram;\n    try {\n        return JSON.parse(stored);\n    } catch {\n        window.localStorage.setItem(\n            `${EDIT_DIAGRAM_STORAGE_KEY}-invalid`,\n            stored\n        );\n        window.alert(parseErrorMessage);\n        return fallbackDiagram;\n    }\n};\n\nconst setDiagram = (diagram: EditDiagram) => {\n    window.localStorage.setItem(\n        EDIT_DIAGRAM_STORAGE_KEY,\n        JSON.stringify(diagram)\n    );\n};\n\ninterface DiagramStorageState {\n    get: () => EditDiagram;\n    set: (diagram: EditDiagram) => void;\n}\n\nexport const useDiagramStorage = (): DiagramStorageState => {\n    const platform = usePlatform();\n    const storage = React.useMemo(() => {\n        return platform === \"web\"\n            ? {\n                  get: () => getDiagram(),\n                  set: (diagram: EditDiagram) => setDiagram(diagram),\n              }\n            : {\n                  get: () => emptyDiagram,\n                  // Still set diagram for error reporting purpose\n                  set: (diagram: EditDiagram) => setDiagram(diagram),\n              };\n    }, [platform]);\n    return storage;\n};\n","import * as React from \"react\";\nimport { UndoAction } from \"./undo\";\n\ninterface Props {\n    past: any[];\n    future: any[];\n    dispatch: React.Dispatch<UndoAction>;\n}\n\nconst makeListener = (props: Props) => (event: KeyboardEvent) => {\n    if (!event.ctrlKey && !event.metaKey) return;\n    if (event.target instanceof HTMLInputElement) return;\n    if (event.target instanceof HTMLTextAreaElement) return;\n    switch (event.key) {\n        case \"z\": {\n            if (props.past.length === 0) return;\n            return props.dispatch({ type: \"undo\" });\n        }\n        case \"Z\":\n        case \"y\": {\n            if (props.future.length === 0) return;\n            return props.dispatch({ type: \"redo\" });\n        }\n    }\n};\n\nexport const useDiagramUndoShortcut = (props: Props) => {\n    const { past, future, dispatch } = props;\n    React.useEffect(() => {\n        const listener = makeListener({ past, future, dispatch });\n        document.addEventListener(\"keyup\", listener);\n        return () => document.removeEventListener(\"keyup\", listener);\n    }, [past, future, dispatch]);\n};\n","import React from \"react\";\nimport { EditDiagram } from \"../edit/edit\";\nimport { useDiagramExternal } from \"./external/external\";\nimport { DiagramAction, diagramReducer } from \"./reducer/reducer\";\nimport { useDiagramStorage } from \"./storage/storage\";\nimport { useDiagramUndoShortcut } from \"./undo/shortcut\";\nimport * as Undo from \"./undo/undo\";\n\nexport interface DiagramState {\n    history: Undo.UndoState<EditDiagram>;\n    dispatch: React.Dispatch<DiagramAction | Undo.UndoAction>;\n}\n\nconst undoReducer = Undo.createUndoReducer(diagramReducer);\n\nexport const useDiagram = (): DiagramState => {\n    const storage = useDiagramStorage();\n    const init = () => Undo.createUndoInitial(storage.get());\n    const [history, dispatch] = React.useReducer(undoReducer, undefined, init);\n    const { past, present, future } = history;\n\n    useDiagramExternal(present, dispatch);\n    useDiagramUndoShortcut({ past, future, dispatch });\n\n    const { set: storageSet } = storage;\n    React.useEffect(() => {\n        storageSet(present);\n    }, [present, storageSet]);\n\n    return { history, dispatch };\n};\n","import { EditDiagram } from \"../../edit/edit\";\nimport { DiagramLayoutAction, diagramLayoutReducer } from \"./layout/layout\";\nimport { DiagramImportActions, diagramImportReducer } from \"./import/import\";\nimport { DiagramRefActions, diagramRefReducer } from \"./ref/ref\";\nimport { DiagramRowActions, diagramRowReducer } from \"./row/row\";\nimport { DiagramTableActions, diagramTableReducer } from \"./table/table\";\n\nexport type DiagramReducer<T = DiagramAction> = (\n    diagram: EditDiagram,\n    arg: T\n) => EditDiagram;\n\nexport type DiagramAction =\n    | DiagramTableActions\n    | DiagramRowActions\n    | DiagramRefActions\n    | DiagramLayoutAction\n    | DiagramImportActions;\n\nexport const diagramReducer: DiagramReducer = (prev, action) => {\n    let next = prev;\n    next = diagramTableReducer(next, action);\n    next = diagramRowReducer(next, action);\n    next = diagramRefReducer(next, action);\n    next = diagramImportReducer(next, action);\n    next = diagramLayoutReducer(next, action);\n    return next;\n};\n","import { DiagramReducer } from \"../reducer\";\nimport { addRow, AddRowPayload } from \"./add\";\nimport { removeRow, RemoveRowPayload } from \"./remove\";\nimport { updateRow, UpdateRowPayload } from \"./update\";\n\nexport type DiagramRowActions =\n    | { type: \"add-row\"; payload: AddRowPayload }\n    | { type: \"remove-row\"; payload: RemoveRowPayload }\n    | { type: \"update-row\"; payload: UpdateRowPayload }\n\nexport const diagramRowReducer: DiagramReducer = (diagram, action) => {\n    switch (action.type) {\n        case \"add-row\":\n            return addRow(diagram, action.payload);\n        case \"remove-row\":\n            return removeRow(diagram, action.payload);\n        case \"update-row\":\n            return updateRow(diagram, action.payload);\n        default:\n            return diagram;\n    }\n};\n","import { applyAutoLayout } from \"diagram/layout/layout\";\nimport { DiagramReducer } from \"../reducer\";\n\nexport interface SetDiagramLayoutPayload {\n    type: \"auto\";\n}\n\nexport type DiagramLayoutAction = {\n    type: \"set-layout\";\n    payload: SetDiagramLayoutPayload;\n};\n\nexport const diagramLayoutReducer: DiagramReducer = (diagram, action) => {\n    switch (action.type) {\n        case \"set-layout\":\n            switch (action.payload.type) {\n                case \"auto\":\n                    return applyAutoLayout(diagram);\n                default:\n                    return diagram;\n            }\n        default:\n            return diagram;\n    }\n};\n","import { SetSelectIds } from \"./select\";\n\ninterface Props {\n    refId: number;\n    setSelectIds: SetSelectIds;\n}\n\nexport const selectOnRefClick = (props: Props) => () => {\n    props.setSelectIds([{ type: \"ref\", value: props.refId }]);\n};\n","export const getRowElementId = (tableId: number, rowId: number) =>\n    `row . ${tableId} . ${rowId}`;\n\ntype RowElement = HTMLDivElement;\n\nexport const getRowElement = (\n    tableId: number,\n    rowId: number\n): RowElement | null => {\n    const element = document.getElementById(getRowElementId(tableId, rowId));\n    if (element instanceof HTMLDivElement) return element;\n    return null;\n};\n","import { getRowElement } from \"app/row/dom\";\nimport { getTableElement } from \"app/table/utils\";\nimport { EditEdge, EditEdgeSide, EditTable } from \"diagram/edit/edit\";\nimport { TablePosition } from \"diagram/edit/layout\";\n\nexport interface EdgeBox {\n    top: number;\n    left: number;\n    right: number;\n}\n\nexport interface EdgeBoxes {\n    from: EdgeBox[];\n    to: EdgeBox[];\n}\n\nconst getOffsetUntil = (target: HTMLElement, container: Element) => {\n    let [top, left, element] = [0, 0, target];\n    do {\n        [top, left] = [top + element.offsetTop, left + element.offsetLeft];\n        const parent = element.offsetParent;\n        if (!(parent instanceof HTMLElement)) break;\n        element = parent;\n    } while (element !== container);\n    return { top, left };\n};\n\nconst getEdgeSideBoxes = (\n    edge: EditEdgeSide,\n    tablePosition: TablePosition\n): EdgeBox[] => {\n    const { top: tableTop, left: tableLeft } = tablePosition;\n    const table = getTableElement(edge.table);\n    return edge.rows.map((rowId) => {\n        const row = getRowElement(edge.table, rowId);\n        if (row !== null) {\n            // If row is rendered then use row\n            const { top: rowTop, left: rowLeft } = getOffsetUntil(row, table);\n            const top = rowTop + tableTop + row.clientHeight / 2;\n            const left = rowLeft + tableLeft;\n            return { top, left, right: left + row.clientWidth };\n        } else {\n            // If row is not rendered then use center of table\n            return {\n                top: tableTop + table.clientHeight / 2,\n                left: tableLeft,\n                right: tableLeft + table.clientWidth,\n            };\n        }\n    });\n};\n\ninterface Props {\n    edge: EditEdge;\n    fromTable: EditTable;\n    toTable: EditTable;\n}\n\nexport const getEdgeBoxes = (props: Props): EdgeBoxes => ({\n    from: getEdgeSideBoxes(props.edge.from, props.fromTable.position),\n    to: getEdgeSideBoxes(props.edge.to, props.toTable.position),\n});\n","import { getTableElement } from \"app/table/utils\";\nimport { EditEdge } from \"diagram/edit/edit\";\nimport * as React from \"react\";\n\nconst mutationCb = (setChanged: () => void): MutationCallback => (records) => {\n    records.forEach((record) => {\n        if (record.type !== \"attributes\") return;\n        if (record.attributeName !== \"data-is-visible\") return;\n        setChanged();\n    });\n};\n\nconst resizeCb = (setChanged: () => void): ResizeObserverCallback => () => {\n    setChanged();\n};\n\nconst mutationInit = {\n    attributes: true, // Required for Edge\n    attributeFilter: [\"data-is-visible\"],\n};\n\nexport const useEdgeObserve = (edge: EditEdge): object => {\n    // Watch for non-react dependencies (e.g. DOM rendering)\n    const [changed, setChanged] = React.useState({});\n    React.useLayoutEffect(() => {\n        const from = getTableElement(edge.from.table);\n        const to = getTableElement(edge.to.table);\n        const set = () => setChanged({});\n        // resize\n        const resize = new window.ResizeObserver(resizeCb(set));\n        resize.observe(from);\n        resize.observe(to);\n        // mutation\n        const mutation = new MutationObserver(mutationCb(set));\n        mutation.observe(from, mutationInit);\n        mutation.observe(to, mutationInit);\n        return () => {\n            mutation.disconnect();\n            resize.disconnect();\n        };\n    }, [edge]);\n\n    return changed;\n};\n","import { GRID_CELL } from \"app/table/utils\";\nimport { EdgePoint, EdgePoints } from \"./point\";\n\nexport interface EdgePath {\n    paths: string[];\n    length: number;\n}\n\ntype Point = EdgePoint;\n\nconst RADIUS = GRID_CELL / 2;\n\nconst getAnchorAxis = (A: Point, B: Point, key: keyof Point) => {\n    const [a, b] = [A[key], B[key]];\n    const r = Math.min(RADIUS, Math.abs(a - b) / 2);\n    if (a === b) return a;\n    return b + r * (a > b ? 1 : -1);\n};\n\nconst getAnchor = (A: Point, B: Point): Point => ({\n    x: getAnchorAxis(A, B, \"x\"),\n    y: getAnchorAxis(A, B, \"y\"),\n});\n\nconst isDiagonal = (A: Point, B: Point): boolean => B.x !== A.x && B.y !== A.y;\n\nconst pushPoint = (points: Point[], path: string[], i: number) => {\n    // PrevPoint (A) > CurrentPoint (B) > NextPoint (C)\n    const [A, B, C] = [points[i - 1], points[i], points[i + 1]];\n    // We only round 90deg corners\n    if (isDiagonal(A, B) || isDiagonal(B, C)) {\n        path.push(`L ${B.x} ${B.y}`);\n    } else {\n        // Round the corner\n        const [X, Y] = [getAnchor(A, B), getAnchor(C, B)];\n        path.push(`L ${X.x} ${X.y}`);\n        path.push(`Q ${B.x} ${B.y} ${Y.x} ${Y.y}`);\n        points[i] = Y;\n    }\n};\n\nconst getPathD = (_points: EdgePoint[]): string => {\n    if (_points.length === 0) return \"\";\n    if (_points.length === 1) throw Error(\"points.length must be 0 or 2+\");\n    const points = [..._points];\n    const path = [`M ${points[0].x} ${points[0].y}`];\n    const last = points.length - 1;\n    for (let i = 1; i < last; i++) {\n        pushPoint(points, path, i);\n    }\n    path.push(`L ${points[last].x} ${points[last].y}`);\n    return path.join(\" \");\n};\n\nconst getPathLength = (points: EdgePoint[]): number =>\n    points.reduce((prev, point, index) => {\n        if (index === 0) return 0;\n        const { x: x1, y: y1 } = point;\n        const { x: x2, y: y2 } = points[index - 1];\n        return prev + Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));\n    }, 0);\n\nconst getPoints = (map: EdgePoints, index: number): Point[] => {\n    const { from, mid: C, to } = map;\n    // FromInner > FromOuter > Mid > ToOuter > ToInner\n    // A           B           C     D         E\n    const [A, E] = [from.inners[index], to.inners[index]];\n    const [B, D] = [from.outer, to.outer];\n    // Simple case where one row link to one row\n    const isSingle = A.x === B.x && D.x === E.x;\n    return isSingle ? [A, ...C, E] : [A, B, ...C, D, E];\n};\n\nexport const getEdgePath = (map: EdgePoints): EdgePath => {\n    const { from, mid, to } = map;\n\n    const paths: string[] = from.inners.map((_, index) => {\n        const points = getPoints(map, index);\n        return getPathD(points);\n    });\n\n    const length: number = getPathLength([\n        from.inners[0],\n        ...mid,\n        to.inners[0],\n    ]);\n\n    return { paths, length };\n};\n","import { GRID_CELL } from \"app/table/utils\";\nimport { EditEdge } from \"diagram/edit/edit\";\nimport { EdgeBox, EdgeBoxes } from \"./box\";\nimport { EdgesMids, avoidMidCollision } from \"./mid\";\n\n// TL;DR: From Box (top, left) to Point (x, y)!\n\nexport interface EdgePoint {\n    x: number;\n    y: number;\n}\n\ntype Side = \"left\" | \"right\";\n\n/**\n * Points of \"from\" and \"to\" (where an Edge starts and ends)\n *\n * Let's say a path is drawn from id1 and id2 rows (composite keys). In this\n * case, the path will start from B and C, then join at A, then go outside of\n * the table:\n *\n *       . . . . . . . . . . . . . .\n *       .\n *       .   |------------------|\n *       .   |    user table    |\n *       .   |------------------|\n *       A   B  id1       uuid  |\n *       .   C  id2       uuid  |\n *\n * A:       outer\n * B & C:   inners\n */\nexport interface EdgePointsEnd {\n    inners: EdgePoint[];\n    outer: EdgePoint;\n    side: Side;\n}\n\n/** A complete set of points to draw an Edge */\nexport interface EdgePoints {\n    from: EdgePointsEnd;\n    mid: EdgePoint[];\n    to: EdgePointsEnd;\n}\n\nconst toPoint = (side: Side) => (box: EdgeBox): EdgePoint => ({\n    x: side === \"left\" ? box.left : box.right,\n    y: box.top,\n});\n\nconst getOuterPoint = (inners: EdgePoint[], side: Side): EdgePoint => ({\n    x: inners[0].x + (side === \"right\" ? 1 : -1) * GRID_CELL,\n    y: inners.reduce((sum, point) => sum + point.y, 0) / inners.length,\n});\n\n/**\n * Decide which side of a table should we draw from. For simplicity this\n * returns EdgePoints but with empty \"mid\". The \"mid\" will be provide later.\n */\nconst getEndPoints = (boxes: EdgeBoxes): Omit<EdgePoints, \"mid\"> => {\n    const SAFE_SPACE = GRID_CELL * 2;\n    // Horizontal-wise, we only need to compare one row\n    const [from, to] = [boxes.from[0], boxes.to[0]];\n    let [fromSide, toSide]: Side[] = [\"right\", \"right\"];\n    if (from.right <= to.left - SAFE_SPACE) {\n        [fromSide, toSide] = [\"right\", \"left\"];\n    } else if (from.left >= to.right + SAFE_SPACE) {\n        [fromSide, toSide] = [\"left\", \"right\"];\n    }\n    const fromInners = boxes.from.map(toPoint(fromSide));\n    const fromOuter = getOuterPoint(fromInners, fromSide);\n    const toInners = boxes.to.map(toPoint(toSide));\n    const toOuter = getOuterPoint(toInners, toSide);\n    return {\n        from: { inners: fromInners, side: fromSide, outer: fromOuter },\n        to: { inners: toInners, side: toSide, outer: toOuter },\n    };\n};\n\n/**\n * Return the middle points between 2 sides so that the path between them\n * doesn't have a diagonal line\n */\nconst getMidPoints = (points: Omit<EdgePoints, \"mid\">): EdgePoint[] => {\n    const { from, to } = points;\n    // When 2 ends are from different side, we need to pick mid points from the\n    // middle area between them:\n    //\n    //   A o---X\n    //         |\n    //         Y---> B\n    if (from.side !== to.side) {\n        const midX = (from.outer.x + to.outer.x) / 2;\n        return [\n            { x: midX, y: from.outer.y },\n            { x: midX, y: to.outer.y },\n        ];\n    }\n\n    // When 2 ends are from the same side, we need to pick a mid point from\n    // that side (to avoid the path from overlapping the target):\n    //\n    //   A o----X\n    //          |\n    //     B <--Y\n    //\n    // Note that we still need to produce two mid points even though the \"safe\"\n    // point can already be a mid point. This is requires for the \"avoid edge\n    // collision algorithm\" to work properly.\n    if (from.side === to.side) {\n        const midX = Math.max(from.outer.x, to.outer.x);\n        return [\n            { x: midX, y: from.outer.y },\n            { x: midX, y: to.outer.y },\n        ];\n    }\n    throw Error(\"never\");\n};\n\ninterface Props {\n    edgesMids?: EdgesMids;\n    edge: EditEdge;\n    boxes: EdgeBoxes;\n}\n\nexport const getEdgePoints = (props: Props): EdgePoints => {\n    const { edgesMids, edge, boxes } = props;\n    // Get points\n    const { from, to } = getEndPoints(boxes);\n    let mid = getMidPoints({ from, to });\n    // Temporarily disable\n    // Avoid collision if possible\n    if (edgesMids !== undefined) {\n        mid = avoidMidCollision({ edgesMids, edge, midPoints: mid });\n    }\n    return { from, mid, to };\n};\n","import { EditEdge } from \"diagram/edit/edit\";\nimport * as React from \"react\";\n// import { PairMap } from \"./pair-map\";\nimport { EdgePoint } from \"./point\";\nimport { GRID_CELL } from \"app/table/utils\";\n\n// The purpose of this module is to avoid the situation where the \"x\" of \"mids\"\n// points of some edges are the same thus it's not clear which edge ends at\n// which row. For example, in the figure below, it's not clear whether A or C\n// is connected to X:\n//\n// A >-----+\n// B       |\n// C >-----+\n//         |\n//         |\n//         +----> X\n//         |      Y\n//         +----> Z\n//\n\ninterface UseEdgesMidsProps {\n    edges: EditEdge[];\n}\n\nexport interface EdgesMids {\n    edgesMap: Map<number, { mid: number; detail: EditEdge }>;\n    // usedMids: PairMap<number, Set<number>>;\n    usedMids: Set<number>;\n}\n\nexport const useEdgesMids = (props: UseEdgesMidsProps) => {\n    const edgesMids = React.useRef<EdgesMids>({\n        edgesMap: new Map(),\n        // usedMids: new PairMap(),\n        usedMids: new Set(),\n    });\n\n    // Remove outdated edges\n    React.useEffect(() => {\n        const ids = new Set(props.edges.map((edge) => edge.id));\n        edgesMids.current.edgesMap.forEach((edge, id) => {\n            if (ids.has(id)) return;\n            // id is not inside ids ===> removed ref\n            // edgesMids.current.usedMids\n            //     .get(edge.detail.from.table, edge.detail.to.table)\n            //     ?.delete(edge.mid);\n            edgesMids.current.usedMids.delete(edge.mid);\n            edgesMids.current.edgesMap.delete(id);\n        });\n    }, [props.edges]);\n\n    return edgesMids;\n};\n\ninterface CollisionProps {\n    edgesMids: EdgesMids;\n    edge: EditEdge;\n    midPoints: EdgePoint[];\n}\n\nconst getClosestAvailable = (set: Set<number>, start: number): number => {\n    let result = start;\n    let i = 1;\n    while (set.has(result)) {\n        result = start + i * GRID_CELL / 2;\n        i = i > 0 ? -i : -i + 1;\n    }\n    return result;\n};\n\nexport const avoidMidCollision = (props: CollisionProps): EdgePoint[] => {\n    const { edgesMap, usedMids } = props.edgesMids;\n    const next = props.midPoints[0].x; // All mid points have the same \"x\"\n    const prev = edgesMap.get(props.edge.id)?.mid;\n\n    // Nothing changes\n    if (prev === next) return props.midPoints;\n\n    // const [from, to] = [props.edge.from.table, props.edge.to.table];\n    // const set = usedMids.getOrSet(from, to, new Set());\n    const set = usedMids;\n\n    // Remove previous value if set\n    if (prev !== undefined) set.delete(prev);\n\n    if (set.has(next)) {\n        // Collision happens! Must choose new x\n        const x = getClosestAvailable(set, next);\n        edgesMap.set(props.edge.id, { detail: props.edge, mid: x });\n        set.add(x);\n        return props.midPoints.map((point) => ({ ...point, x }));\n    } else {\n        // No collision. Just record the new one and move on\n        edgesMap.set(props.edge.id, { detail: props.edge, mid: next });\n        set.add(next);\n        return props.midPoints;\n    }\n};\n","import { EditEdge, EditTable } from \"diagram/edit/edit\";\nimport * as React from \"react\";\nimport { debugLog } from \"utils/debug\";\nimport { getEdgeBoxes } from \"./box\";\nimport { EdgesMids } from \"./mid\";\nimport { useEdgeObserve } from \"./observe\";\nimport { EdgePath, getEdgePath } from \"./path\";\nimport { getEdgePoints } from \"./point\";\n\ninterface Props {\n    edge: EditEdge;\n    edgesMids?: React.MutableRefObject<EdgesMids>;\n    fromTable: EditTable;\n    toTable: EditTable;\n}\n\nexport const getEdgeState = (props: Props): EdgePath => {\n    debugLog(\"getEdgeState\");\n    const boxes = getEdgeBoxes(props);\n    const edgesMids = props.edgesMids?.current;\n    const edge = props.edge;\n    const points = getEdgePoints({ edgesMids, edge, boxes });\n    const path = getEdgePath(points);\n    return path;\n};\n\nexport const useEdgeState = (props: Props): EdgePath | null => {\n    const { edge, fromTable, toTable, edgesMids } = props;\n\n    const changed = useEdgeObserve(edge);\n\n    // \"draw\" calculation depends on the result of rendered tables so it can\n    // not be calculated on edge's render but instead as an effect after\n    const [state, setState] = React.useState<EdgePath | null>(null);\n    const prev = React.useRef(0);\n    React.useLayoutEffect(() => {\n        window.clearTimeout(prev.current);\n        // setTimeout to fix a bug in Firefox where styles are not applied\n        // fully at the time when get element\n        prev.current = window.setTimeout(() => {\n            const props = { edge, fromTable, toTable, edgesMids };\n            const newState = getEdgeState(props);\n            setState(newState);\n        }, 0);\n        return () => window.clearTimeout(prev.current);\n    }, [edge, fromTable, toTable, edgesMids, changed]);\n    return state;\n};\n","export const getEdgeElementId = (edgeId: number) => `edge . ${edgeId}`;\n\nexport const getEdgeElement = (edgeId: number): SVGGElement => {\n    const element = document.getElementById(getEdgeElementId(edgeId));\n    if (element instanceof SVGGElement) return element;\n    throw Error(\"Element is not SVGGElement\");\n};\n\ntype Type = \"path-main\" | \"from\" | \"to\" | \"highlight\";\ntype Fn<T> = (edgeId: number, type: Type, index?: number) => T;\n\nexport const getEdgeSubElementId: Fn<string> = (edgeId, type, index) =>\n    `edge . ${edgeId} . ${type} . ${index ?? 0}`;\n\nexport const getEdgeSubElement: Fn<SVGElement> = (edgeId, type, index) => {\n    const id = getEdgeSubElementId(edgeId, type, index);\n    const element = document.getElementById(id);\n    if (element instanceof SVGElement) return element;\n    throw Error(\"Element is not SVGElement\");\n};\n","import { EditEdge } from \"diagram/edit/edit\";\nimport * as React from \"react\";\nimport s from \"./edge.module.scss\";\nimport { EdgePath } from \"./state/path\";\nimport { getEdgeSubElementId } from \"./utils\";\n\ninterface Props {\n    edge: EditEdge;\n    path: EdgePath;\n}\n\nexport const EdgeHighlight = (props: Props) => (\n    <circle className={s.dot} r=\"4\">\n        <animateMotion\n            dur={`${props.path.length / 150}s`}\n            repeatCount=\"indefinite\"\n            id={getEdgeSubElementId(props.edge.id, \"highlight\")}\n            path={props.path.paths[0]}\n        />\n    </circle>\n);\n","import { selectOnRefClick } from \"app/view/select/edge\";\nimport { SetSelectIds } from \"app/view/select/select\";\nimport { EditEdge, EditTable } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport React from \"react\";\nimport { debugLog } from \"utils/debug\";\nimport s from \"./edge.module.scss\";\nimport { useEdgeState } from \"./state/state\";\nimport { getEdgeElementId, getEdgeSubElementId } from \"./utils\";\nimport { EdgeHighlight } from \"./highlight\";\nimport { EdgesMids } from \"./state/mid\";\n\ninterface Props {\n    edge: EditEdge;\n    // Tables\n    fromTable: EditTable;\n    toTable: EditTable;\n    // Diagram\n    edgesMids: React.MutableRefObject<EdgesMids>;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    // Select\n    isSelected: boolean;\n    setSelectIds: SetSelectIds;\n}\n\nconst getClassName = (props: Props): string => {\n    const array = [s.container];\n    if (props.isSelected) array.push(s.selected);\n    return array.join(\" \");\n};\n\nconst EdgePure = (props: Props) => {\n    debugLog(\"Edge\", props.edge.from.rows, props.edge.to.rows);\n\n    const { edge, fromTable, toTable, edgesMids } = props;\n    const path = useEdgeState({ edge, fromTable, toTable, edgesMids });\n    if (path === null) return null;\n\n    return (\n        <g id={getEdgeElementId(props.edge.id)} className={getClassName(props)}>\n            {path.paths.map((d, index) => (\n                <path\n                    key={index}\n                    id={getEdgeSubElementId(edge.id, \"path-main\", index)}\n                    className={s.path}\n                    d={d}\n                    // DO NOT define markers here. See the edge.module.scss\n                />\n            ))}\n            {props.isSelected && (\n                <EdgeHighlight edge={props.edge} path={path} />\n            )}\n            <path\n                className={s.hitarea}\n                d={path.paths[0]}\n                onClick={selectOnRefClick({\n                    refId: props.edge.id,\n                    setSelectIds: props.setSelectIds,\n                })}\n            />\n        </g>\n    );\n};\n\nexport const Edge = React.memo(EdgePure);\n","import * as React from \"react\";\nimport s from \"./marker.module.scss\";\n\nconst From = () => (\n    <marker\n        id=\"edge-from\"\n        viewBox=\"0 0 10 10\"\n        refX=\"5\"\n        refY=\"5\"\n        markerWidth=\"10\"\n        markerHeight=\"10\"\n        markerUnits=\"userSpaceOnUse\"\n    >\n        <circle className={s.container} cx=\"5\" cy=\"5\" r=\"4\" />\n    </marker>\n);\n\nconst To = () => (\n    <marker\n        id=\"edge-to\"\n        viewBox=\"0 0 10 10\"\n        refX=\"10\"\n        refY=\"5\"\n        markerWidth=\"10\"\n        markerHeight=\"10\"\n        markerUnits=\"userSpaceOnUse\"\n        orient=\"auto-start-reverse\"\n    >\n        <polygon className={s.container} points=\"1,1 9,5 1,9\" />\n    </marker>\n);\n\nexport const EdgeMarkers = () => (\n    <defs>\n        <From />\n        <To />\n    </defs>\n);\n","import { useEdgesMids } from \"app/edge/state/mid\";\nimport { SetSelectIds } from \"app/view/select/select\";\nimport { EditDiagram, EditRefSide, EditTable } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport * as React from \"react\";\nimport { Edge } from \"../edge\";\nimport s from \"./canvas.module.css\";\nimport { EdgeMarkers } from \"./marker/marker\";\n\ninterface Props {\n    diagram: EditDiagram;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    selectedRefs: Set<number>;\n    setSelectIds: SetSelectIds;\n    tablesMap: Map<number, EditTable>;\n}\n\nexport const EdgesCanvas = (props: Props) => {\n    const getTable = (side: EditRefSide): EditTable => {\n        const table = props.tablesMap.get(side.table);\n        if (table !== undefined) return table;\n        throw Error(\"Table is undefined\");\n    };\n\n    const edgesMids = useEdgesMids({ edges: props.diagram.refs });\n\n    return (\n        <svg\n            className={s.container}\n            width={props.diagram.size.width}\n            height={props.diagram.size.height}\n        >\n            <EdgeMarkers />\n            {props.diagram.refs.map((edge) => (\n                <Edge\n                    key={edge.id}\n                    edge={edge}\n                    // Select\n                    isSelected={props.selectedRefs.has(edge.id)}\n                    setSelectIds={props.setSelectIds}\n                    // Tables\n                    fromTable={getTable(edge.from)}\n                    toTable={getTable(edge.to)}\n                    // Diagram\n                    edgesMids={edgesMids}\n                    diagramDispatch={props.diagramDispatch}\n                />\n            ))}\n        </svg>\n    );\n};\n","import { getEdgeState } from \"app/edge/state/state\";\nimport { getEdgeSubElement } from \"app/edge/utils\";\nimport { RelatedEdge } from \"app/view/canvas/canvas\";\nimport { EditTable } from \"diagram/edit/edit\";\nimport { TablePosition } from \"diagram/edit/layout\";\nimport { DraggableEventHandler } from \"react-draggable\";\n\ninterface Props {\n    table: EditTable;\n    relatedEdges: RelatedEdge[];\n}\n\nconst updateEdgeElements = (table: EditTable) => (relatedEdge: RelatedEdge) => {\n    const { edge, table: related } = relatedEdge;\n    const isTo = edge.to.table === table.id;\n    const [fromTable, toTable] = isTo ? [related, table] : [table, related];\n    const path = getEdgeState({ edge, fromTable, toTable });\n    // Path\n    path.paths.forEach((d, index) => {\n        getEdgeSubElement(edge.id, \"path-main\", index).setAttribute(\"d\", d);\n    });\n    // Highlight\n    try {\n        const highlight = getEdgeSubElement(edge.id, \"highlight\");\n        highlight.setAttribute(\"path\", \"\");\n    } catch (e) {\n        // Nothing, it's ok to fail when highlight is not rendered\n    }\n};\n\nexport const onTableDragMove = (props: Props): DraggableEventHandler => {\n    return (_event, data) => {\n        const position: TablePosition = {\n            left: props.table.position.left + data.x,\n            top: props.table.position.top + data.y,\n        };\n        const table = { ...props.table, position };\n        props.relatedEdges.forEach(updateEdgeElements(table));\n    };\n};\n","import { RelatedEdge } from \"app/view/canvas/canvas\";\nimport { SetSelectIds } from \"app/view/select/select\";\nimport { EditTable } from \"diagram/edit/edit\";\nimport { TablePosition } from \"diagram/edit/layout\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport { DraggableEventHandler } from \"react-draggable\";\n\nconst round = (num: number) => Math.round(num / 16) * 16;\n\ninterface Props {\n    table: EditTable;\n    relatedEdges: RelatedEdge[];\n    setSelectId: SetSelectIds;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\nexport const onTableDragStop = (props: Props): DraggableEventHandler => {\n    return (_event, data) => {\n        if (data.x === 0 && data.y === 0) return;\n        const position: TablePosition = {\n            left: round(props.table.position.left + data.x),\n            top: round(props.table.position.top + data.y),\n        };\n        props.diagramDispatch({\n            type: \"set-table-position\",\n            payload: { id: props.table.id, position },\n        });\n    };\n};\n","import * as React from \"react\";\n\nexport type SelectIdType = \"table\" | \"ref\";\n\nexport interface SelectId {\n    type: SelectIdType;\n    value: number;\n}\n\nexport type SetSelectIds = React.Dispatch<React.SetStateAction<SelectId[]>>;\n\ninterface SelectState {\n    ids: SelectId[];\n    setIds: SetSelectIds;\n    // Derived values\n    tables: Set<number>;\n    refs: Set<number>;\n}\n\nconst filterId = (ids: SelectId[], type: SelectIdType): number[] =>\n    ids.filter((id) => id.type === type).map((id) => id.value);\n\nexport const getSelectSets = (ids: SelectId[]) => ({\n    tables: new Set(filterId(ids, \"table\")),\n    refs: new Set(filterId(ids, \"ref\")),\n});\n\nexport const isSameSelectIds = (a: SelectId[], b: SelectId[]): boolean => {\n    if (a.length !== b.length) return false;\n    const { tables, refs } = getSelectSets(a);\n    return b.every((id) => {\n        if (id.type === \"table\" && tables.has(id.value)) return true;\n        if (id.type === \"ref\" && refs.has(id.value)) return true;\n        return false;\n    });\n};\n\nexport const useSelect = (): SelectState => {\n    const [ids, setIds] = React.useState<SelectId[]>([]);\n    const { tables, refs } = React.useMemo(() => getSelectSets(ids), [ids]);\n    return { ids, setIds, tables, refs };\n};\n","import React from \"react\";\nimport s from \"./add.module.scss\";\nimport { Button } from \"@moai/core\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport { AddRowPayload } from \"diagram/state/reducer/row/add\";\nimport { icons } from \"@moai/icon\";\n\ninterface Props {\n    tableId: number;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\nconst addRow = (props: Props) => () => {\n    const payload: AddRowPayload = { tableId: props.tableId };\n    props.diagramDispatch({ type: \"add-row\", payload });\n};\n\nexport const TableBodyAdd = (props: Props) => (\n    <div className={s.container}>\n        <Button\n            onClick={addRow(props)}\n            icon={icons.add}\n            size={Button.size.small}\n            style={Button.style.flat}\n            isFullWidth={true}\n        >\n            Add\n        </Button>\n    </div>\n);\n","import * as React from \"react\";\n\nconst focusChildControl = (wrapper: Element): void => {\n    const element = wrapper.querySelector(\"select,input,button,[tabindex]\");\n    if (element instanceof HTMLElement) return element.focus();\n    throw Error(\"No focusable element under row-control\");\n};\n\nconst isControl = (element: Element): boolean =>\n    element.classList.contains(\"row-control\");\n\nconst getSibling = (element: Element, isPrevious: boolean): Element | null =>\n    isPrevious ? element.previousElementSibling : element.nextElementSibling;\n\n// Skip hidden rows group\nconst getNextParent = (curr: Element, isUp: boolean): Element | null => {\n    const currParent = curr.closest(\".table-row\");\n    if (currParent === null) throw Error(\".table-row is null\");\n    let nextParent: Element | null = getSibling(currParent, isUp);\n    while (nextParent !== null) {\n        if (nextParent.classList.contains(\"table-row\")) return nextParent;\n        nextParent = getSibling(nextParent, isUp);\n    }\n    return null;\n};\n\ntype Index = \"first\" | \"last\" | number;\n\nconst getChildControl = (parent: Element, index: Index): Element => {\n    if (index === \"first\") {\n        const first = parent.querySelector(\".row-control\");\n        if (first !== null) return first;\n    } else {\n        const all = parent.querySelectorAll(\".row-control\");\n        const control = all[index === \"last\" ? all.length - 1 : index];\n        if (control !== undefined) return control;\n    }\n    throw Error(\".table-row doesn't have .row-control\");\n};\n\nconst getControlIndex = (curr: Element): number => {\n    const parent = curr.closest(\".table-row\");\n    if (parent === null) throw Error(\".table-row is null\");\n    const all = parent.querySelectorAll(\".row-control\");\n    const index = [...all].indexOf(curr);\n    if (index !== -1) return index;\n    throw Error(\"curr is not a child of parent\");\n};\n\nconst getNextControl = (curr: Element, key: string): Element | null => {\n    switch (key) {\n        case \"ArrowRight\":\n        case \"ArrowLeft\": {\n            const isLeft = key === \"ArrowLeft\";\n            const next = getSibling(curr, isLeft);\n            if (next !== null && isControl(next)) return next;\n            const nextParent = getNextParent(curr, isLeft);\n            if (nextParent === null) return null;\n            return getChildControl(nextParent, isLeft ? \"last\" : \"first\");\n        }\n        case \"ArrowUp\":\n        case \"ArrowDown\": {\n            const isUp = key === \"ArrowUp\";\n            const nextParent = getNextParent(curr, isUp);\n            if (nextParent === null) return null;\n            const index = getControlIndex(curr);\n            return getChildControl(nextParent, index);\n        }\n    }\n    return null;\n};\n\nconst navigate = (event: React.KeyboardEvent) => {\n    const { target } = event;\n    if (!(target instanceof HTMLElement)) return;\n    if (target instanceof HTMLInputElement) return;\n    // current control\n    const control = target.closest(\".row-control\");\n    if (control === null) return;\n    // Prevent parent (viewport)'s scrolling\n    event.preventDefault();\n    const next = getNextControl(control, event.key);\n    if (next === null) return;\n    focusChildControl(next);\n};\n\nexport const navigateViaArrowKeys = (event: React.KeyboardEvent) => {\n    switch (event.key) {\n        case \"ArrowUp\":\n        case \"ArrowRight\":\n        case \"ArrowDown\":\n        case \"ArrowLeft\":\n            return navigate(event);\n    }\n};\n","import { background, borderColor, Button, DivPx, Icon, text } from \"@moai/core\";\nimport { icons } from \"@moai/icon\";\n\nimport { EditColumn } from \"diagram/edit/edit\";\nimport React from \"react\";\nimport s from \"./header.module.scss\";\n\ninterface Props {\n    columns: EditColumn[];\n    isExpand: boolean;\n    setIsExpand: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nconst className = [\n    background.secondary,\n    borderColor.weak,\n    s.container,\n    text.muted,\n].join(\" \");\n\nconst renderColumn = (column: EditColumn, index: number) => {\n    const cls = [s.field, index === 1 ? s.rightField : \"\"].join(\" \");\n    return <div key={column.id} className={cls} children={column.value.name} />;\n};\n\nconst getExpandIcon = (isExpand: Boolean): string =>\n    isExpand ? icons.doubleChevronLeft : icons.doubleChevronRight;\n\nexport const TableBodyHeader = (props: Props) => (\n    <div className={className}>\n        <DivPx size={8} />\n\n        {/* PADDING */}\n        <div className={Button.size.small.main}>\n            <Icon path={icons.blank} size={Button.size.small.iconSize} />\n        </div>\n\n        {/* COLUMN */}\n        {props.columns\n            .slice(0, props.isExpand ? undefined : 2)\n            .map(renderColumn)}\n\n        {/* EXPAND */}\n        <Button\n            onClick={() => props.setIsExpand((b) => !b)}\n            style={Button.style.flat}\n            size={Button.size.small}\n            icon={getExpandIcon(props.isExpand)}\n        />\n\n        <DivPx size={8} />\n    </div>\n);\n","import { Button, Icon } from \"@moai/core\";\nimport { icons } from \"@moai/icon\";\nimport { EditRef } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport { AddRefPayload } from \"diagram/state/reducer/ref/add\";\nimport { RemoveRefPayload } from \"diagram/state/reducer/ref/remove\";\nimport React from \"react\";\nimport { DragSourceMonitor, useDrag } from \"react-dnd\";\nimport { getEmptyImage } from \"react-dnd-html5-backend\";\nimport { RowDragItem, RowDropResult } from \"../drag\";\nimport s from \"./source.module.scss\";\n\ninterface Props {\n    tableId: number;\n    rowId: number;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    edge: EditRef | null;\n}\n\nconst beginDrag = (props: Props) => {\n    if (props.edge === null) return;\n    const payload: RemoveRefPayload = { id: props.edge.id };\n    props.diagramDispatch({ type: \"remove-ref\", payload });\n};\n\nconst collectDrag = (props: Props, monitor: DragSourceMonitor) => {\n    if (monitor.isDragging() === false) return false;\n    if (monitor.getItemType() !== \"row\") return false;\n    const { tableId, rowId } = monitor.getItem() as RowDragItem;\n    return props.tableId === tableId && props.rowId === rowId;\n};\n\nconst endDrag = (props: Props, monitor: DragSourceMonitor) => {\n    const result = monitor.getDropResult() as null | RowDropResult;\n    if (result === null) return;\n    const payload: AddRefPayload = {\n        from: { table: props.tableId, rows: [props.rowId] },\n        to: { table: result.tableId, rows: [result.rowId] },\n    };\n    props.diagramDispatch({ type: \"add-ref\", payload });\n};\n\nexport const RowDragSource = (props: Props) => {\n    const elementRef = React.useRef<HTMLDivElement>(null);\n\n    const { rowId, tableId } = props;\n    const [isDragging, dragRefCallback, previewRef] = useDrag({\n        item: { type: \"row\", rowId, tableId, elementRef },\n        begin: () => beginDrag(props),\n        end: (_item, monitor) => endDrag(props, monitor),\n        collect: (monitor) => collectDrag(props, monitor),\n    });\n\n    React.useEffect(() => {\n        previewRef(getEmptyImage());\n    }, [previewRef]);\n\n    React.useEffect(() => {\n        dragRefCallback(elementRef);\n    }, [dragRefCallback]);\n\n    const [isHover, setIsHover] = React.useState(false);\n\n    const isActive = isDragging || isHover || props.edge !== null;\n    const iconNode = (\n        <Icon\n            path={isActive ? icons.selection : icons.circle}\n            size={Button.size.small.iconSize}\n        />\n    );\n\n    return (\n        <div\n            ref={elementRef}\n            className={s.container}\n            onMouseEnter={() => setIsHover(true)}\n            onMouseLeave={() => setIsHover(false)}\n        >\n            <div\n                className={[\n                    s.button,\n                    isDragging ? s.dragging : \"\",\n                    Button.style.flat.main,\n                    Button.size.small.main,\n                    \"react-draggable-cancel\",\n                ].join(\" \")}\n                children={iconNode}\n            />\n        </div>\n    );\n};\n","import { Select } from \"@moai/core\";\nimport * as React from \"react\";\nimport s from \"./boolean.module.css\";\n\ninterface Props {\n    value: string;\n    setValue: (value: string) => void;\n}\n\nconst TRUE_PREFIX = [\"T\", \"t\", \"1\", \"Y\", \"y\"]; // true, 1, yes\n\nconst isBoolean = (text: string): boolean =>\n    TRUE_PREFIX.includes(text.charAt(0));\n\nexport const RowInputBoolean = (props: Props) => (\n    <div className={[s.container].join(\" \")}>\n        <Select<boolean>\n            value={isBoolean(props.value) ? true : false}\n            setValue={(bool) => {\n                props.setValue(bool ? \"TRUE\" : \"FALSE\");\n            }}\n            options={[\n                { value: true, label: \"TRUE\" },\n                { value: false, label: \"FALSE\" },\n            ]}\n            style={Select.style.flat}\n            size={Select.size.small}\n        />\n    </div>\n);\n","/**\n * Whether the browser's focus is just leaving from an Input edit view. This\n * helps 2 things:\n * - Only set the next input string to edit mode if coming from another edit\n *   input via \"Tab\" key\n * - Allow keeping the \"edit\" flag when travelling through non-editable widgets\n *   like the remove button\n */\nconst ref = { current: false, timeout: 0 };\n\nexport const isJustLeftEdit = (): boolean => ref.current;\n\nexport const setJustLeftEdit = (): void => {\n    window.clearTimeout(ref.timeout);\n    ref.current = true;\n    ref.timeout = window.setTimeout(() => {\n        ref.current = false;\n    }, 500);\n};\n","import { Input, outline } from \"@moai/core\";\nimport * as React from \"react\";\nimport { isJustLeftEdit, setJustLeftEdit } from \"./leave\";\nimport s from \"./string.module.scss\";\n\ninterface Props {\n    value: string;\n    setValue: (value: string) => void;\n}\n\ninterface InternalProps extends Props {\n    isEdit: boolean;\n    setIsEdit: React.Dispatch<React.SetStateAction<boolean>>;\n    viewRef: React.RefObject<HTMLDivElement>;\n}\n\nconst focusView = (props: InternalProps) => {\n    window.setTimeout(() => {\n        const view = props.viewRef.current;\n        if (view === null) throw Error(\"View is null\");\n        view.focus();\n    }, 0); // Can only focus view after React's render\n};\n\nconst Edit = (props: InternalProps) => (\n    <div className={s.edit}>\n        <Input\n            key={props.value} // uncontrolled\n            defaultValue={props.value}\n            style={Input.style.flat}\n            size={Input.size.small}\n            autoFocus\n            onBlur={(event) => {\n                props.setValue(event.currentTarget.value);\n                props.setIsEdit(false);\n            }}\n            onKeyDown={(event) => {\n                if (event.key !== \"Tab\") return;\n                setJustLeftEdit();\n            }}\n            onKeyUp={(event) => {\n                if (event.key !== \"Enter\") return;\n                props.setValue(event.currentTarget.value);\n                props.setIsEdit(false);\n                focusView(props);\n            }}\n        />\n    </div>\n);\n\nconst viewClass = [\n    s.view,\n    outline.always,\n    Input.size.small.main,\n    \"react-draggable-cancel\",\n    \"row-input-string-view\",\n].join(\" \");\n\nconst ViewValue = ({ value }: { value: string }) => {\n    if (value.length !== 0) return <span>{value}</span>;\n    return <span className={s.empty}>&lt;empty&gt;</span>;\n};\n\nconst View = (props: InternalProps) => (\n    <div\n        tabIndex={0}\n        children={<ViewValue value={props.value} />}\n        className={viewClass}\n        onDoubleClick={() => {\n            props.setIsEdit(true);\n        }}\n        onFocus={() => {\n            if (isJustLeftEdit()) props.setIsEdit(true);\n        }}\n        onKeyUp={(event) => {\n            if (event.key !== \"Enter\") return;\n            props.setIsEdit(true);\n        }}\n        ref={props.viewRef}\n    />\n);\n\nexport const RowInputString = (props: Props) => {\n    const [isEdit, setIsEdit] = React.useState(false);\n    const viewRef = React.useRef<HTMLDivElement>(null);\n    const internal: InternalProps = { ...props, isEdit, setIsEdit, viewRef };\n\n    return (\n        <div className={[s.container].join(\" \")}>\n            {isEdit ? <Edit {...internal} /> : <View {...internal} />}\n        </div>\n    );\n};\n","import { text } from \"@moai/core\";\nimport { EditColumn, EditRow } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport { UpdateRowPayload } from \"diagram/state/reducer/row/update\";\nimport React from \"react\";\nimport { RowInputBoolean } from \"./boolean/boolean\";\nimport s from \"./field.module.scss\";\nimport { RowInputString } from \"./string/string\";\n\ninterface Props {\n    tableId: number;\n    row: EditRow;\n    column: EditColumn;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    isRight: boolean;\n}\n\nconst updateRowField = (props: Props) => (value: string) => {\n    const { tableId, row, column } = props;\n    const [property, rowId] = [column.value.name, row.id];\n    if (value === row.value[property]) return;\n    const payload: UpdateRowPayload = { tableId, rowId, property, value };\n    props.diagramDispatch({ type: \"update-row\", payload });\n};\n\ninterface RowInputProps {\n    value: string;\n    setValue: (value: string) => void;\n}\n\ntype RowInputComponent = (props: RowInputProps) => JSX.Element;\n\nconst getInput = (props: Props): RowInputComponent => {\n    const { type } = props.column.value;\n    switch (type) {\n        case \"boolean\":\n            return RowInputBoolean;\n        case \"string\":\n            return RowInputString;\n        default:\n            throw Error(`Unknown column type \"${type}\"`);\n    }\n};\n\nexport const RowFieldInput = (props: Props) => (\n    <div className={props.isRight ? `${s.right} ${text.muted}` : \"\"}>\n        {getInput(props)({\n            value: props.row.value[props.column.value.name] ?? \"\",\n            setValue: updateRowField(props),\n        })}\n    </div>\n);\n","import React from \"react\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport { RemoveRowPayload } from \"diagram/state/reducer/row/remove\";\n\ninterface Params {\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    tableId: number;\n    rowId: number;\n}\n\ntype Event = React.KeyboardEvent<HTMLDivElement>;\n\nconst dispatchRemoveRow = (params: Params) => {\n    const { tableId, rowId } = params;\n    const payload: RemoveRowPayload = { tableId, rowId };\n    params.diagramDispatch({ type: \"remove-row\", payload });\n};\n\nexport const useRowKeyUpListeners = (params: Params) => {\n    const isEmpty = React.useRef(false);\n    return {\n        onKeyDown: (event: Event) => {\n            if (![\"Delete\", \"Backspace\"].includes(event.key)) return;\n            if (!(event.target instanceof HTMLInputElement)) return;\n            isEmpty.current = event.target.value === \"\";\n        },\n        onKeyUp: (event: Event) => {\n            if (![\"Delete\", \"Backspace\"].includes(event.key)) return;\n            if (event.target instanceof HTMLInputElement) {\n                if (isEmpty.current) dispatchRemoveRow(params);\n            } else {\n                dispatchRemoveRow(params);\n            }\n        },\n    };\n};\n","import { Button } from \"@moai/core\";\nimport { icons } from \"@moai/icon\";\nimport { EditRow } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport { RemoveRowPayload } from \"diagram/state/reducer/row/remove\";\nimport React from \"react\";\nimport s from \"./remove.module.scss\";\n\ninterface Props {\n    tableId: number;\n    row: EditRow;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\nconst removeRow = (props: Props) => () => {\n    const { tableId, row } = props;\n    const payload: RemoveRowPayload = { tableId, rowId: row.id };\n    props.diagramDispatch({ type: \"remove-row\", payload });\n};\n\nexport const RowRemoveButton = (props: Props) => (\n    <div className={[s.container].join(\" \")}>\n        <Button\n            onClick={removeRow(props)}\n            style={Button.style.flat}\n            size={Button.size.small}\n            icon={icons.remove}\n        />\n    </div>\n);\n","import { DivPx } from \"@moai/core\";\nimport { EditColumn, EditRef, EditRow } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport React from \"react\";\nimport { debugLog } from \"utils/debug\";\nimport { useRowDropTarget } from \"./drag/drop/drop\";\nimport { RowDragSource } from \"./drag/source/source\";\nimport { RowFieldInput } from \"./field/field\";\nimport { useRowKeyUpListeners } from \"./key\";\nimport { RowRemoveButton } from \"./remove/remove\";\nimport s from \"./row.module.scss\";\n\ninterface Props {\n    // row\n    row: EditRow;\n    edge: EditRef | null;\n    // table\n    tableId: number;\n    isTableEdit: boolean;\n    isTableColumnsExpand: boolean;\n    // diagram\n    columns: EditColumn[];\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\nconst RowPure = (props: Props) => {\n    debugLog(\"Table\", props.tableId, \"Row\", props.row.id, props.row.value.id);\n\n    const [isOver, dropRef] = useRowDropTarget({\n        tableId: props.tableId,\n        rowId: props.row.id,\n    });\n\n    return (\n        <div\n            {...useRowKeyUpListeners({\n                diagramDispatch: props.diagramDispatch,\n                tableId: props.tableId,\n                rowId: props.row.id,\n            })}\n            className={`${s.container} ${isOver ? s.over : \"\"}`}\n            ref={dropRef}\n        >\n            <DivPx size={8} />\n\n            {/* REMOVE */}\n            {props.isTableEdit && (\n                <div className=\"row-control\">\n                    <RowRemoveButton\n                        tableId={props.tableId}\n                        row={props.row}\n                        diagramDispatch={props.diagramDispatch}\n                    />\n                </div>\n            )}\n\n            {/* FIELDS */}\n            {props.columns\n                .slice(0, props.isTableColumnsExpand ? undefined : 2)\n                .map((column, index) => (\n                    <div className=\"row-control\" key={column.id}>\n                        <RowFieldInput\n                            tableId={props.tableId}\n                            row={props.row}\n                            column={column}\n                            diagramDispatch={props.diagramDispatch}\n                            isRight={index === 1}\n                        />\n                    </div>\n                ))}\n\n            {/* DRAG */}\n            {props.isTableEdit && (\n                <RowDragSource\n                    tableId={props.tableId}\n                    rowId={props.row.id}\n                    diagramDispatch={props.diagramDispatch}\n                    edge={props.edge}\n                />\n            )}\n\n            <DivPx size={8} />\n        </div>\n    );\n};\n\nexport const Row = React.memo(RowPure);\n","import { useDrop } from \"react-dnd\";\nimport { RowDropResult } from \"../drag\";\n\ninterface Params {\n    tableId: number;\n    rowId: number;\n}\n\nexport const useRowDropTarget = (params: Params) =>\n    useDrop({\n        accept: \"row\",\n        drop: () => {\n            const { tableId, rowId } = params;\n            const result: RowDropResult = { tableId, rowId };\n            return result;\n        },\n        collect: (monitor) => monitor.isOver(),\n    });\n","import { RelatedEdge } from \"app/view/canvas/canvas\";\nimport { EditRow, EditTable } from \"diagram/edit/edit\";\nimport * as React from \"react\";\nimport { EdgeFromRowMap, getTableRowsEdgeMap } from \"./edge-map\";\nimport { groupTableRows, TableRowsItem } from \"./group\";\n\ninterface SharedProps {\n    table: EditTable;\n    getRow: (edgeMap: EdgeFromRowMap, row: EditRow) => JSX.Element;\n    getHiddenRows: (item: EditRow[]) => JSX.Element;\n    getHideRowsButton: () => JSX.Element | null;\n}\n\ninterface Props extends SharedProps {\n    relatedEdges: RelatedEdge[];\n}\n\n/** Props of each Item, which could be a row or a group of rows */\ninterface ItemProps extends SharedProps {\n    edgeMap: EdgeFromRowMap;\n    item: TableRowsItem;\n}\n\nconst Item = (props: ItemProps) => {\n    // Single row\n    if (!Array.isArray(props.item))\n        return props.getRow(props.edgeMap, props.item);\n    // Group of rows\n    return props.table.isRowsExpand ? (\n        <React.Fragment>\n            {props.item.map(props.getRow.bind(null, props.edgeMap))}\n        </React.Fragment>\n    ) : (\n        props.getHiddenRows(props.item)\n    );\n};\n\nexport const TableRowsHeadless = (props: Props) => {\n    const { rows } = props.table.value;\n    const edgeMap = getTableRowsEdgeMap(props.table.id, props.relatedEdges);\n    const items = groupTableRows(rows, edgeMap);\n    return (\n        <>\n            {items.map((item) => {\n                const key = Array.isArray(item) ? item[0].id : item.id;\n                return <Item {...props} {...{ key, edgeMap, item }} />;\n            })}\n            {props.table.isRowsExpand &&\n                items.length !== rows.length &&\n                props.getHideRowsButton()}\n        </>\n    );\n};\n","import { EditEdge } from \"diagram/edit/edit\";\nimport { RelatedEdge } from \"app/view/canvas/canvas\";\n\nexport type EdgeFromRowMap = Map<number, EditEdge>; // row id to edge from\n\nexport const getTableRowsEdgeMap = (\n    tableId: number,\n    edges: RelatedEdge[]\n): EdgeFromRowMap => {\n    const map: EdgeFromRowMap = new Map();\n    edges.forEach((edge) => {\n        if (edge.edge.from.table !== tableId) return;\n        edge.edge.from.rows.forEach((rowId) => {\n            map.set(rowId, edge.edge);\n        });\n    });\n    return map;\n};\n","import { EditRow } from \"diagram/edit/edit\";\nimport { MAX_ROWS_COUNT } from \"app/table/utils\";\nimport { EdgeFromRowMap } from \"./edge-map\";\n\nexport type TableRowsItem = EditRow | EditRow[];\n\nexport const groupTableRows = (\n    rows: EditRow[],\n    edgeMap: EdgeFromRowMap\n): TableRowsItem[] => {\n    // When slotCount reaches 0 then start grouping rows\n    let slotCount = MAX_ROWS_COUNT - edgeMap.size;\n    // Prepare\n    const items: TableRowsItem[] = [];\n    let prevGroup: EditRow[] = [];\n    // Push row or group rows\n    rows.forEach((row) => {\n        if (slotCount > 0 || edgeMap.has(row.id)) {\n            if (prevGroup.length !== 0) items.push(prevGroup);\n            prevGroup = [];\n            items.push(row);\n            slotCount = slotCount - 1;\n        } else {\n            prevGroup.push(row);\n        }\n    });\n    if (prevGroup.length !== 0) items.push(prevGroup);\n    // Return\n    return items;\n};\n","import { Background, Border, Button } from \"@moai/core\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport * as React from \"react\";\n\ninterface RowsProps {\n    count: number;\n    tableId: number;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\nexport const TableHiddenRows = (props: RowsProps) => (\n    <Background color=\"secondary\">\n        <Border color=\"weak\" />\n        <div style={{ marginTop: -1 }} />\n        <Button\n            style={Button.style.flat}\n            size={Button.size.small}\n            isFullWidth\n            onClick={() => {\n                props.diagramDispatch({\n                    type: \"set-table-rows-expand\",\n                    payload: { id: props.tableId, isExpand: true },\n                });\n            }}\n            children={`${props.count} columns hidden`}\n        />\n        <div style={{ marginTop: -1 }} />\n        <Border color=\"weak\" />\n    </Background>\n);\n\ninterface ButtonProps {\n    tableId: number;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\nexport const TableHideRowsButton = (props: ButtonProps) => (\n    <Button\n        style={Button.style.flat}\n        size={Button.size.small}\n        isFullWidth\n        onClick={() => {\n            props.diagramDispatch({\n                type: \"set-table-rows-expand\",\n                payload: { id: props.tableId, isExpand: false },\n            });\n        }}\n        children=\"Hide columns\"\n    />\n);\n","import { getRowElementId } from \"app/row/dom\";\nimport { Row } from \"app/row/row\";\nimport { EdgeFromRowMap } from \"app/table/rows/edge-map\";\nimport { TableRowsHeadless } from \"app/table/rows/headless\";\nimport { RelatedEdge } from \"app/view/canvas/canvas\";\nimport { EditColumn, EditRow, EditTable } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport * as React from \"react\";\nimport { TableHiddenRows, TableHideRowsButton } from \"./hidden\";\n\n/** Shared props between a single row and a list of rows */\ninterface SharedProps {\n    // Table\n    table: EditTable;\n    isEdit: boolean;\n    isColumnsExpand: boolean;\n    // Diagram\n    columns: EditColumn[];\n    relatedEdges: RelatedEdge[];\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\n/** Props of this component */\ninterface Props extends SharedProps {}\n\n/** Props of each RowContainer */\ninterface RowContainerProps extends SharedProps {\n    edgeMap: EdgeFromRowMap;\n    row: EditRow;\n}\n\nconst RowContainer = (props: RowContainerProps) => (\n    <div\n        className=\"table-row\" // For keyboard navigation\n        id={getRowElementId(props.table.id, props.row.id)}\n    >\n        <Row\n            // row\n            row={props.row}\n            edge={props.edgeMap.get(props.row.id) ?? null}\n            // table\n            tableId={props.table.id}\n            isTableEdit={props.isEdit}\n            isTableColumnsExpand={props.isColumnsExpand}\n            // diagram\n            columns={props.columns}\n            diagramDispatch={props.diagramDispatch}\n        />\n    </div>\n);\n\nexport const TableBodyRows = (props: Props) => (\n    <TableRowsHeadless\n        // Data\n        table={props.table}\n        relatedEdges={props.relatedEdges}\n        // Components\n        getHideRowsButton={() => (\n            <TableHideRowsButton\n                tableId={props.table.id}\n                diagramDispatch={props.diagramDispatch}\n            />\n        )}\n        getHiddenRows={(item) => (\n            <TableHiddenRows\n                count={item.length}\n                tableId={props.table.id}\n                diagramDispatch={props.diagramDispatch}\n            />\n        )}\n        getRow={(edgeMap, row) => (\n            <RowContainer {...props} row={row} edgeMap={edgeMap} />\n        )}\n    />\n);\n","import { DivPx } from \"@moai/core\";\n\nimport { RelatedEdge } from \"app/view/canvas/canvas\";\nimport { EditColumn, EditTable } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport React from \"react\";\nimport { TableBodyAdd } from \"./add/add\";\nimport s from \"./body.module.scss\";\nimport { navigateViaArrowKeys } from \"./events/navigate\";\nimport { TableBodyHeader } from \"./header/header\";\nimport { TableBodyRows } from \"./rows/rows\";\n\ninterface Props {\n    // Table\n    table: EditTable;\n    // Edit\n    isEdit: boolean;\n    setIsEdit: React.Dispatch<React.SetStateAction<boolean>>;\n    // Diagram\n    columns: EditColumn[];\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    relatedEdges: RelatedEdge[];\n}\n\nconst onFocus = (props: Props) => (event: React.FocusEvent) => {\n    const related = event.relatedTarget as Node | null;\n    if (event.currentTarget.contains(related)) return;\n    if (event.target instanceof HTMLButtonElement) return;\n    props.setIsEdit(true);\n};\n\nexport const TableBody = (props: Props) => {\n    const [isExpand, setIsExpand] = React.useState(false);\n\n    React.useEffect(() => {\n        if (!props.isEdit) setIsExpand(false);\n    }, [props.isEdit]);\n\n    return (\n        <div className={s.container} onFocus={onFocus(props)}>\n            <DivPx size={8} />\n\n            {/* HEADER */}\n            {props.isEdit && (\n                <div className={s.header}>\n                    <TableBodyHeader\n                        columns={props.columns}\n                        isExpand={isExpand}\n                        setIsExpand={setIsExpand}\n                    />\n                </div>\n            )}\n\n            {/* BODY */}\n            <div onKeyDown={navigateViaArrowKeys}>\n                <TableBodyRows\n                    // rows\n                    table={props.table}\n                    isEdit={props.isEdit}\n                    isColumnsExpand={isExpand}\n                    // diagram\n                    columns={props.columns}\n                    relatedEdges={props.relatedEdges}\n                    diagramDispatch={props.diagramDispatch}\n                />\n            </div>\n\n            {/* FOOTER */}\n            {(props.isEdit || props.table.value.rows.length === 0) && (\n                <TableBodyAdd\n                    tableId={props.table.id}\n                    diagramDispatch={props.diagramDispatch}\n                />\n            )}\n\n            <DivPx size={8} />\n        </div>\n    );\n};\n","import { Input } from \"@moai/core\";\n\nimport { EditTable } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport { UpdateTableNamePayload } from \"diagram/state/reducer/table/update-name\";\nimport React from \"react\";\nimport s from \"./name.module.scss\";\nimport { TABLE_CLIENT_WIDTH } from \"app/table/utils\";\n\ninterface Props {\n    table: EditTable;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    setIsEdit: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\ntype FocusEvent = React.FocusEvent<HTMLInputElement>;\n\nconst updateTableName = (props: Props, event: FocusEvent) => {\n    const { value } = event.currentTarget;\n    if (value === props.table.value.name) return;\n    const payload: UpdateTableNamePayload = { id: props.table.id, name: value };\n    props.diagramDispatch({ type: \"update-table-name\", payload });\n};\n\nexport const HeaderName = (props: Props) => {\n    // Because HeaderName is draggable, this helps us identify if a drag\n    // happened or just a click\n    const offset = React.useRef({ x: 0, y: 0 });\n\n    // This is the component's internal isEdit state, which decides whether to\n    // show an Input or a div. It's different from props.isEdit, which is\n    // the whole table's edit state\n    const [isEdit, setIsEdit] = React.useState(false);\n    return (\n        <div\n            className={s.container}\n            style={{\n                width: TABLE_CLIENT_WIDTH - 16,\n            }}\n        >\n            {isEdit ? (\n                <Input\n                    key={props.table.value.name} // uncontrolled\n                    defaultValue={props.table.value.name}\n                    onBlur={(event) => {\n                        updateTableName(props, event);\n                        setIsEdit(false);\n                    }}\n                    onFocus={() => {\n                        props.setIsEdit(false);\n                    }}\n                    style={Input.style.flat}\n                    size={Input.size.small}\n                    autoFocus\n                />\n            ) : (\n                <div\n                    className={[s.view, Input.size.small.main].join(\" \")}\n                    onMouseDown={(event) => {\n                        offset.current.x = event.clientX;\n                        offset.current.y = event.clientY;\n                    }}\n                    onClick={(event) => {\n                        const { x: x1, y: y1 } = offset.current;\n                        const { clientX: x2, clientY: y2 } = event;\n                        // Only enter edit mode if this is not a drag\n                        if (x1 === x2 && y1 === y2) setIsEdit(true);\n                    }}\n                >\n                    {props.table.value.name}\n                </div>\n            )}\n        </div>\n    );\n};\n","import { Button, background } from \"@moai/core\";\nimport { icons } from \"@moai/icon\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport { RemoveTablePayload } from \"diagram/state/reducer/table/remove\";\nimport React from \"react\";\nimport s from \"./remove.module.css\";\n\ninterface Props {\n    tableId: number;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\nexport const TableHeaderRemove = (props: Props) => (\n    <div className={[s.container, background.primary].join(\" \")}>\n        <Button\n            style={Button.style.flat}\n            onClick={() => {\n                const payload: RemoveTablePayload = { id: props.tableId };\n                props.diagramDispatch({ type: \"remove-table\", payload });\n            }}\n            icon={icons.cross}\n            size={Button.size.small}\n        />\n    </div>\n);\n","\nimport { EditTable } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport React from \"react\";\nimport s from \"./header.module.scss\";\nimport { HeaderName } from \"./name/name\";\nimport { TableHeaderRemove } from \"./remove/remove\";\n\ninterface Props {\n    table: EditTable;\n    isEdit: boolean;\n    setIsEdit: React.Dispatch<React.SetStateAction<boolean>>;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\nexport const TableHeader: React.FC<Props> = (props) => (\n    <div className={`${s.container} ${props.isEdit ? s.edit : \"\"}`}>\n        <div className={s.main}>\n            <HeaderName\n                table={props.table}\n                setIsEdit={props.setIsEdit}\n                diagramDispatch={props.diagramDispatch}\n            />\n            <div className={s.remove}>\n                <TableHeaderRemove\n                    tableId={props.table.id}\n                    diagramDispatch={props.diagramDispatch}\n                />\n            </div>\n        </div>\n    </div>\n);\n","\n\n/** Turn off Edit mode on blur */\nexport const onTableBlur = (\n    isRowDragging: boolean,\n    setIsEdit: React.Dispatch<React.SetStateAction<boolean>>\n) => {\n    if (isRowDragging) return undefined;\n    return (event: React.FocusEvent<HTMLDivElement>) => {\n        const related = event.relatedTarget as Node | null;\n        if (event.currentTarget.contains(related)) return;\n        setIsEdit(false);\n    };\n};\n","import { background, Border, borderColor } from \"@moai/core\";\nimport { RowDragItem } from \"app/row/drag/drag\";\nimport { RelatedEdge } from \"app/view/canvas/canvas\";\nimport * as Select from \"app/view/select/select\";\nimport { EditColumn, EditTable } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport React from \"react\";\nimport { DragLayerMonitor, useDragLayer } from \"react-dnd\";\nimport { debugLog } from \"utils/debug\";\nimport { TableBody } from \"../body/body\";\nimport { TableHeader } from \"../header/header\";\nimport { onTableBlur } from \"./event\";\nimport s from \"./main.module.scss\";\n\nexport interface Props {\n    // Table\n    table: EditTable;\n    // Select\n    isSelected: boolean;\n    setSelectIds: Select.SetSelectIds;\n    // Diagram\n    relatedEdges: RelatedEdge[];\n    columns: EditColumn[];\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\nconst getCls = (props: Props, isEdit: boolean) => {\n    const cls = [s.container, background.primary, borderColor.strong];\n    if (props.isSelected) cls.push(s.selected);\n    if (isEdit) cls.push(s.edit);\n    return cls.join(\" \");\n};\n\nconst isMyRow = (props: Props) => (monitor: DragLayerMonitor): boolean => {\n    const item = monitor.getItem();\n    if (item === null) return false;\n    if (item.type !== \"row\") return false;\n    const rowItem = item as RowDragItem;\n    return rowItem.tableId === props.table.id;\n};\n\nconst toEdgeId = (edge: RelatedEdge): Select.SelectId => ({\n    type: \"ref\",\n    value: edge.edge.id,\n});\n\nconst onFocus = (props: Props) => () => {\n    props.setSelectIds((prev) => {\n        const next: Select.SelectId[] = props.relatedEdges.map(toEdgeId);\n        next.push({ type: \"table\", value: props.table.id });\n        return Select.isSameSelectIds(prev, next) ? prev : next;\n    });\n};\n\nconst TableMainPure: React.FC<Props> = (props) => {\n    debugLog(\"TableMain\", props.table.id, props.table.value.id);\n    const [isEdit, setIsEdit] = React.useState(false);\n    const isRowDragging: boolean = useDragLayer(isMyRow(props));\n    return (\n        <div\n            className={getCls(props, isEdit)}\n            onBlur={onTableBlur(isRowDragging, setIsEdit)}\n            tabIndex={0} // Avoid losing edit mode when dragging\n            onFocus={onFocus(props)}\n        >\n            <TableHeader\n                table={props.table}\n                isEdit={isEdit}\n                setIsEdit={setIsEdit}\n                diagramDispatch={props.diagramDispatch}\n            />\n            <Border color=\"weak\" />\n            <div style={{ marginTop: -1 }} />\n            <TableBody\n                // table\n                table={props.table}\n                // Edit\n                isEdit={isEdit}\n                setIsEdit={setIsEdit}\n                // Diagram\n                relatedEdges={props.relatedEdges}\n                diagramDispatch={props.diagramDispatch}\n                columns={props.columns}\n            />\n        </div>\n    );\n};\n\nexport const TableMain = React.memo(TableMainPure);\n","import { RelatedEdge } from \"app/view/canvas/canvas\";\nimport { SetSelectIds } from \"app/view/select/select\";\nimport { EditColumn, EditTable } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport React from \"react\";\nimport Draggable from \"react-draggable\";\nimport { debugLog } from \"utils/debug\";\nimport s from \"./active.module.css\";\nimport { onTableDragMove } from \"./drag/move\";\nimport { onTableDragStop } from \"./drag/stop\";\nimport { TableMain } from \"./main/main\";\n\ninterface Props {\n    table: EditTable;\n    // Diagram\n    columns: EditColumn[];\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    relatedEdges: RelatedEdge[];\n    // Select\n    isSelected: boolean;\n    setSelectId: SetSelectIds;\n    // View\n    zoom: number;\n}\n\nexport const TableActive = (props: Props) => {\n    debugLog(\"CanvasTable\");\n    const dragRef = React.useRef<HTMLDivElement>(null);\n    return (\n        <Draggable\n            position={{ x: 0, y: 0 }}\n            onDrag={onTableDragMove(props)}\n            onStop={onTableDragStop(props)}\n            nodeRef={dragRef}\n            scale={props.zoom}\n            cancel=\"input, button, select, .react-draggable-cancel\"\n        >\n            <div ref={dragRef} className={s.container}>\n                <TableMain\n                    table={props.table}\n                    // Select\n                    isSelected={props.isSelected}\n                    setSelectIds={props.setSelectId}\n                    // Diagram\n                    columns={props.columns}\n                    relatedEdges={props.relatedEdges}\n                    diagramDispatch={props.diagramDispatch}\n                />\n            </div>\n        </Draggable>\n    );\n};\n","import { background, borderColor } from \"@moai/core\";\nimport { EditTable } from \"diagram/edit/edit\";\nimport * as React from \"react\";\nimport { getTableEstimatedSize } from \"../utils\";\nimport s from \"./blank.module.css\";\n\ninterface Props {\n    table: EditTable;\n}\n\nconst cls = [s.container, background.primary, borderColor.strong].join(\" \");\n\nexport const TableBlank = (props: Props) => (\n    <div className={cls} style={getTableEstimatedSize(props.table)} />\n);\n","import { background, Border, borderColor } from \"@moai/core\";\nimport { getRowElementId } from \"app/row/dom\";\nimport { RelatedEdge } from \"app/view/canvas/canvas\";\nimport { EditColumn, EditRow, EditTable } from \"diagram/edit/edit\";\nimport * as React from \"react\";\nimport { TableRowsHeadless } from \"../rows/headless\";\nimport { TABLE_CLIENT_WIDTH } from \"../utils\";\n\ninterface SharedProps {\n    table: EditTable;\n    columns: EditColumn[];\n}\n\ninterface Props extends SharedProps {\n    relatedEdges: RelatedEdge[];\n}\n\ninterface RowProps extends SharedProps {\n    row: EditRow;\n}\n\nconst Field = (props: RowProps & { index: number }) => (\n    <div\n        style={{\n            flex: \"1 1 0px\",\n            overflow: \"hidden\",\n            textAlign: props.index === 1 ? \"right\" : undefined,\n        }}\n    >\n        {props.row.value[props.columns[props.index].value.name] ?? \"<empty>\"}\n    </div>\n);\n\nconst rowStyle: React.CSSProperties = {\n    display: \"flex\",\n    padding: \"0 16px\",\n};\n\nconst Row = (props: RowProps) => (\n    <div style={rowStyle} id={getRowElementId(props.table.id, props.row.id)}>\n        <Field {...props} index={0} />\n        <Field {...props} index={1} />\n    </div>\n);\n\nconst containerProps: React.HTMLAttributes<HTMLDivElement> = {\n    className: [background.primary, borderColor.strong].join(\" \"),\n    style: {\n        lineHeight: \"24px\",\n        borderStyle: \"solid\",\n        borderWidth: 1,\n        width: TABLE_CLIENT_WIDTH,\n    },\n};\n\nconst headerStyle: React.CSSProperties = {\n    padding: 8,\n    fontWeight: 600,\n    textAlign: \"center\",\n};\n\nconst HiddenRows = (props: { count: number }) => (\n    <div style={{ textAlign: \"center\" }}>{props.count} columns hidden</div>\n);\n\nexport const TableInactive = (props: Props) => (\n    <div {...containerProps}>\n        <div style={headerStyle}>{props.table.value.name}</div>\n        <Border color=\"weak\" />\n        <div style={{ padding: \"8px 0\" }}>\n            <TableRowsHeadless\n                table={props.table}\n                relatedEdges={props.relatedEdges}\n                getRow={(_edgeMap, row) => <Row {...props} row={row} />}\n                getHiddenRows={(item) => <HiddenRows count={item.length} />}\n                getHideRowsButton={() => null}\n            />\n        </div>\n    </div>\n);\n","import { RelatedEdge } from \"app/view/canvas/canvas\";\nimport { SetSelectIds } from \"app/view/select/select\";\nimport { EditColumn, EditTable } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport React from \"react\";\nimport { TableActive } from \"./active/active\";\nimport { TableBlank } from \"./blank/blank\";\nimport { TableInactive } from \"./inactive/inactive\";\nimport { getTableElementId } from \"./utils\";\n\ninterface Props {\n    // Table\n    table: EditTable;\n    // Diagram\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    relatedEdges: RelatedEdge[];\n    columns: EditColumn[];\n    // Select\n    isSelected: boolean;\n    setSelectId: SetSelectIds;\n    // View\n    viewportRef: React.RefObject<HTMLDivElement>;\n    zoom: number;\n    isCapture: boolean;\n}\n\nconst observerCallback = (\n    setIsVisible: React.Dispatch<React.SetStateAction<boolean>>\n) => (entries: IntersectionObserverEntry[]) => {\n    entries.forEach((entry) => {\n        setIsVisible(entry.isIntersecting);\n    });\n};\n\n/**\n * There are 3 versions of the inner table:\n * - active:   to render when the table is inside the user's viewport. This has\n *             all features and interactions\n * - inactive: lightweight version to render when capturing as image. This has\n *             complete info but no interactions\n * - blank:    a placeholder to render when the table is not inside the user's\n *             viewport. Think of this like a ghost version when the user\n *             scroll through their viewport.\n */\nconst getInnerTable = (props: Props, isVisible: boolean) => {\n    if (props.isCapture)\n        return (\n            <TableInactive\n                table={props.table}\n                columns={props.columns}\n                relatedEdges={props.relatedEdges}\n            />\n        );\n    if (!isVisible) return <TableBlank table={props.table} />;\n    return (\n        <TableActive\n            table={props.table}\n            // Diagram\n            columns={props.columns}\n            diagramDispatch={props.diagramDispatch}\n            relatedEdges={props.relatedEdges}\n            // Select\n            isSelected={props.isSelected}\n            setSelectId={props.setSelectId}\n            // View\n            zoom={props.zoom}\n        />\n    );\n};\n\nconst TablePure = (props: Props) => {\n    const ref = React.useRef<HTMLDivElement>(null);\n    const [isVisible, setSelfVisible] = React.useState(false);\n\n    React.useEffect(() => {\n        const callback = observerCallback(setSelfVisible);\n        const observer = new IntersectionObserver(callback, {\n            threshold: 0,\n            root: props.viewportRef.current,\n        });\n        if (ref.current === null) throw Error(\"ref is null\");\n        observer.observe(ref.current);\n        return () => observer.disconnect();\n    }, [props.viewportRef]);\n\n    return (\n        <div\n            id={getTableElementId(props.table.id)}\n            style={{\n                position: \"absolute\",\n                top: props.table.position.top,\n                left: props.table.position.left,\n                // Needs to be set here because this is top-level table\n                zIndex: props.isSelected ? 1 : 0,\n            }}\n            ref={ref}\n            // Temporary use to avoid using previous table size for new layout\n            data-name={props.table.value.name}\n            // Edges will watch this attribute to re-draw themselves\n            data-is-visible={isVisible}\n        >\n            {getInnerTable(props, isVisible)}\n        </div>\n    );\n};\n\nexport const Table = React.memo(TablePure);\n","import { SelectPosition, SelectBox } from \"./drag\";\n\nexport const getDragBox = (\n    startRef: React.RefObject<SelectPosition>,\n    event: React.MouseEvent\n): SelectBox => {\n    const start = startRef.current;\n    if (start === null) throw Error(\"start is null\");\n    const current = {\n        left: event.nativeEvent.offsetX,\n        top: event.nativeEvent.offsetY,\n    };\n    const top = Math.min(start.top, current.top);\n    const right = Math.max(start.left, current.left);\n    const bottom = Math.max(start.top, current.top);\n    const left = Math.min(start.left, current.left);\n    const [width, height] = [right - left, bottom - top];\n    return { top, left, width, height };\n};\n\nexport const setOpacity = (element: HTMLDivElement, opacity: string): void => {\n    element.style.opacity = opacity;\n};\n\nconst emptyBox: SelectBox = { top: 0, left: 0, width: 0, height: 0 };\n\nexport const setSize = (element: HTMLDivElement, box: SelectBox): void => {\n    element.style.width = `${box.width}px`;\n    element.style.height = `${box.height}px`;\n    element.style.transform = `translate(${box.left}px, ${box.top}px)`;\n};\n\nexport const setDragBoxStyles = (\n    boxRef: React.RefObject<HTMLDivElement>,\n    box: SelectBox | \"start\" | \"stop\"\n): void => {\n    const { current: element } = boxRef;\n    if (element === null) throw Error(\"boxRef is null\");\n    if (box === \"start\") {\n        setSize(element, emptyBox);\n        setOpacity(element, \"1\");\n    } else if (box === \"stop\") {\n        setOpacity(element, \"0\");\n    } else {\n        setSize(element, box);\n    }\n};\n","import { getTableElement } from \"app/table/utils\";\nimport { EditDiagram, EditRef } from \"diagram/edit/edit\";\nimport { TablePosition } from \"diagram/edit/layout\";\nimport { SelectId, SelectIdType } from \"../../select\";\nimport { SelectBox } from \"./drag\";\n\nconst isBoxOverlap = (a: SelectBox, b: SelectBox) => {\n    // If one rectangle is on the left side of other\n    if (a.left > b.left + b.width) return false;\n    if (b.left > a.left + a.width) return false;\n    // If one rectangle is above the other\n    if (a.top > b.top + b.height) return false;\n    if (b.top > a.top + a.height) return false;\n    // Otherwise it overlaps\n    return true;\n};\n\nexport const isTableOverlap = (props: {\n    target: SelectBox;\n    position: TablePosition;\n    element: HTMLDivElement;\n}) => {\n    if (props.element.dataset.isVisible !== \"true\") return false;\n    // Get box of \"table\"\n    const { clientWidth: width, clientHeight: height } = props.element;\n    const { top, left } = props.position;\n    const current: SelectBox = { width, height, top, left };\n    // Compare and set\n    return isBoxOverlap(props.target, current);\n};\n\ninterface Props {\n    diagram: EditDiagram;\n}\n\nconst getOverlapTables = (props: Props, target: SelectBox): number[] => {\n    return props.diagram.tables\n        .filter((table) =>\n            isTableOverlap({\n                target,\n                position: table.position,\n                element: getTableElement(table.id),\n            })\n        )\n        .map((table) => table.id);\n};\n\nconst getOverlapRefs = (props: Props, tables: number[]): number[] => {\n    const set = new Set(tables);\n    const isRelated = (ref: EditRef) => {\n        return set.has(ref.from.table) || set.has(ref.to.table);\n    };\n    return props.diagram.refs.filter(isRelated).map((ref) => ref.id);\n};\n\nconst getIds = (ids: number[], type: SelectIdType) =>\n    ids.map((value) => ({ type, value }));\n\nexport const getOverlapIds = (props: Props, box: SelectBox): SelectId[] => {\n    const tables = getOverlapTables(props, box);\n    const refs = getOverlapRefs(props, tables);\n    return [...getIds(tables, \"table\"), ...getIds(refs, \"ref\")];\n};\n","import { getTableElement } from \"app/table/utils\";\nimport { EditDiagram } from \"diagram/edit/edit\";\nimport { SelectBox } from \"./drag\";\nimport { isTableOverlap } from \"./overlap\";\nimport { getEdgeElement } from \"app/edge/utils\";\n\nexport const DRAG_SELECT_CLASS = \"temp-selected\";\n\nconst setClass = (element: Element, isOverlap: boolean) => {\n    if (isOverlap) {\n        element.classList.add(DRAG_SELECT_CLASS);\n    } else {\n        element.classList.remove(DRAG_SELECT_CLASS);\n    }\n};\n\nexport const setTempSelect = (target: SelectBox, diagram: EditDiagram) => {\n    const selected = new Set<number>();\n    diagram.tables.forEach((table) => {\n        const element = getTableElement(table.id);\n        const { position } = table;\n        const isOverlap = isTableOverlap({ target, element, position });\n        if (isOverlap) selected.add(table.id);\n        setClass(element, isOverlap);\n    });\n    diagram.refs.forEach((ref) => {\n        const isOverlap =\n            selected.has(ref.from.table) || selected.has(ref.to.table);\n        const element = getEdgeElement(ref.id);\n        setClass(element, isOverlap);\n    });\n};\n\nexport const resetTempSelect = () => {\n    document.querySelectorAll(`.${DRAG_SELECT_CLASS}`).forEach((element) => {\n        element.classList.remove(DRAG_SELECT_CLASS);\n    });\n};\n","import { EditDiagram } from \"diagram/edit/edit\";\nimport React from \"react\";\nimport { debugLog } from \"utils/debug\";\nimport { SelectId, SetSelectIds } from \"../../select\";\nimport { getDragBox, setDragBoxStyles } from \"./box\";\nimport s from \"./drag.module.css\";\nimport { resetTempSelect, setTempSelect } from \"./element\";\nimport { getOverlapIds } from \"./overlap\";\n\nexport interface SelectBox {\n    top: number;\n    left: number;\n    width: number;\n    height: number;\n}\n\nexport interface SelectPosition {\n    top: number;\n    left: number;\n}\n\ninterface Props {\n    diagram: EditDiagram;\n    setSelectIds: SetSelectIds;\n}\ntype ContainerRef = React.RefObject<HTMLDivElement>;\n\nconst setContainerStyles = (ref: ContainerRef, isDragging: boolean): void => {\n    const { current: element } = ref;\n    if (element === null) throw Error(\"containerRef is null\");\n    // Win table's z index, which is 1\n    element.style.zIndex = isDragging ? \"2\" : \"0\";\n};\n\n// For stable identities\nconst emptyIds: SelectId[] = [];\n\nconst SelectDragLayerPure = (props: Props) => {\n    debugLog(\"CanvasSelectDragPure\");\n    const start = React.useRef<null | SelectPosition>(null);\n    const isDraggingRef = React.useRef(false);\n    const boxRef = React.useRef<HTMLDivElement>(null);\n    const containerRef = React.useRef<HTMLDivElement>(null);\n    const spaceLockRef = React.useRef<boolean>(false);\n    return (\n        <div\n            className={s.container}\n            tabIndex={0}\n            onKeyDown={(event: React.KeyboardEvent) => {\n                if (event.key === \" \") spaceLockRef.current = true;\n            }}\n            onKeyUp={(event: React.KeyboardEvent) => {\n                if (event.key === \" \") spaceLockRef.current = false;\n            }}\n            onMouseDown={(event: React.MouseEvent) => {\n                if (spaceLockRef.current === true) return;\n                const { offsetX, offsetY } = event.nativeEvent;\n                start.current = { left: offsetX, top: offsetY };\n                isDraggingRef.current = true;\n                // Set drag styles\n                setContainerStyles(containerRef, true);\n                setDragBoxStyles(boxRef, \"start\");\n                // Reset ids\n                props.setSelectIds(emptyIds);\n            }}\n            onMouseMove={(event: React.MouseEvent) => {\n                if (isDraggingRef.current === false) return;\n                const box = getDragBox(start, event);\n                // Set styles\n                setDragBoxStyles(boxRef, box);\n                // Set select state (but not set select ids to avoid React's\n                // re-renders)\n                setTempSelect(box, props.diagram);\n            }}\n            onMouseUp={(event: React.MouseEvent) => {\n                if (isDraggingRef.current === false) return;\n                isDraggingRef.current = false;\n                // Reset drag styles\n                resetTempSelect();\n                setContainerStyles(containerRef, false);\n                setDragBoxStyles(boxRef, \"stop\");\n                // Set ids\n                const box = getDragBox(start, event);\n                const ids = getOverlapIds({ diagram: props.diagram }, box);\n                props.setSelectIds(ids);\n                // Done\n                start.current = null;\n            }}\n            ref={containerRef}\n        >\n            <div ref={boxRef} className={s.box}>\n                <div className={s.boxBg} />\n            </div>\n        </div>\n    );\n};\n\nexport const SelectDragLayer = React.memo(SelectDragLayerPure);\n","import { background } from \"@moai/core\";\nimport { EdgesCanvas } from \"app/edge/canvas/canvas\";\nimport { Table } from \"app/table/table\";\nimport { EditDiagram, EditEdge, EditTable } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport React from \"react\";\nimport { debugLog } from \"utils/debug\";\nimport { SelectDragLayer } from \"../select/canvas/drag/drag\";\nimport { SetSelectIds } from \"../select/select\";\nimport s from \"./canvas.module.scss\";\nimport { usePlatform, Platform } from \"utils/platform\";\n\ninterface Props {\n    // Diagram\n    diagram: EditDiagram;\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    // View\n    zoom: number;\n    viewportRef: React.RefObject<HTMLDivElement>;\n    isCapture: boolean;\n    // Select\n    selectedTables: Set<number>;\n    selectedRefs: Set<number>;\n    setSelectIds: SetSelectIds;\n}\n\nconst getContainerStyle = (\n    props: Props,\n    platform: Platform\n): React.CSSProperties => {\n    const [{ zoom }, { width, height }] = [props, props.diagram.size];\n    const halfMargin = (zoom - 1) / 2;\n    const margin = `${height * halfMargin}px ${width * halfMargin}px`;\n    const transform = zoom !== 1 ? `scale(${zoom})` : \"\";\n    const fontSize = platform === \"mac\" ? 12 : undefined;\n    return { width, height, transform, margin, fontSize };\n};\n\ntype TablesMap = Map<number, EditTable>;\n\nconst toTablesMap = (map: TablesMap, table: EditTable): TablesMap => {\n    map.set(table.id, table);\n    return map;\n};\n\nexport interface RelatedEdge {\n    edge: EditEdge;\n    table: EditTable;\n}\ntype RelatedEdgesMap = Map<number, RelatedEdge[]>;\n\nconst toRelatedEdgesMap = (tablesMap: TablesMap) => {\n    return (map: RelatedEdgesMap, edge: EditEdge) => {\n        const toTable = tablesMap.get(edge.to.table) as EditTable;\n        const fromTable = tablesMap.get(edge.from.table) as EditTable;\n        // From table\n        const fromKey = edge.from.table;\n        const fromEdges = map.get(fromKey) ?? [];\n        map.set(fromKey, fromEdges.concat({ edge, table: toTable }));\n        // To table\n        const toKey = edge.to.table;\n        const toEdges = map.get(toKey) ?? [];\n        map.set(toKey, toEdges.concat({ edge, table: fromTable }));\n        return map;\n    };\n};\n\n// To have stable identity\nconst emptyArray: RelatedEdge[] = [];\n\nexport const Canvas = (props: Props) => {\n    debugLog(\"Canvas\");\n\n    const { refs, tables } = props.diagram;\n\n    const tablesMap = React.useMemo(() => {\n        return tables.reduce(toTablesMap, new Map());\n    }, [tables]);\n\n    const edgesMap = React.useMemo(() => {\n        return refs.reduce(toRelatedEdgesMap(tablesMap), new Map());\n    }, [refs, tablesMap]);\n\n    const platform = usePlatform();\n\n    return (\n        <div\n            id=\"canvas\"\n            className={[s.container, background.secondary].join(\" \")}\n            style={getContainerStyle(props, platform)}\n        >\n            {/* Separate grid so both grid and background color is included\n            in exported image */}\n            <div className={s.grid} />\n            <SelectDragLayer\n                diagram={props.diagram}\n                setSelectIds={props.setSelectIds}\n            />\n            <EdgesCanvas\n                diagram={props.diagram}\n                diagramDispatch={props.diagramDispatch}\n                setSelectIds={props.setSelectIds}\n                selectedRefs={props.selectedRefs}\n                tablesMap={tablesMap}\n            />\n            {props.diagram.tables.map((table) => (\n                <Table\n                    key={table.id}\n                    // Table\n                    table={table}\n                    // Select\n                    isSelected={props.selectedTables.has(table.id)}\n                    setSelectId={props.setSelectIds}\n                    // Diagram\n                    columns={props.diagram.columns}\n                    relatedEdges={edgesMap.get(table.id) ?? emptyArray}\n                    diagramDispatch={props.diagramDispatch}\n                    // View\n                    viewportRef={props.viewportRef}\n                    zoom={props.zoom}\n                    isCapture={props.isCapture}\n                />\n            ))}\n        </div>\n    );\n};\n","import React from \"react\";\nimport dragscroll from \"dragscroll\";\n\nimport \"./use-drag.scss\";\n\n\ninterface State {\n    drag: boolean;\n    setDrag: React.Dispatch<React.SetStateAction<boolean>>;\n    element: HTMLDivElement;\n}\n\nconst onKeyUp = (state: State) => {\n    const me = () => {\n        state.setDrag(false);\n        state.element.classList.remove(\"dragscroll\");\n        dragscroll.reset();\n        state.element.removeEventListener(\"keyup\", me);\n    };\n    return me;\n};\n\nconst onKeyDown = (state: State) => (event: KeyboardEvent) => {\n    if (event.target instanceof HTMLInputElement) return;\n    if (event.key !== \" \") return;\n    event.preventDefault();\n    if (state.drag) return;\n\n    state.setDrag(true);\n    state.element.classList.add(\"dragscroll\");\n    dragscroll.reset();\n    state.element.addEventListener(\"keyup\", onKeyUp(state));\n};\n\nexport const useDragToScroll = (ref: React.RefObject<HTMLDivElement>) => {\n    const [drag, setDrag] = React.useState(false);\n\n    React.useEffect(() => {\n        const element = ref.current;\n        if (element === null) return;\n        const state = { drag, setDrag, element };\n\n        element.tabIndex = 0;\n        const listener = onKeyDown(state);\n        element.addEventListener(\"keydown\", listener);\n        return () => element.removeEventListener(\"keydown\", listener);\n    }, [drag, ref]);\n};\n","import { Button } from \"@moai/core\";\nimport { icons } from \"@moai/icon\";\nimport { getTableElement } from \"app/table/utils\";\nimport { EditTable } from \"diagram/edit/edit\";\nimport { getNumberId } from \"diagram/state/reducer/id\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport React from \"react\";\nimport { SetSelectIds } from \"../select/select\";\nimport { HeaderChildProps } from \"./utils/size\";\n\ninterface Props extends HeaderChildProps {\n    tables: EditTable[];\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    setSelectIds: SetSelectIds;\n}\n\n// @TODO unify this and the one at \"search\"?\nconst scrollOption: ScrollIntoViewOptions = {\n    behavior: \"smooth\",\n    block: \"center\",\n    inline: \"center\",\n};\n\nexport const HeaderAddTable = (props: Props) => {\n    const onClick = () => {\n        const id = getNumberId(props.tables.map((t) => t.id));\n        props.diagramDispatch({ type: \"add-table\", payload: { id } });\n        window.setTimeout(() => {\n            props.setSelectIds([{ type: \"table\", value: id }]);\n            getTableElement(id).scrollIntoView(scrollOption);\n        }, 0); // Run after React's render new table\n    };\n    return (\n        <Button\n            onClick={onClick}\n            size={props.size.button}\n            icon={icons.plus}\n            children=\"Table\"\n        />\n    );\n};\n","const prototype = CSSStyleDeclaration.prototype;\n\n// Safari has a bug where getPropertyValue won't return the \"#\" inside the url\n// path. See https://github.com/tsayen/dom-to-image/issues/125#issuecomment-672762287\nexport const fixSafari = () => {\n    // DomToImage uses cssText first, but we can't override this method so we\n    // need to disable it\n    Object.defineProperty(prototype, \"cssText\", { value: \"\" });\n\n    // DomToImage will then fallback to getPropertyValue, which we will\n    // override, so this is a backup version\n    Object.defineProperty(prototype, \"getPropertyValueOriginal\", {\n        value: prototype.getPropertyValue,\n    });\n\n    // Now we override the getPropertyValue method to ensure the \"#\" is there\n    Object.defineProperty(prototype, \"getPropertyValue\", {\n        value: function (name: string) {\n            const value: string = (this as any).getPropertyValueOriginal(name);\n            if (name === \"marker-start\" && value.endsWith(`edge-from\")`))\n                return \"url(#edge-from)\";\n            if (name === \"marker-end\" && value.endsWith(`edge-to\")`))\n                return \"url(#edge-to)\";\n            return value;\n        },\n    });\n};\n","import domtoimage from \"dom-to-image\";\nimport * as React from \"react\";\nimport { ExportImageFile, ExportImageFormat } from \"./image\";\nimport { fixSafari } from \"./safari-fix\";\n\nfixSafari();\n\ninterface Props {\n    canvas: Node;\n    format: ExportImageFormat;\n    setIsCapture: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nconst prefixes: Record<ExportImageFormat, string> = {\n    svg: \"data:image/svg+xml;charset=utf-8,\",\n    png: \"data:image/png;base64,\",\n};\n\nconst getImageData = async (props: Props): Promise<string> => {\n    switch (props.format) {\n        case \"png\":\n            return await domtoimage.toPng(props.canvas);\n        case \"svg\":\n            return await domtoimage.toSvg(props.canvas);\n    }\n};\n\nconst sleep = async (num: number): Promise<void> => {\n    await new Promise((resolve) => window.setTimeout(() => resolve(), num));\n};\n\nexport const getExportImageFile = async (\n    props: Props\n): Promise<ExportImageFile> => {\n    props.setIsCapture(true);\n    sleep(100); // wait just for sure that React and browser renders all\n    const data = await getImageData(props);\n    props.setIsCapture(false);\n    const prefix = prefixes[props.format];\n    const body = data.replace(prefix, \"\");\n    return { prefix, body };\n};\n","import { encode } from \"js-base64\";\nimport { ExportImageFile, ExportImageFormat } from \"./image\";\nimport { Platform } from \"utils/platform\";\n\n// TODO: Investigate more why the encoder can't encode these characters instead\n// of manually maintaining this blacklist\nconst badWords = [\"&%23xA;\", \"&%239;\"];\n\nconst toBase64 = (file: ExportImageFile): string => {\n    if (file.prefix.includes(\"base64\")) return file.body;\n    if (file.prefix.includes(\"utf-8\")) {\n        let clean = file.body;\n        badWords.forEach((word) => {\n            clean = clean.split(word).join(\"\");\n        });\n        return encode(clean);\n    }\n    throw Error(`Unknown file prefix: ${file.prefix}`);\n};\n\nconst METHOD_NAME = \"saveFile\";\n\nconst postMessage = (props: Props, target: \"mac\" | \"win\"): void => {\n    const body = {\n        data: toBase64(props.file),\n        ext: props.format,\n        name: \"diagram\",\n        title: \"Save diagram as…\",\n    };\n    switch (target) {\n        case \"mac\":\n            const handlers = (window as any).webkit.messageHandlers;\n            handlers[METHOD_NAME].postMessage(body);\n            return;\n        case \"win\":\n            const message = { message: METHOD_NAME, args: body };\n            (window as any).chrome.webview.postMessage(message);\n            return;\n    }\n};\n\nconst saveWithLink = (props: Props): void => {\n    const link = document.createElement(\"a\");\n    link.download = `diagram.${props.format}`;\n    link.href = `${props.file.prefix}${props.file.body}`;\n    link.click();\n};\n\ninterface Props {\n    file: ExportImageFile;\n    format: ExportImageFormat;\n    platform: Platform;\n}\n\nexport const saveExportImageFile = (props: Props): void => {\n    switch (props.platform) {\n        case \"web\":\n            return saveWithLink(props);\n        case \"mac\":\n        case \"win\":\n            return postMessage(props, props.platform);\n    }\n};\n","import { getExportImageFile } from \"./get\";\nimport { saveExportImageFile } from \"./save\";\nimport { Platform } from \"utils/platform\";\n\nexport type ExportImageFormat = \"png\" | \"svg\";\n\nexport interface ExportImageFile {\n    prefix: string;\n    body: string; // base64, without prefix\n}\n\ninterface Props {\n    setIsCapture: React.Dispatch<React.SetStateAction<boolean>>;\n    format: ExportImageFormat;\n    platform: Platform;\n}\n\nexport const exportAsImage = async (props: Props): Promise<void> => {\n    const { setIsCapture, format, platform } = props;\n    const canvas = document.getElementById(\"canvas\");\n    if (canvas === null) throw Error(\"Canvas is null\");\n    const file = await getExportImageFile({ canvas, format, setIsCapture });\n    saveExportImageFile({ file, format, platform });\n};\n","import { makeDiagramFromEdit } from \"diagram/edit/convert/from\";\nimport { EditDiagram } from \"diagram/edit/edit\";\nimport { Platform } from \"utils/platform\";\n\nexport const exportSqlDrivers = [\n    \"MySQL\",\n    \"MariaDB\",\n    \"SQLite\",\n    \"PostgreSQL\",\n    \"Cassandra\",\n    \"Snowflake\",\n    \"MicrosoftSQLServer\",\n];\n\ninterface Props {\n    diagram: EditDiagram;\n    driver: string;\n    platform: Platform;\n}\n\nconst METHOD_NAME = \"exportSQL\";\n\nexport const exportAsSql = (props: Props): void => {\n    const body = {\n        data: makeDiagramFromEdit(props.diagram),\n        driver: props.driver,\n    };\n    switch (props.platform) {\n        case \"web\":\n            return window.alert(\"Export to SQL requires TablePlus app\");\n        case \"mac\":\n            const handlers = (window as any).webkit.messageHandlers;\n            handlers[METHOD_NAME].postMessage(body);\n            return;\n        case \"win\":\n            const message = { message: METHOD_NAME, args: body };\n            (window as any).chrome.webview.postMessage(message);\n            return;\n    }\n};\n","import { ButtonMenu, ButtonMenuAction } from \"@moai/core\";\nimport { icons } from \"@moai/icon\";\nimport { EditDiagram } from \"diagram/edit/edit\";\nimport React from \"react\";\nimport { exportAsImage } from \"./image/image\";\nimport { exportAsSql, exportSqlDrivers } from \"./sql/sql\";\nimport { HeaderChildProps } from \"../utils/size\";\nimport { usePlatform } from \"utils/platform\";\n\ninterface Props extends HeaderChildProps {\n    diagram: EditDiagram;\n    setIsCapture: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nexport const HeaderExport = (props: Props) => {\n    const { diagram, setIsCapture } = props;\n    const platform = usePlatform();\n    const actions: ButtonMenuAction[] = [\n        {\n            label: \"Save as Image (PNG)\",\n            fn: () => exportAsImage({ setIsCapture, platform, format: \"png\" }),\n        },\n        {\n            label: \"Save as Web page (SVG)\",\n            fn: () => exportAsImage({ setIsCapture, platform, format: \"svg\" }),\n        },\n        { label: \"──────────\", fn: () => {}, disabled: true },\n        ...exportSqlDrivers.map((driver) => ({\n            label: `Export to ${driver}`,\n            fn: () => exportAsSql({ diagram, driver, platform }),\n        })),\n    ];\n    return (\n        <ButtonMenu\n            icon={icons.share}\n            actions={actions}\n            size={props.size.button}\n        />\n    );\n};\n","import { Button, ButtonGroup } from \"@moai/core\";\nimport { icons } from \"@moai/icon\";\nimport { UndoAction } from \"diagram/state/undo/undo\";\nimport React from \"react\";\nimport { HeaderChildProps } from \"./utils/size\";\n\ninterface Props<T> extends HeaderChildProps {\n    past: T[];\n    future: T[];\n    dispatch: React.Dispatch<UndoAction>;\n}\n\nexport const HeaderHistory = <T,>(props: Props<T>) => (\n    <ButtonGroup>\n        {[\n            <Button\n                key=\"undo\"\n                onClick={() => props.dispatch({ type: \"undo\" })}\n                icon={icons.undo}\n                size={props.size.button}\n                disabled={props.past.length === 0}\n            />,\n            <Button\n                key=\"redo\"\n                onClick={() => props.dispatch({ type: \"redo\" })}\n                icon={icons.redo}\n                size={props.size.button}\n                disabled={props.future.length === 0}\n            />,\n        ]}\n    </ButtonGroup>\n);\n","import { ButtonMenu } from \"@moai/core\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport * as React from \"react\";\nimport { icons } from \"@moai/icon\";\nimport { HeaderChildProps } from \"../utils/size\";\nimport { ImportRawPayload } from \"diagram/state/reducer/import/raw\";\n\ninterface Props extends HeaderChildProps {\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\nconst selfSamples = \"https://diagramplus.com/samples\";\n\nconst loadRemote = async (props: Props, url: string) => {\n    const raw = await fetch(url).then((response) => response.json());\n    const payload: ImportRawPayload = { raw, isAppend: false };\n    props.diagramDispatch({ type: \"import-raw\", payload });\n};\n\nexport const HeaderImport = (props: Props) => (\n    <ButtonMenu\n        icon={icons.import}\n        children=\"Import\"\n        actions={[\n            {\n                label: \"Import from Database (require TablePlus app)\",\n                disabled: true,\n                fn: () => {},\n            },\n            { label: \"──────────\", fn: () => {}, disabled: true },\n            {\n                label: \"Load sample 1 (3 small tables)\",\n                fn: () => loadRemote(props, `${selfSamples}/1.json`),\n            },\n            {\n                label: \"Load sample 2 (Table with many columns)\",\n                fn: () => loadRemote(props, `${selfSamples}/2.json`),\n            },\n            {\n                label: \"Load sample 3 (28 tables)\",\n                fn: () => loadRemote(props, `${selfSamples}/3.json`),\n            },\n            {\n                label: \"Load sample 4 (1710 tables)\",\n                fn: () => loadRemote(props, `${selfSamples}/4.json`),\n            },\n        ]}\n        size={props.size.button}\n    />\n);\n","import { Button, ButtonGroup, ButtonMenu, ButtonMenuAction } from \"@moai/core\";\nimport { icons } from \"@moai/icon\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport React from \"react\";\nimport { HeaderChildProps } from \"../utils/size\";\n\ninterface Props extends HeaderChildProps {\n    diagramDispatch: React.Dispatch<DiagramAction>;\n}\n\nconst layoutAction: DiagramAction = {\n    type: \"set-layout\",\n    payload: { type: \"auto\" },\n};\n\nconst setExpandAndArrange = (props: Props, payload: boolean): void => {\n    // @TODO: Should not fire 2 dispatch like this\n    props.diagramDispatch({ type: \"set-all-tables-rows-expand\", payload });\n    window.setTimeout(() => props.diagramDispatch(layoutAction), 0);\n};\n\nconst getActions = (props: Props): ButtonMenuAction[] => [\n    {\n        label: \"Expand all columns and Arrange\",\n        fn: () => setExpandAndArrange(props, true),\n    },\n    {\n        label: \"Collapse columns and Arrange\",\n        fn: () => setExpandAndArrange(props, false),\n    },\n];\n\nexport const HeaderLayout = (props: Props) => (\n    <ButtonGroup>\n        {[\n            <Button\n                key=\"arrange\"\n                icon={icons.layoutAuto}\n                onClick={() => void props.diagramDispatch(layoutAction)}\n                children=\"Arrange\"\n                size={props.size.button}\n            />,\n            <ButtonMenu\n                key=\"more\"\n                actions={getActions(props)}\n                icon={icons.caret}\n                size={props.size.button}\n            />,\n        ]}\n    </ButtonGroup>\n);\n","import { EditRef } from \"diagram/edit/edit\";\nimport { SelectId, SetSelectIds } from \"./select\";\n\ninterface Props {\n    tableId: number;\n    refs: EditRef[];\n    setSelectIds: SetSelectIds;\n}\n\nconst isRelated = (target: number) => (ref: EditRef): boolean =>\n    [ref.from.table, ref.to.table].includes(target);\n\ntype Event = React.MouseEvent<HTMLDivElement>;\n\nexport const getTableRelatedIds = (\n    tableId: number,\n    refs: EditRef[]\n): SelectId[] => {\n    const ids: SelectId[] = refs\n        .filter(isRelated(tableId))\n        .map((ref) => ({ type: \"ref\", value: ref.id }));\n    ids.push({ type: \"table\", value: tableId });\n    return ids;\n};\n\nexport const selectOnTableFocus = (props: Props) => (event: Event) => {\n    if (event.target instanceof HTMLInputElement) return;\n    const ids = getTableRelatedIds(props.tableId, props.refs);\n    props.setSelectIds(ids);\n};\n","import { Input } from \"@moai/core\";\nimport { icons } from \"@moai/icon\";\nimport { getTableElement } from \"app/table/utils\";\nimport { SetSelectIds } from \"app/view/select/select\";\nimport { getTableRelatedIds } from \"app/view/select/table\";\nimport { EditDiagram } from \"diagram/edit/edit\";\nimport React from \"react\";\nimport { HeaderChildProps } from \"./utils/size\";\n\ninterface Props extends HeaderChildProps {\n    diagram: EditDiagram;\n    setSelectIds: SetSelectIds;\n    \n}\n\nconst scrollOption: ScrollIntoViewOptions = {\n    behavior: \"smooth\",\n    block: \"center\",\n    inline: \"center\",\n};\n\nconst focusTable = (\n    diagram: EditDiagram,\n    setSelectIds: SetSelectIds,\n    name: string\n) => {\n    // Select the table in state\n    const table = diagram.tables.find((table) => table.value.name === name);\n    // Throwing error here because we already check in the useEffect\n    if (table === undefined) throw Error(\"table is undefined\");\n    setSelectIds(getTableRelatedIds(table.id, diagram.refs));\n    // Scroll the element into view\n    getTableElement(table.id).scrollIntoView(scrollOption);\n};\n\nexport const HeaderSearch = (props: Props) => {\n    const { diagram, setSelectIds } = props;\n\n    const tables: string[] = React.useMemo(() => {\n        const set = new Set<string>();\n        diagram.tables.forEach((table) => void set.add(table.value.name));\n        return [...set];\n    }, [diagram.tables]);\n\n    const [value, _setValue] = React.useState(\"\");\n\n    const focusIfNecessary = (name: string) => {\n        if (tables.includes(name) === false) return;\n        focusTable(diagram, setSelectIds, name);\n    };\n\n    return (\n        <div style={{ flex: \"1 1 0px\" }}>\n            <Input\n                icon={icons.search}\n                placeholder=\"Find table…\"\n                value={value}\n                setValue={(newValue) => {\n                    _setValue(newValue);\n                    focusIfNecessary(newValue);\n                }}\n                list={{ id: \"header-search\", values: tables }}\n                onKeyUp={(event) => {\n                    if (event.key !== \"Enter\") return;\n                    focusIfNecessary(value);\n                }}\n                size={props.size.input}\n            />\n        </div>\n    );\n};\n","import { Switcher, SwitcherOption } from \"@moai/core\";\nimport { icons } from \"@moai/icon\";\nimport { Theme } from \"app/view/theme/theme\";\nimport React from \"react\";\nimport { HeaderChildProps } from \"../utils/size\";\n\nconst options: SwitcherOption<Theme>[] = [\n    { value: \"theme-light\", icon: icons.flash, key: \"light\" },\n    { value: \"theme-auto\", label: \"System\", key: \"auto\" },\n    { value: \"theme-dark\", icon: icons.moon, key: \"dark\" },\n];\n\ninterface Props extends HeaderChildProps {\n    theme: Theme;\n    setTheme: React.Dispatch<React.SetStateAction<Theme>>;\n}\n\nexport const HeaderTheme = (props: Props) => (\n    <Switcher<Theme>\n        value={props.theme}\n        setValue={props.setTheme}\n        options={options}\n        size={props.size.button}\n    />\n);\n","import { Border, DivPx } from \"@moai/core\";\nimport * as React from \"react\";\nimport { usePlatform } from \"utils/platform\";\n\nexport const HeaderBigDiv = (): JSX.Element => {\n    const platform = usePlatform();\n    switch (platform) {\n        case \"mac\":\n            return (\n                <>\n                    <DivPx size={16} />\n                    <DivPx size={16} />\n                </>\n            );\n        default:\n            return (\n                <>\n                    <DivPx size={16} />\n                    <Border color=\"weak\" />\n                    <DivPx size={16} />\n                </>\n            );\n    }\n};\n","import { Button, ButtonGroup, Select } from \"@moai/core\";\nimport { icons } from \"@moai/icon\";\n\nimport React from \"react\";\nimport { HeaderChildProps } from \"./utils/size\";\n\ninterface Props extends HeaderChildProps {  \n    viewportRef: React.RefObject<HTMLDivElement>;\n    zoom: number;\n    setZoom: React.Dispatch<React.SetStateAction<number>>;\n}\n\nexport const HeaderZoom = (props: Props) => (\n    <ButtonGroup>\n        {[\n            <Button\n                key=\"out\"\n                icon={icons.zoomOut}\n                onClick={() => props.setZoom(props.zoom - 0.25)}\n                size={props.size.button}\n            />,\n            <Select\n                key=\"select\"\n                value={props.zoom}\n                setValue={props.setZoom}\n                options={[25, 50, 75, 100, 125, 150, 175, 200].map((value) => {\n                    return { label: `${value}%`, value: value / 100 };\n                })}\n                size={props.size.select}\n            />,\n            <Button\n                key=\"in\"\n                icon={icons.zoomIn}\n                onClick={() => props.setZoom(props.zoom + 0.25)}\n                size={props.size.button}\n            />,\n        ]}\n    </ButtonGroup>\n);\n","import { DivPx } from \"@moai/core\";\nimport { SetSelectIds } from \"app/view/select/select\";\nimport { EditDiagram } from \"diagram/edit/edit\";\nimport { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport { UndoAction } from \"diagram/state/undo/undo\";\nimport React from \"react\";\nimport { Platform, usePlatform } from \"utils/platform\";\nimport { Theme } from \"../theme/theme\";\nimport { HeaderAddTable } from \"./add\";\nimport { HeaderExport } from \"./export/export\";\nimport { HeaderHistory } from \"./history\";\nimport { HeaderImport } from \"./import/import\";\nimport { HeaderLayout } from \"./layout/layout\";\nimport { HeaderSearch } from \"./search\";\nimport s from \"./style/header.module.scss\";\nimport sMac from \"./style/mac.module.scss\";\nimport sWin from \"./style/win.module.scss\";\nimport { HeaderTheme } from \"./theme/theme\";\nimport { HeaderBigDiv } from \"./utils/div\";\nimport { getHeaderSize } from \"./utils/size\";\nimport { HeaderZoom } from \"./zoom\";\n\nexport interface HeaderPrimaryProps {\n    // Diagram\n    diagram: EditDiagram;\n    diagramPast: EditDiagram[];\n    diagramFuture: EditDiagram[];\n    diagramDispatch: React.Dispatch<DiagramAction | UndoAction>;\n    // Theme\n    theme: Theme;\n    setTheme: React.Dispatch<React.SetStateAction<Theme>>;\n    // View\n    viewportRef: React.RefObject<HTMLDivElement>;\n    zoom: number;\n    setZoom: React.Dispatch<React.SetStateAction<number>>;\n    setIsCapture: React.Dispatch<React.SetStateAction<boolean>>;\n    // Select\n    setSelectIds: SetSelectIds;\n}\n\nconst getStyle = (platform: Platform): string => {\n    const cls = [s.container];\n    if (platform === \"mac\") cls.push(sMac.container);\n    if (platform === \"win\") cls.push(sWin.container);\n    return cls.join(\" \");\n};\n\nexport const ViewHeaderPure = (props: HeaderPrimaryProps) => {\n    const platform = usePlatform();\n    const size = getHeaderSize(platform);\n    return (\n        <div className={[s.container, getStyle(platform)].join(\" \")}>\n            <div className={s.platformPad} />\n            <DivPx size={16} />\n            {platform === \"win\" && (\n                <>\n                    <HeaderExport\n                        diagram={props.diagram}\n                        setIsCapture={props.setIsCapture}\n                        size={size}\n                    />\n                    <HeaderBigDiv />\n                </>\n            )}\n            {platform === \"web\" && (\n                <>\n                    <HeaderImport\n                        diagramDispatch={props.diagramDispatch}\n                        size={size}\n                    />\n                    <HeaderBigDiv />\n                </>\n            )}\n            <HeaderAddTable\n                tables={props.diagram.tables}\n                diagramDispatch={props.diagramDispatch}\n                setSelectIds={props.setSelectIds}\n                size={size}\n            />\n            <DivPx size={16} />\n            <HeaderHistory\n                past={props.diagramPast}\n                future={props.diagramFuture}\n                dispatch={props.diagramDispatch}\n                size={size}\n            />\n            <HeaderBigDiv />\n            <HeaderSearch\n                diagram={props.diagram}\n                setSelectIds={props.setSelectIds}\n                size={size}\n            />\n            <HeaderBigDiv />\n            <HeaderLayout diagramDispatch={props.diagramDispatch} size={size} />\n            <DivPx size={16} />\n            <HeaderZoom\n                viewportRef={props.viewportRef}\n                zoom={props.zoom}\n                setZoom={props.setZoom}\n                size={size}\n            />\n            {platform !== \"win\" && (\n                <>\n                    <DivPx size={16} />\n                    <HeaderExport\n                        diagram={props.diagram}\n                        setIsCapture={props.setIsCapture}\n                        size={size}\n                    />\n                </>\n            )}\n            {platform === \"web\" && (\n                <>\n                    <HeaderBigDiv />\n                    <HeaderTheme\n                        theme={props.theme}\n                        setTheme={props.setTheme}\n                        size={size}\n                    />\n                    {/* <DivPx size={16} /> */}\n                </>\n            )}\n            {/* <HeaderReport size={size} /> */}\n            <DivPx size={16} />\n        </div>\n    );\n};\n\nexport const ViewHeader = React.memo(ViewHeaderPure);\n","import * as Moai from \"@moai/core\";\nimport { Platform } from \"utils/platform\";\n\nexport interface HeaderSize {\n    button: Moai.ButtonSize;\n    input: Moai.InputSize;\n    select: Moai.SelectSize;\n}\n\nexport interface HeaderChildProps {\n    size: HeaderSize;\n}\n\nexport const getHeaderSize = (platform: Platform): HeaderSize => {\n    switch (platform) {\n        case \"mac\":\n            return {\n                button: Moai.Button.size.small,\n                input: Moai.Input.size.small,\n                select: Moai.Select.size.small,\n            };\n        default:\n            return {\n                button: Moai.Button.size.medium,\n                input: Moai.Input.size.medium,\n                select: Moai.Select.size.medium,\n            };\n    }\n};\n","import { ProgressCircle, background, DivPx } from \"@moai/core\";\nimport React from \"react\";\nimport s from \"./progress.module.scss\";\nimport { addExternalFn } from \"utils/external\";\n\nexport type Progress = boolean | number;\n\nconst registerExternal = addExternalFn(\"setProgressIndicator\");\n\nexport const ViewProgress = () => {\n    const [progress, setProgress] = React.useState<Progress>(false);\n    const [text, setText] = React.useState<string | undefined>(undefined);\n\n    React.useEffect(() => {\n        const fn = (progress: Progress, text?: string) => {\n            setProgress(progress);\n            setText(text);\n        };\n        registerExternal(fn);\n    }, []);\n\n    if (progress === false) return null;\n    return (\n        <div className={[s.container, background.secondary].join(\" \")}>\n            <div className={s.body}>\n                <ProgressCircle\n                    size={24}\n                    value={progress === true ? null : progress}\n                />\n                {text !== undefined && (\n                    <>\n                        <DivPx size={16} />\n                        <div>{text}</div>\n                    </>\n                )}\n            </div>\n        </div>\n    );\n};\n","import { makeDiagramFromEdit } from \"diagram/edit/convert/from\";\nimport { EditDiagram } from \"diagram/edit/edit\";\nimport * as React from \"react\";\nimport { getSelectSets, SelectId } from \"../select\";\n\ninterface Props {\n    ids: SelectId[];\n    diagram: EditDiagram;\n}\n\nconst catchCopy = (props: Props, event: ClipboardEvent) => {\n    if (event.target instanceof HTMLInputElement) return;\n    if (event.target instanceof HTMLTextAreaElement) return;\n    if (props.ids.length === 0) return;\n    const { tables: selected } = getSelectSets(props.ids);\n    if (selected.size === 0) return;\n    const edit: EditDiagram = {\n        columns: props.diagram.columns,\n        tables: props.diagram.tables.filter((table) => {\n            return selected.has(table.id);\n        }),\n        refs: props.diagram.refs.filter((ref) => {\n            return selected.has(ref.from.table) && selected.has(ref.to.table);\n        }),\n        size: { width: 0, height: 0 },\n        schema: props.diagram.schema,\n    };\n    const diagram = makeDiagramFromEdit(edit);\n    const text = JSON.stringify(diagram);\n    event.clipboardData?.setData(\"text/plain\", text);\n    event.preventDefault();\n};\n\n// @TODO: These should not belong to \"select\"\nexport const useCanvasCatchCopy = (props: Props) => {\n    const { ids, diagram } = props;\n    React.useEffect(() => {\n        const listener = (event: ClipboardEvent) => {\n            return catchCopy({ ids, diagram }, event);\n        };\n        document.addEventListener(\"copy\", listener);\n        return () => document.removeEventListener(\"copy\", listener);\n    }, [ids, diagram]);\n};\n","import { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport * as React from \"react\";\nimport { SelectId, SelectIdType } from \"../select\";\n\nconst filterIds = (ids: SelectId[], type: SelectIdType): number[] =>\n    ids.filter((id) => id.type === type).map((id) => id.value);\n\ninterface Props {\n    ids: SelectId[];\n    diagramDispatch: React.Dispatch<DiagramAction>;\n    event: React.KeyboardEvent;\n}\n\nexport const catchDelete = ({ ids, event, diagramDispatch }: Props) => {\n    if ([\"Backspace\", \"Delete\"].includes(event.key) === false) return;\n    if (event.target instanceof HTMLInputElement) return;\n    if (event.target instanceof HTMLTextAreaElement) return;\n    diagramDispatch({\n        type: \"remove-multiple-refs\",\n        payload: { ids: filterIds(ids, \"ref\") },\n    });\n    diagramDispatch({\n        type: \"remove-multiple-tables\",\n        payload: { ids: filterIds(ids, \"table\") },\n    });\n    event.stopPropagation();\n};\n","import { DiagramAction } from \"diagram/state/reducer/reducer\";\nimport * as React from \"react\";\nimport { ImportJsonPayload } from \"diagram/state/reducer/import/import\";\n\ninterface Props {\n    dispatch: React.Dispatch<DiagramAction>;\n}\n\nconst catchPaste = (props: Props, event: ClipboardEvent) => {\n    if (event.target instanceof HTMLInputElement) return;\n    if (event.target instanceof HTMLTextAreaElement) return;\n    const text = event.clipboardData?.getData(\"text/plain\") ?? \"\";\n    const payload: ImportJsonPayload = { text, isAppend: true };\n    props.dispatch({ type: \"import-json\", payload });\n};\n\nexport const useCanvasCatchPaste = (props: Props) => {\n    const { dispatch } = props;\n    React.useEffect(() => {\n        const listener = (event: ClipboardEvent) => {\n            return catchPaste({ dispatch }, event);\n        };\n        document.addEventListener(\"paste\", listener);\n        return () => document.removeEventListener(\"paste\", listener);\n    }, [dispatch]);\n};\n","import React from \"react\";\nimport { addExternalFnDirect } from \"utils/external\";\nimport { Platform, usePlatform } from \"utils/platform\";\n\nexport type Theme = \"theme-light\" | \"theme-dark\" | \"theme-auto\";\n\nlet initialTheme: Theme = \"theme-light\";\naddExternalFnDirect(\"setTheme\", (text: string) => {\n    initialTheme = (text.includes(\"theme-\") ? text : `theme-${text}`) as Theme;\n    document.documentElement.classList.add(initialTheme);\n});\n\nconst getInitial = (platform: Platform): Theme => {\n    switch (platform) {\n        case \"mac\":\n            return \"theme-auto\";\n        case \"win\":\n            return initialTheme;\n        case \"web\":\n            const stored = localStorage.getItem(\"theme\");\n            return (stored as Theme | null) ?? \"theme-auto\";\n        default:\n            throw Error(\"Unknown platform\");\n    }\n};\n\nexport const useTheme = () => {\n    const platform = usePlatform();\n    const [theme, setTheme] = React.useState<Theme>(() => getInitial(platform));\n\n    // Save\n    React.useEffect(() => {\n        if (platform !== \"web\") return;\n        window.localStorage.setItem(\"theme\", theme);\n    }, [theme, platform]);\n\n    // Reset the value we set in load time\n    React.useEffect(() => {\n        document.documentElement.classList.remove(initialTheme);\n    }, []);\n\n    // Apply\n    React.useEffect(() => {\n        document.documentElement.classList.add(theme);\n        return () => document.documentElement.classList.remove(theme);\n    }, [theme]);\n\n    // External\n    React.useEffect(() => {\n        addExternalFnDirect(\"setTheme\", (text: string): void => {\n            const theme = text.includes(\"theme-\") ? text : `theme-${text}`;\n            setTheme(theme as Theme);\n        });\n    }, []);\n\n    return { theme, setTheme };\n};\n","import { background, Border } from \"@moai/core\";\nimport { RowDragLayer } from \"app/row/drag/layer/layer\";\nimport { useDiagram } from \"diagram/state/use-diagram\";\nimport React from \"react\";\nimport { Canvas } from \"./canvas/canvas\";\nimport { useDragToScroll } from \"./drag/use-drag\";\nimport { ViewHeader } from \"./header/header\";\nimport { ViewProgress } from \"./progress/progress\";\nimport { useCanvasCatchCopy } from \"./select/canvas/copy\";\nimport { catchDelete } from \"./select/canvas/delete\";\nimport { useCanvasCatchPaste } from \"./select/canvas/paste\";\nimport { useSelect } from \"./select/select\";\nimport s from \"./view.module.scss\";\nimport { useTheme } from \"./theme/theme\";\n\nexport type Mode = \"design\" | \"present\" | \"structure\";\n\nexport const View = () => {\n    const diagram = useDiagram();\n    const [zoom, setZoom] = React.useState<number>(1);\n    const viewportRef = React.useRef<HTMLDivElement>(null);\n    const select = useSelect();\n    const { theme, setTheme } = useTheme();\n    const [isCapture, setIsCapture] = React.useState(false);\n\n    useCanvasCatchCopy({ diagram: diagram.history.present, ids: select.ids });\n    useCanvasCatchPaste({ dispatch: diagram.dispatch });\n\n    // Drag to scroll viewport\n    useDragToScroll(viewportRef);\n\n    return (\n        <div className={s.container}>\n            <div className={s.header}>\n                <ViewHeader\n                    // Diagram\n                    diagram={diagram.history.present}\n                    diagramPast={diagram.history.past}\n                    diagramFuture={diagram.history.future}\n                    diagramDispatch={diagram.dispatch}\n                    // Theme\n                    theme={theme}\n                    setTheme={setTheme}\n                    // View\n                    viewportRef={viewportRef}\n                    zoom={zoom}\n                    setZoom={setZoom}\n                    setIsCapture={setIsCapture}\n                    // Select\n                    setSelectIds={select.setIds}\n                />\n            </div>\n            <Border color=\"strong\" />\n            <div className={`${s.body} ${background.secondary}`}>\n                <div\n                    className={s.viewport}\n                    tabIndex={0}\n                    ref={viewportRef}\n                    onKeyUp={(event) => {\n                        catchDelete({\n                            ids: select.ids,\n                            diagramDispatch: diagram.dispatch,\n                            event,\n                        });\n                    }}\n                >\n                    <Canvas\n                        // Diagram\n                        diagram={diagram.history.present}\n                        diagramDispatch={diagram.dispatch}\n                        // View\n                        zoom={zoom}\n                        viewportRef={viewportRef}\n                        isCapture={isCapture}\n                        // Select\n                        selectedRefs={select.refs}\n                        selectedTables={select.tables}\n                        setSelectIds={select.setIds}\n                    />\n                </div>\n                <ViewProgress />\n            </div>\n            <RowDragLayer viewportRef={viewportRef} />\n        </div>\n    );\n};\n","import { DivEm, MutedDiv, Paragraph } from \"@moai/core\";\nimport React from \"react\";\nimport s from \"./links.module.scss\";\n\nconst TPLink = () => (\n    <span>\n        <span>© 2020 </span>\n        <a\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            href=\"https://tableplus.com\"\n        >\n            TablePlus Inc.\n        </a>\n    </span>\n);\n\nexport const FooterLinks = () => (\n    <MutedDiv>\n        <div className={s.container}>\n            <Paragraph>\n                <a href=\"mailto:nick@tableplus.com\">Email us</a>\n                <DivEm />\n                <a\n                    rel=\"noopener noreferrer\"\n                    href=\"https://github.com/TablePlus/\"\n                >\n                    Issue tracker\n                </a>\n                <span className={s.tptop}>\n                    <DivEm />\n                    <TPLink />\n                </span>\n            </Paragraph>\n            <Paragraph>\n                <span className={s.nobreak}>1100-1959 Upper Water Street</span>\n                <span> </span>\n                <span className={s.nobreak}>Halifax NS Canada.</span>\n                <span> </span>\n                <span className={s.nobreak}>All rights reserved</span>\n            </Paragraph>\n        </div>\n    </MutedDiv>\n);\n","import React from \"react\";\n\nimport { Paragraph, Strong } from \"@moai/core\";\nimport s from \"./privacy.module.scss\";\n\ninterface Props {\n    dataText: string;\n}\n\nexport const FooterPrivacy: React.FC<Props> = ({ dataText }) => (\n    <div className={s.container}>\n        <Paragraph>\n            <Strong>Your data are safe here. </Strong>\n            <span>\n                We process your {dataText} right in the browser, so no data\n                shall leave this device.\n            </span>\n        </Paragraph>\n    </div>\n);\n","import { DivGrow, DivPx } from \"@moai/core\";\nimport logo from \"./logo.png\";\nimport { FooterLinks } from \"./links/links\";\nimport { FooterPrivacy } from \"./privacy/privacy\";\nimport React from \"react\";\nimport s from \"./footer.module.scss\";\n\nconst Logo = () => (\n    <a\n        className={s.logo}\n        href=\"https://tableplus.com\"\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n    >\n        <img alt=\"TablePlus logo\" src={logo} width=\"auto\" height={32} />\n    </a>\n);\n\nexport const Footer = () => (\n    <div className={s.container}>\n        <DivPx size={16} />\n        <FooterPrivacy dataText=\"diagram\" />\n        <DivGrow />\n        <FooterLinks />\n        <DivPx size={16} />\n        <Logo />\n        <DivPx size={16} />\n    </div>\n);\n","import { Border, scrollbar } from \"@moai/core\";\nimport { View } from \"app/view/view\";\nimport React from \"react\";\nimport { usePlatform } from \"utils/platform\";\nimport s from \"./app.module.scss\";\nimport { Footer } from \"./footer/footer\";\n\nexport const App = () => {\n    const platform = usePlatform();\n    return (\n        <div className={[s.container, scrollbar.custom].join(\" \")}>\n            <div className={s.body}>\n                <View />\n            </div>\n            {platform === \"web\" && (\n                <>\n                    <Border color=\"strong\" />\n                    <div className={s.footer}>\n                        <Footer />\n                    </div>\n                </>\n            )}\n        </div>\n    );\n};\n","import * as React from \"react\";\nimport { Checkbox, Input, Paragraph, MutedDiv } from \"@moai/core\";\nimport s from \"./item.module.css\";\n\nexport interface ReportItemState {\n    has: boolean;\n    setHas: React.Dispatch<React.SetStateAction<boolean>>;\n    text: string;\n    setText: React.Dispatch<React.SetStateAction<string>>;\n}\n\ninterface Props {\n    label: string;\n    state: ReportItemState;\n    placeholder?: string;\n    children?: React.ReactNode;\n}\n\nexport const useReportItem = (getInitial: () => string): ReportItemState => {\n    const [has, setHas] = React.useState(true);\n    const [text, setText] = React.useState(getInitial);\n    return { has, setHas, text, setText };\n};\n\nexport const ReportItem = (props: Props) => (\n    <div className={s.container}>\n        <div className={s.input}>\n            <div className={s.has}>\n                <Checkbox\n                    value={props.state.has}\n                    setValue={props.state.setHas}\n                    children={props.label}\n                />\n            </div>\n            <div className={s.text}>\n                <Input\n                    value={props.state.text}\n                    setValue={props.state.setText}\n                    disabled={!props.state.has}\n                    placeholder={props.placeholder}\n                />\n            </div>\n        </div>\n        {props.children && (\n            <MutedDiv>\n                <Paragraph>{props.children}</Paragraph>\n            </MutedDiv>\n        )}\n    </div>\n);\n","import {\n    background,\n    Border,\n    borderColor,\n    Button,\n    DivPx,\n    TextArea,\n} from \"@moai/core\";\nimport { EDIT_DIAGRAM_STORAGE_KEY } from \"diagram/state/storage/storage\";\nimport * as React from \"react\";\nimport { globalLogger } from \"utils/external\";\nimport { usePlatform } from \"utils/platform\";\nimport { ReportItem, ReportItemState, useReportItem } from \"./item/item\";\nimport s from \"./report.module.scss\";\n\nexport type ReportType = \"uncaught\" | \"manual\";\n\ninterface Props {\n    type: ReportType;\n    title: string;\n    description: React.ReactNode;\n    footer?: React.ReactNode;\n    error?: string;\n    onDone?: () => void;\n    onClickOutside?: () => void;\n}\n\nconst getDiagram = (): string =>\n    window.localStorage.getItem(EDIT_DIAGRAM_STORAGE_KEY) ?? \"None\";\n\nexport interface ReportBody {\n    title: string;\n    platform: string;\n    // Optional info\n    error?: string;\n    message?: string;\n    contact?: string;\n    // Files\n    diagram?: string;\n    log?: string;\n}\n\nconst getItem = (state: ReportItemState): string | undefined =>\n    state.has ? state.text : undefined;\n\nexport const ErrorReport = (props: Props) => {\n    const isUncaught = props.type === \"uncaught\";\n\n    const message = useReportItem(() => \"\");\n    const contact = useReportItem(() => \"\");\n    const error = useReportItem(() => props.error ?? \"\");\n    const log = useReportItem(() => JSON.stringify(globalLogger));\n    const diagram = useReportItem(() => getDiagram());\n    const platform = usePlatform();\n\n    const [sending, setSending] = React.useState(false);\n\n    const report = async () => {\n        setSending(true);\n        const body: ReportBody = {\n            title: isUncaught ? \"Uncaught error\" : \"Manual report\",\n            platform,\n            // Texts\n            error: getItem(error),\n            message: getItem(message),\n            contact: getItem(contact),\n            // Files\n            diagram: getItem(diagram),\n            log: getItem(log),\n        };\n        await window.fetch(\"https://diagramplus.com/api/report\", {\n            method: \"POST\",\n            body: JSON.stringify(body),\n            headers: { \"Content-type\": \"application/json\" },\n        });\n        window.alert(\"The report has been sent successfully\");\n        setSending(false);\n        props.onDone?.();\n    };\n\n    const body = (\n        <>\n            <h1 className={s.title}>{props.title}</h1>\n            <DivPx size={16} />\n            <Border color=\"weak\" />\n            <DivPx size={16} />\n            {props.description}\n            <TextArea\n                autoFocus\n                rows={3}\n                value={message.text}\n                setValue={message.setText}\n            />\n            <DivPx size={16} />\n            {isUncaught && (\n                <>\n                    <ReportItem label=\"Include error detail\" state={error} />\n                    <DivPx size={8} />\n                </>\n            )}\n            <ReportItem label=\"Include the diagram\" state={diagram} />\n            <DivPx size={8} />\n            <ReportItem label=\"Include application log\" state={log} />\n            <DivPx size={8} />\n            <ReportItem\n                state={contact}\n                label=\"Allow us to contact you at:\"\n                placeholder=\"name@example.com\"\n            />\n            <DivPx size={16} />\n            <Border color=\"weak\" />\n            <DivPx size={16} />\n            <div className={s.footer}>\n                {props.footer}\n                <DivPx size={16} />\n                <Button\n                    disabled={sending}\n                    highlight\n                    onClick={report}\n                    children={sending ? \"Sending report…\" : \"Send Report\"}\n                />\n            </div>\n        </>\n    );\n\n    return (\n        <div className={s.container}>\n            <div className={[s.backdrop, background.secondary].join(\" \")} />\n            <div\n                className={s.main}\n                onClick={(event) => {\n                    if (event.target !== event.currentTarget) return;\n                    props.onClickOutside?.();\n                }}\n            >\n                <div\n                    className={[\n                        s.body,\n                        borderColor.strong,\n                        background.primary,\n                    ].join(\" \")}\n                    children={body}\n                />\n            </div>\n        </div>\n    );\n};\n","import * as React from \"react\";\nimport { ErrorReport } from \"./report/report\";\nimport { useTheme } from \"app/view/theme/theme\";\nimport { Paragraph, DivPx, Button } from \"@moai/core\";\nimport { usePlatform } from \"utils/platform\";\n\ninterface Props {\n    children: React.ReactChild;\n}\n\ninterface State {\n    hasError: boolean;\n    error: any;\n}\n\nconst Description = () => (\n    <>\n        <Paragraph>\n            Please tell us about this problem. We will treat your report as\n            confidential and anonymous.\n        </Paragraph>\n        <DivPx size={8} />\n        <Paragraph>\n            To help us diagnose the problem, please describe what you were doing\n            when this error occured:\n        </Paragraph>\n        <DivPx size={8} />\n    </>\n);\n\nconst Footer = () => {\n    const platform = usePlatform();\n    if (platform !== \"web\") return null;\n    const reload = () => window.location.reload();\n    return <Button onClick={reload} children=\"Reload\" />;\n};\n\nconst ErrorWrapper = (props: { error: any }) => {\n    useTheme();\n    return (\n        <ErrorReport\n            type=\"uncaught\"\n            title=\"There was an unexpected error\"\n            description={<Description />}\n            footer={<Footer />}\n            error={`${props.error}`}\n        />\n    );\n};\n\nexport class ErrorBoundary extends React.Component<Props, State> {\n    constructor(props: Props) {\n        super(props);\n        this.state = { hasError: false, error: null };\n    }\n\n    static getDerivedStateFromError(error: any) {\n        return { hasError: true, error };\n    }\n\n    render() {\n        if (this.state.hasError)\n            return <ErrorWrapper error={this.state.error} />;\n        return this.props.children;\n    }\n}\n","const VERSION = \"6\";\n\n/**\n * Temporary safe lock to avoid compatible issues\n */\nexport const initVersionControl = () => {\n    const prev = window.localStorage.getItem(\"version\");\n    if (prev === VERSION) return;\n    window.localStorage.clear();\n    window.localStorage.setItem(\"version\", VERSION);\n};\n","import { App } from \"app/app/app\";\nimport \"index.scss\";\nimport React from \"react\";\nimport { DndProvider } from \"react-dnd-multi-backend\";\nimport HTML5toTouch from \"react-dnd-multi-backend/dist/esm/HTML5toTouch\";\nimport ReactDOM from \"react-dom\";\nimport { initExternalFns } from \"utils/external\";\nimport { PlatformContext, usePlatformProvider } from \"utils/platform\";\nimport { initVersionControl } from \"utils/version\";\nimport \"@moai/core/dist/font/inter.scss\";\nimport { ErrorBoundary } from \"error/error\";\n\ninitVersionControl();\ninitExternalFns();\n\nconst Root = () => {\n    const platform = usePlatformProvider();\n    return (\n        <React.StrictMode>\n            <PlatformContext.Provider value={platform}>\n                <ErrorBoundary>\n                    <DndProvider options={HTML5toTouch}>\n                        <App />\n                    </DndProvider>\n                </ErrorBoundary>\n            </PlatformContext.Provider>\n        </React.StrictMode>\n    );\n};\n\nReactDOM.render(<Root />, document.getElementById(\"root\"));\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"layer_container__1DSen\",\"svg\":\"layer_svg__1kDpM\",\"line\":\"layer_line__24WBc\",\"icon\":\"layer_icon__1W0JP\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"string_container__6Pyow\",\"view\":\"string_view__1oiV8\",\"weak\":\"string_weak__3HpXd\",\"edit\":\"string_edit__2m0iK\",\"empty\":\"string_empty__3u9-r\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"header_container__1QU6W\",\"main\":\"header_main__1XQwN\",\"edit\":\"header_edit__3vvV8\",\"remove\":\"header_remove__SIzDW\",\"title\":\"header_title__l4mqY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"view_container__2oDm-\",\"body\":\"view_body__1Z1mW\",\"viewport\":\"view_viewport__1l3sB\",\"header\":\"view_header__3f7ol\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"input\":\"item_input__3LNOA\",\"has\":\"item_has__2s9Zu\",\"text\":\"item_text__3PN9Y\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"header_container__2zpDr\",\"slide-in\":\"header_slide-in__TPuT0\",\"field\":\"header_field__nquLg\",\"rightField\":\"header_rightField__3R_Ju\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"source_container__3TgWW\",\"slide-in\":\"source_slide-in__P2Ug9\",\"dragging\":\"source_dragging__1rxAg\",\"button\":\"source_button__2cu3w\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"main_container__24nAp\",\"selected\":\"main_selected__1OzJ8\",\"edit\":\"main_edit__KBdPX\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"drag_container__1_FJJ\",\"box\":\"drag_box__2nmY1\",\"boxBg\":\"drag_boxBg__32YQk\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"header_container__-KQI5\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"app_container__2pv2U\",\"body\":\"app_body__3dFS1\",\"footer\":\"app_footer__1cpy9\"};"],"sourceRoot":""}