(this["webpackJsonp@tableplus/diagram"]=this["webpackJsonp@tableplus/diagram"]||[]).push([[0],{116:function(e,t,n){e.exports={container:"body_container__3oC6s",header:"body_header__jV-GI"}},117:function(e,t,n){e.exports={container:"source_container__3TgWW","slide-in":"source_slide-in__P2Ug9",dragging:"source_dragging__1rxAg",button:"source_button__2cu3w"}},118:function(e,t,n){e.exports={container:"row_container__2yTZp",over:"row_over__2gC30"}},119:function(e,t,n){e.exports={container:"name_container__1o8SY",view:"name_view__15GrF"}},12:function(e,t,n){e.exports={container:"edge_container__1EyW3",from:"edge_from__1Ovs9",to:"edge_to__3E3uJ",path:"edge_path__x4S4v",dot:"edge_dot__2KuhC",selected:"edge_selected__1Gpep",hitarea:"edge_hitarea__3Airq"}},120:function(e,t,n){e.exports={container:"canvas_container__3Y18v",grid:"canvas_grid__nkChd"}},123:function(e,t,n){e.exports={container:"header_container__-KQI5"}},124:function(e,t,n){e.exports={container:"progress_container__1kfqj",body:"progress_body__2EtDz"}},125:function(e,t,n){e.exports={container:"footer_container__3MvUg",logo:"footer_logo__3qLuS"}},195:function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://diagramplus.com/diagram-schema.json","title":"TablePlus Diagram","description":"JSON schema for Diagram by TablePlus (https://diagramplus.com/)","type":"object","definitions":{"column":{"type":"object","properties":{"id":{"type":"string"},"name":{"type":"string"},"type":{"type":"string"}},"additionalProperties":false,"required":["id","type","name"]},"row":{"type":"object","properties":{"id":{"type":"string"}},"additionalProperties":{"type":"string"},"required":["id"]},"ref-side":{"type":"object","properties":{"name":{"type":"string"},"schema":{"type":"string"},"rows":{"type":"array","items":{"type":"string"}}},"additionalProperties":false,"required":["name","rows"]},"ref":{"type":"object","properties":{"from":{"$ref":"#/definitions/ref-side"},"to":{"$ref":"#/definitions/ref-side"}},"additionalProperties":false,"required":["from","to"]},"item":{"type":"object","properties":{"id":{"type":"string"},"name":{"type":"string"},"schema":{"type":"string"},"rows":{"type":"array","items":{"$ref":"#/definitions/row"}}},"additionalProperties":false,"required":["id","name","rows"]}},"properties":{"columns":{"type":"array","items":{"$ref":"#/definitions/column"}},"schema":{"type":"string"},"items":{"type":"array","items":{"$ref":"#/definitions/item"}},"refs":{"type":"array","items":{"$ref":"#/definitions/ref"}},"$schema":{"type":"string"}},"additionalProperties":false,"required":["schema","columns","items","refs"]}')},198:function(e,t,n){e.exports={container:"active_container__3joLV","react-draggable-dragging":"active_react-draggable-dragging__1JdPr"}},200:function(e,t,n){e.exports={container:"add_container__2lSlZ","slide-in":"add_slide-in__2Hk9K"}},201:function(e,t,n){e.exports={container:"boolean_container__1bqLB"}},202:function(e,t,n){e.exports={right:"field_right__3YAJ4"}},203:function(e,t,n){e.exports={container:"remove_container__Ts2Bx","slide-in":"remove_slide-in__3caLT"}},204:function(e,t,n){e.exports={container:"remove_container__2HEZR","win-background":"remove_win-background__WJQ6a"}},205:function(e,t,n){e.exports={container:"inactive_container__2xyR0"}},206:function(e,t,n){e.exports={container:"edges_container__2FGMc"}},208:function(e,t,n){e.exports={container:"layout_container__SVyb1"}},209:function(e,t,n){e.exports={container:"mac_container__YDixB",weak:"mac_weak__3A9TF"}},219:function(e,t,n){e.exports=n(445)},442:function(e,t,n){},444:function(e,t,n){},445:function(e,t,n){"use strict";n.r(t),n.d(t,"storage",(function(){return jr}));var a=n(51),r=n(7),i={},o=[],c=function(e){var t=null,n=[];i[e]=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];if(null!==t)return o.push(["Execute",a]),t.apply(void 0,a);o.push(["Pending",a]),n.push(a)};return function(e){for(t=e;n.length>0;){var a=n.shift();o.push(["Execute pending item",a]),t.apply(void 0,Object(r.a)(a))}}};window.Diagram=i,window.Logger=o;var s,l,u,d=n(1),f=n(4),m=n(192),p=n(0),v=n.n(p),h=n(449),g=n(5),b=n(52),w=n.n(b),E=function(e){if(!e.isDragging())return null;if("row"!==e.getItemType())return null;var t=e.getClientOffset(),n=e.getItem();return null===n||null===t?null:{item:n,top:t.y,left:t.x}},y=v.a.memo((function(e){var t=e.top,n=e.left;return v.a.createElement("div",{style:{color:"var(--accent-2)"}},v.a.createElement("div",{className:w.a.icon,style:{top:t-8,left:n-8}},v.a.createElement(d.h,{path:g.a.locate,size:16})))})),_=v.a.memo((function(e){var t=Object(h.a)(E),n=v.a.useRef(null),a=null===t||void 0===t?void 0:t.item.elementRef,r=e.viewportRef;v.a.useEffect((function(){n.current=void 0===a?null:function(e,t){var n=e.current;if(null===n)throw Error("Viewport is not defined");var a=t.current;if(null===a)throw Error("Source drag is not defined");var r=a.getBoundingClientRect(),i=[r.top+r.height/2,r.left+r.width/2];return{top:i[0],left:i[1],scrollTop:n.scrollTop,scrollLeft:n.scrollLeft}}(r,a)}),[r,a]);var i=n.current;if(null===t||null===i)return null;var o=e.viewportRef.current;if(null===o)throw Error("viewport is not defined");var c=o.scrollLeft-i.scrollLeft,s=o.scrollTop-i.scrollTop;return v.a.createElement("div",{className:w.a.container},v.a.createElement("svg",{className:w.a.svg},v.a.createElement("line",{className:w.a.line,x1:i.left-c,y1:i.top-s,x2:t.left,y2:t.top})),v.a.createElement(y,{top:t.top,left:t.left}))})),x=function(e,t){var n=e.get(t.table);if(!n)throw Error('Table Ids "'.concat(t.table,'" not found'));var a=t.rows.map((function(e){var t=n.rows.get(e);if(!t)throw Error('Row id "'.concat(e,'" not found'));return t})),r=n.table;return{name:r.name,schema:r.schema,rows:a}},j=function(e){var t=e.columns.map((function(e){return e.value})),n=e.tables.map((function(e){var t=e.value.rows.map((function(e){return e.value})),n=e.value;return{id:n.id,name:n.name,schema:n.schema,rows:t}})),a=function(e){var t=new Map;return e.forEach((function(e){var n=new Map;e.value.rows.forEach((function(e){n.set(e.id,e.value.id)}));var a={name:e.value.name,schema:e.value.schema};t.set(e.id,{table:a,rows:n})})),t}(e.tables);return{columns:t,items:n,refs:e.refs.map((function(e){return{from:x(a,e.from),to:x(a,e.to)}})),schema:e.schema}},I=c("importDiagram"),S=function(e,t){v.a.useEffect((function(){I((function(e){t({type:"parse-json",payload:{text:e,isAppend:!1}})}))}),[t]),v.a.useEffect((function(){var t;t=function(){return JSON.stringify(j(e))},i["exportDiagram"]=t}),[e])},O=n(2),z=function(e){return"table . ".concat(e)},T=function(e){var t=document.getElementById(z(e));if(t instanceof HTMLDivElement)return t;throw Error("Element is not HTMLDivElement")},D=function(e,t){return{width:224,height:24*(t?e.value.rows.length:Math.min(e.value.rows.length,51))+64}},M=n(114),k=n.n(M),R=function(e){return 8*Math.round(e/8)},L=function(e){var t,n,a,r=new k.a.graphlib.Graph({multigraph:!0});return r.setGraph({rankdir:"LR",nodesep:96,ranksep:96,marginx:48,marginy:48}),r.setDefaultEdgeLabel((function(){return{}})),e.tables.forEach((function(e){var t=function(e){try{var t=T(e.id);if(t.dataset.name!==e.value.name)throw Error("Outdated table from previous diagram");return{width:t.clientWidth,height:t.clientHeight}}catch(n){return D(e)}}(e),n=t.width,a=t.height;r.setNode(e.id.toString(),{label:"",width:n,height:a})})),e.refs.forEach((function(e){r.setEdge(e.from.table.toString(),e.to.table.toString())})),k.a.layout(r),{tables:e.tables.map((function(e){var t=r.node(e.id.toString()),n={top:0,left:0};return n.top=R(t.y-t.height/2),n.left=R(t.x-t.width/2),Object(O.a)(Object(O.a)({},e),{},{position:n})})),refs:e.refs,size:{width:(a=null!==(t=r.graph().width)&&void 0!==t?t:-1,320*Math.ceil(a/320)),height:R(null!==(n=r.graph().height)&&void 0!==n?n:-1)}}},N=function(e){return e.height*e.width},A=function(e){var t=e.map((function(e){return{id:e.tables[0].id,width:e.size.width,height:e.size.height}})),n=function(e){var t=e.reduce((function(e,t){return e>t.width?e:t.width}),-1/0),n=e.reduce((function(e,t){return e+N(t)}),0),a=2*Math.sqrt(n/2),r=Math.max(a,t);return Math.ceil(r/320)}(t),a=Array(n).fill(0),r=new Map,i=function(e){return a.map((function(t,n){return{leftIndex:n,top:function(e,t){if(e+t>a.length)return 1/0;for(var n=-1/0,r=0;r<t;r++){var i=a[e+r];n=Math.max(i,n)}return n}(n,e)}})).reduce((function(e,t){return t.top<e.top?t:e}))};return t.sort((function(e,t){return N(t)-N(e)})).forEach((function(e){for(var t=e.width/320,n=i(t),o=n.top+e.height,c=0;c<t;c++)a[n.leftIndex+c]=o;r.set(e.id,{left:320*n.leftIndex,top:n.top})})),r},V=function(e){var t,n,a=e.diagrams,r=e.masonry,i=0,o=0;a.forEach((function(e){var t=r.get(e.tables[0].id);if(void 0===t)throw Error("position is undefined");var n=t.left+e.size.width;i=Math.max(i,n);var a=t.top+e.size.height;o=Math.max(o,a)}));var c=[i+96,o+96];i=c[0],o=c[1];var s=null!==(t=null===(n=document.getElementById("canvas"))||void 0===n?void 0:n.parentElement)&&void 0!==t?t:null;return null!==s&&(i=Math.max(s.clientWidth,i),o=Math.max(s.clientHeight,o)),{width:i,height:o}},F=function(e){var t=[];if(e.diagrams.forEach((function(n){var a=e.masonry.get(n.tables[0].id);if(void 0===a)throw Error("translate is undefined");n.tables.forEach((function(e){var n={top:a.top+e.position.top+48,left:a.left+e.position.left+48};t.push(Object(O.a)(Object(O.a)({},e),{},{position:n}))}))})),t.length===e.originalDiagram.tables.length)return t;throw Error("new tables and old tables have different length")},P=function(e){var t=[],n=new Map,a=new Map;e.tables.forEach((function(e){a.set(e.id,e)}));var r=new Map;return e.refs.forEach((function(e){var t,n,a=[e.from.table,e.to.table],i=a[0],o=a[1];r.set(i,(null!==(t=r.get(i))&&void 0!==t?t:[]).concat(e)),r.set(o,(null!==(n=r.get(o))&&void 0!==n?n:[]).concat(e))})),e.tables.forEach((function(e){if(!0!==n.get(e.id)){var i={tables:[],refs:[],size:{width:0,height:0}};!function e(t,n){var a,r,i=t.diagram,o=t.done,c=t.refMap,s=t.tableMap;!0!==o.get(n.id)&&(i.tables.push(n),null===(a=c.get(n.id))||void 0===a||a.forEach((function(e){i.refs.includes(e)||i.refs.push(e)})),o.set(n.id,!0),(null!==(r=c.get(n.id))&&void 0!==r?r:[]).forEach((function(n){var a=s.get(n.from.table),r=s.get(n.to.table);if(void 0===a||void 0===r)throw Error('"fromTable" or "toTable" is undefined');e(t,a),e(t,r)})))}({diagram:i,done:n,tableMap:a,refMap:r},e),t.push(i)}})),t.forEach((function(e){L(e)})),t},q=function(e){var t=P(e);t=t.map(L);var n,a=A(t);return{columns:(n={originalDiagram:e,masonry:a,diagrams:t}).originalDiagram.columns,tables:F(n),refs:n.originalDiagram.refs,size:V(n),schema:n.originalDiagram.schema}},H=function(e,t,n){var a,r=null!==(a=n.schema)&&void 0!==a?a:e,i=t.get("".concat(r," . ").concat(n.name));if(void 0===i)throw Error('Table Ids "'.concat(n.name,'" not found'));var o=n.rows.map((function(e){var t=i.rows.get(e);if(void 0===t)throw Error('Row id "'.concat(e,'" not found'));return t}));return{table:i.table,rows:o}},C=function(e,t){return{value:{rows:e.rows.map((function(e,t){return{id:t,value:e}})),name:e.name,id:e.id,schema:e.schema},position:{top:0,left:0},id:t}},B=function(e,t){return{id:t,value:e}},U=function(e){var t=e.schema,n=e.columns.map(B),a=e.items.map(C),r=function(e,t){var n=new Map;return t.forEach((function(t){var a,r=new Map;t.value.rows.forEach((function(e){r.set(e.value.id,e.id)}));var i=null!==(a=t.value.schema)&&void 0!==a?a:e,o="".concat(i," . ").concat(t.value.name);n.set(o,{table:t.id,rows:r})})),n}(t,a),i=e.refs.map(function(e,t){return function(n,a){return{id:a,from:H(e,t,n.from),to:H(e,t,n.to)}}}(t,r));return q({tables:a,refs:i,columns:n,size:{width:0,height:0},schema:t})},J=n(194),W=n.n(J),K=n(195),G=new W.a({strictDefaults:!0,strictKeywords:!0}),Y=G.compile(K),Q=n(75),Z=n(196),$=n(216),X=n(218),ee=function(e){Object(Z.a)(n,e);var t=Object($.a)(n);function n(e){var a;return Object(Q.a)(this,n),(a=t.call(this,e)).name="SemanticError",a}return n}(Object(X.a)(Error)),te=function(e,t){return new ee("".concat(e," has an invalid reference to ").concat(t))},ne=function(e,t,n){var a=e.items.find((function(n){return n.name===t.name&&function(e,t,n){var a,r;return(null!==(a=t.schema)&&void 0!==a?a:e.schema)===(null!==(r=n.schema)&&void 0!==r?r:e.schema)}(e,t,n)}));if(!a)throw te("Ref #".concat(n),'table "'.concat(t.name,'"'));t.rows.forEach((function(e){if(!a.rows.some((function(t){return t.id===e})))throw te("Ref #".concat(n,".rows"),'row "'.concat(e,'"'))}))},ae=function(e){!function(e){var t=e.items.map((function(e){return e.id}));if(new Set(t).size!==t.length)throw Error("items.ids are not unique")}(e),e.items.forEach((function(e){!function(e){var t=e.rows.map((function(e){return e.id}));if(new Set(t).size!==t.length)throw Error("tables.".concat(e.id,".rows.ids are not unique"))}(e)})),e.refs.forEach((function(t,n){ne(e,t.from,n),ne(e,t.to,n)}))},re=function(e,t){for(var n=new Set(e),a=1,r=t(a);n.has(r);)r=t(a+=1);return r},ie=function(e,t){return re(e,(function(e){return 1===e?t:"".concat(t,"_").concat(e)}))},oe=function(e){return re(e,(function(e){return e}))},ce=function(e){var t=e.map((function(e){return e.value.id}));return{id:oe(e.map((function(e){return e.id}))),value:{id:ie(t,"column")}}},se=function(e,t){var n=function(e,t){return function(t){if(t.id!==e.tableId)return t;var n=ce(t.value.rows),a=t.value.rows.concat(n);return Object(O.a)(Object(O.a)({},t),{},{value:Object(O.a)(Object(O.a)({},t.value),{},{rows:a})})}}(t,e.columns);return Object(O.a)(Object(O.a)({},e),{},{tables:e.tables.map(n)})},le=function(e,t){return Math.max(t.position.left,e)},ue=function(e){return{top:96,left:e.reduce(le,0)+320}},de=function(e,t){var n=Math.max(e.width,t.left+320);return n===e.width?e:Object(O.a)(Object(O.a)({},e),{},{width:n})},fe=function(e,t){try{var n=JSON.parse(t.text);!function(e){if(Y(e))return!0;var t=Y.errors;throw SyntaxError(G.errorsText(t,{dataVar:"diagram"}))}(n),ae(n);var a=U(n);return t.isAppend?function(e,t){if(e.columns.length!==t.columns.length)throw Error("Cannot merge diagrams with different columns");var n=e.tables.map((function(e){return e.id})),a=ue(e.tables);a.top=a.top-96,a.left=a.left-96;var i=Object(r.a)(e.tables);t.tables.forEach((function(e){var t=oe(n);n.push(t);var r={top:e.position.top+a.top,left:e.position.left+a.left};i.push(Object(O.a)(Object(O.a)({},e),{},{id:t,position:r}))}));var o=a.left+t.size.width,c=Object(O.a)(Object(O.a)({},e.size),{},{width:o});return Object(O.a)(Object(O.a)({},e),{},{tables:i,size:c})}(e,a):a}catch(i){return window.alert(function(e){if(!(e instanceof Error))throw e;return["There was an error while parsing your json:\n","".concat(e.name,": ").concat(e.message)].join(" ")}(i)),e}},me=function(e,t){var n=e.refs.filter((function(e){return e.id!==t.id}));return Object(O.a)(Object(O.a)({},e),{},{refs:n})},pe=function(e,t){switch(t.type){case"add-ref":return function(e,t){var n=e.refs.filter((function(e){return!function(e,t){return e.from.table===t.from.table&&e.from.rows.some((function(e){return t.from.rows.includes(e)}))}(e,t)})),a=e.refs.map((function(e){return e.id})),r=Object(O.a)(Object(O.a)({},t),{},{id:oe(a)});return n.push(r),Object(O.a)(Object(O.a)({},e),{},{refs:n})}(e,t.payload);case"remove-ref":return me(e,t.payload);case"remove-multiple-refs":return function(e,t){var n=e;return t.ids.forEach((function(e){n=me(n,{id:e})})),n}(e,t.payload);default:return e}},ve=function(e,t){return t.table===e.tableId&&t.rows.includes(e.rowId)},he=function(e,t){var n=e.tables.map(function(e){return function(t){if(t.id!==e.tableId)return t;var n=t.value.rows.filter((function(t){return t.id!==e.rowId}));return Object(O.a)(Object(O.a)({},t),{},{value:Object(O.a)(Object(O.a)({},t.value),{},{rows:n})})}}(t)),a=e.refs.filter((function(e){return!function(e,t){return ve(e,t.from)||ve(e,t.to)}(t,e)}));return a.length===e.refs.length&&(a=e.refs),Object(O.a)(Object(O.a)({},e),{},{tables:n,refs:a})},ge=function(e){return function(t){if(t.id!==e.tableId)return t;var n=t.value.rows.map(function(e){return function(t){if(t.id!==e.rowId)return t;var n=Object(O.a)({},t.value);return n[e.property]=e.value,Object(O.a)(Object(O.a)({},t),{},{value:n})}}(e));return Object(O.a)(Object(O.a)({},t),{},{value:Object(O.a)(Object(O.a)({},t.value),{},{rows:n})})}},be=function(e,t){if(function(e,t){var n,a=t.tableId,r=t.rowId,i=t.property,o=t.value,c=null===(n=e.tables.find((function(e){return e.id===a})))||void 0===n?void 0:n.value.rows.find((function(e){return e.id===r}));if(!c)throw Error('Row "'.concat(a,".").concat(r,'" not found'));return c.value[i]===o}(e,t))return e;var n=e.tables.map(ge(t));return Object(O.a)(Object(O.a)({},e),{},{tables:n})},we=function(e,t){var n=e.tables.filter((function(e){return e.id!==t.id})),a=e.refs.filter((function(e){return!function(e,t){return t.from.table===e.id||t.to.table===e.id}(t,e)}));return Object(O.a)(Object(O.a)({},e),{},{tables:n,refs:a})},Ee=function(e,t){var n=e.tables.map(function(e){return function(t){return t.id!==e.id?t:Object(O.a)(Object(O.a)({},t),{},{value:Object(O.a)(Object(O.a)({},t.value),{},{name:e.name})})}}(t));return Object(O.a)(Object(O.a)({},e),{},{tables:n})},ye=function(e,t){switch(t.type){case"add-table":return function(e,t){var n,a=e.tables.map((function(e){return e.value.id})),r=ie(a,"table"),i=ce([]),o={id:null!==(n=t.id)&&void 0!==n?n:oe(e.tables.map((function(e){return e.id}))),value:{name:r,id:r,schema:"new",rows:[i]},position:ue(e.tables)};return Object(O.a)(Object(O.a)({},e),{},{tables:e.tables.concat(o),size:de(e.size,o.position)})}(e,t.payload);case"remove-table":return we(e,t.payload);case"remove-multiple-tables":return function(e,t){var n=e;return t.ids.forEach((function(e){n=we(n,{id:e})})),n}(e,t.payload);case"update-table-name":return Ee(e,t.payload);case"set-table-position":return function(e,t){return Object(O.a)(Object(O.a)({},e),{},{tables:e.tables.map((function(e){return e.id!==t.id?e:Object(O.a)(Object(O.a)({},e),{},{position:t.position})}))})}(e,t.payload);default:return e}},_e=["localhost","diagramplus.com"],xe=_e.includes(window.location.hostname)||window.location.hostname.startsWith("192.168.1")?"web":navigator.platform.toLowerCase().includes("mac")?"mac":"web",je=v.a.createContext(xe),Ie=function(){return v.a.useContext(je)},Se=c("setPlatform"),Oe=U({columns:[{id:"0",name:"name",type:"string"},{id:"1",name:"type",type:"string"},{id:"2",name:"nullable",type:"boolean"}],schema:"main",items:[],refs:[]}),ze=U({columns:[{id:"0",name:"name",type:"string"},{id:"1",name:"type",type:"string"},{id:"2",name:"nullable",type:"boolean"}],schema:"primary",items:[{id:"employees",name:"employees",rows:[{id:"emp_no",name:"emp_no",type:"int(11)",nullable:"FALSE"},{id:"birth_date",name:"birth_date",type:"date",nullable:"TRUE"},{id:"first_name",name:"first_name",type:"varchar(14)",nullable:"TRUE"},{id:"last_name",name:"last_name",type:"varchar(16)",nullable:"TRUE"}]},{id:"departments",name:"departments",schema:"secondary",rows:[{id:"dept_no",name:"dept_no",type:"char(4)",nullable:"FALSE"},{id:"dept_name",name:"dept_name",type:"varchar(40)",nullable:"FALSE"}]},{id:"dept_emp",name:"dept_emp",rows:[{id:"dept_no",name:"dept_no",type:"char(4)",nullable:"FALSE"},{id:"emp_no",name:"emp_no",type:"int(11)",nullable:"FALSE"},{id:"from_date",name:"from_date",type:"date",nullable:"TRUE"},{id:"to_date",name:"to_date",type:"date",nullable:"TRUE"}]}],refs:[{from:{name:"dept_emp",schema:"primary",rows:["dept_no"]},to:{name:"departments",schema:"secondary",rows:["dept_no"]}},{from:{name:"dept_emp",rows:["emp_no"]},to:{name:"employees",rows:["emp_no"]}}]}),Te=["There was an error while parsing the locally saved diagram. The app will ","now fallback to a sample diagram.\n\n","Your previous diagram is still available in your localStorage under the ",'key "'.concat("diagram",'-invalid". Please contact us if you need help '),"retrieving it."].join(""),De=function(){var e=v.a.useContext(a.b);if(null===e)throw Error("Storage context not found");var t=Ie();return v.a.useMemo((function(){return"web"===t?{get:function(){return function(e){var t=e.getItem("diagram");if(null===t)return ze;try{return JSON.parse(t)}catch(n){return e.setItem("".concat("diagram","-invalid"),t),window.alert(Te),ze}}(e)},set:function(t){return function(e,t){e.setItem("diagram",JSON.stringify(t))}(e,t)}}:{get:function(){return Oe},set:function(){}}}),[e,t])},Me=function(e){var t=e.history,n=e.dispatch;p.useEffect((function(){var e=function(e){return function(t){if((t.ctrlKey||t.metaKey)&&!(t.target instanceof HTMLInputElement)&&!(t.target instanceof HTMLTextAreaElement))switch(t.key){case"z":if(0===e.history.past.length)return;return e.dispatch({type:"undo"});case"Z":case"y":if(0===e.history.future.length)return;return e.dispatch({type:"redo"})}}}({history:t,dispatch:n});return document.addEventListener("keyup",e),function(){return document.removeEventListener("keyup",e)}}),[t,n])},ke=n(115),Re=(s=function(e,t){var n=e;return n=function(e,t){switch(t.type){case"add-row":return se(e,t.payload);case"remove-row":return he(e,t.payload);case"update-row":return be(e,t.payload);default:return e}}(n=ye(n,t),t),n=function(e,t){switch(t.type){case"set-layout":switch(t.payload.type){case"auto":return q(e);default:return e}default:return e}}(n=function(e,t){switch(t.type){case"parse-json":return fe(e,t.payload);default:return e}}(n=pe(n,t),t),t)},function(e,t){switch(t.type){case"undo":var n=Object(ke.a)(e.past),a=n[0];return{past:n.slice(1),present:a,future:[e.present].concat(Object(r.a)(e.future))};case"redo":var i=Object(ke.a)(e.future),o=i[0],c=i.slice(1);return{past:[e.present].concat(Object(r.a)(e.past)),present:o,future:c};default:var l=s(e.present,t),u=[e.present].concat(Object(r.a)(e.past));return{past:u=u.length<20?u:u.slice(0,20),present:l,future:[]}}}),Le=n(197),Ne=n.n(Le),Ae=n(198),Ve=n.n(Ae),Fe=n(12),Pe=n.n(Fe),qe=function(e){return"edge . ".concat(e)},He=function(e,t,n){return"edge . ".concat(e," . ").concat(t," . ").concat(null!==n&&void 0!==n?n:0)},Ce=function(e,t,n){var a=He(e,t,n),r=document.getElementById(a);if(r instanceof SVGElement)return r;throw Error("Element is not SVGElement")},Be=function(e){return{cx:e.x.toString(),cy:e.y.toString()}},Ue=function(e){return p.createElement(p.Fragment,null,e.points.inners.map((function(t,n){return p.createElement("circle",Object.assign({key:n,id:He(e.edge.id,"from",n),className:Pe.a.from},Be(t),{r:"4"}))})))},Je=function(e,t){return"row . ".concat(e," . ").concat(t)},We=function(e,t){var n=t.top,a=t.left,r=T(e.table);return e.rows.map((function(t){var i=function(e,t){var n=document.getElementById(Je(e,t));return n instanceof HTMLDivElement?n:null}(e.table,t);if(null!==i){var o=function(e,t){var n=0,a=0,r=e;do{var i=[n+r.offsetTop,a+r.offsetLeft];n=i[0],a=i[1];var o=r.offsetParent;if(!(o instanceof HTMLElement))break;r=o}while(r!==t);return{top:n,left:a}}(i,r),c=o.top,s=o.left,l=c+n+i.clientHeight/2,u=s+a;return{top:l,left:u,right:u+i.clientWidth}}return{top:n+r.clientHeight/2,left:a,right:a+r.clientWidth}}))},Ke=n(199),Ge=null!==(l=window.ResizeObserver)&&void 0!==l?l:Ke.a,Ye={attributeFilter:["data-is-visible"]},Qe=function(e){if(0===e.length)return"";if(1===e.length)throw Error("points.length must be 0 or 2+");return["M".concat(e[0].x,",").concat(e[0].y)].concat(Object(r.a)(e.slice(1).map((function(e){return"L".concat(e.x,",").concat(e.y)})))).join(" ")},Ze=function(e){return e.reduce((function(t,n,a){if(0===a)return 0;var r=n.x,i=n.y,o=e[a-1],c=o.x,s=o.y;return t+Math.sqrt(Math.pow(r-c,2)+Math.pow(i-s,2))}),0)},$e=function(e){return function(t){return{x:"left"===e?t.left:t.right,y:t.top}}},Xe=function(e,t){return{x:e[0].x+32*("right"===t?1:-1),y:e[0].y}},et=function(e){var t=e.edgesMids,n=e.edge,a=function(e){var t=[e.from[0],e.to[0]],n=t[0],a=t[1],r="right",i="right";n.right<=a.left-96?(r="right",i="left"):n.left>=a.right+96&&(r="left",i="right");var o=e.from.map($e(r)),c=Xe(o,r),s=e.to.map($e(i));return{from:{inners:o,side:r,outer:c},to:{inners:s,side:i,outer:Xe(s,i)}}}(e.boxes),r=a.from,i=a.to,o=function(e){var t=e.from,n=e.to;if(t.side!==n.side){var a=(t.outer.x+n.outer.x)/2;return[{x:a,y:t.outer.y},{x:a,y:n.outer.y}]}if(t.side===n.side){var r=Math.max(t.outer.x,n.outer.x);return[{x:r,y:t.outer.y},{x:r,y:n.outer.y}]}throw Error("never")}({from:r,to:i});return void 0!==t&&(o=function(e){var t,n=e.edgesMids,a=n.edgesMap,r=n.usedMids,i=e.midPoints[0].x,o=null===(t=a.get(e.edge.id))||void 0===t?void 0:t.mid;if(o===i)return e.midPoints;var c=r;if(void 0!==o&&c.delete(o),c.has(i)){var s=function(e,t){for(var n=t,a=1;e.has(n);)n=t+8*a,a=a>0?-a:1-a;return n}(c,i);return a.set(e.edge.id,{detail:e.edge,mid:s}),c.add(s),e.midPoints.map((function(e){return Object(O.a)(Object(O.a)({},e),{},{x:s})}))}return a.set(e.edge.id,{detail:e.edge,mid:i}),c.add(i),e.midPoints}({edgesMids:t,edge:n,midPoints:o})),{from:r,mid:o,to:i}},tt=function(e){var t,n=function(e){return{from:We(e.edge.from,e.fromTable.position),to:We(e.edge.to,e.toTable.position)}}(e),a=null===(t=e.edgesMids)||void 0===t?void 0:t.current,i=e.edge,o=et({edgesMids:a,edge:i,boxes:n});return{points:o,path:function(e){var t=e.from,n=e.mid,a=e.to,i=[t.inners[0]].concat(Object(r.a)(n),[a.inners[0]]),o=t.inners.slice(1).flatMap((function(e){return[e,t.outer]})),c=a.inners.slice(1).flatMap((function(e){return[e,a.outer]}));return{main:Qe(i),length:Ze(i),from:Qe(o),to:Qe(c)}}(o)}},nt=function(e){var t=e.edge,n=e.fromTable,a=e.toTable,r=e.edgesMids,i=function(e){var t=p.useState({}),n=Object(f.a)(t,2),a=n[0],r=n[1];return p.useLayoutEffect((function(){var t=T(e.from.table),n=T(e.to.table),a=function(){return r({})},i=new Ge(function(e){return function(){e()}}(a));i.observe(t),i.observe(n);var o=new MutationObserver(function(e){return function(t){t.forEach((function(t){"attributes"===t.type&&"data-is-visible"===t.attributeName&&e()}))}}(a));return o.observe(t,Ye),o.observe(n,Ye),function(){o.disconnect(),i.disconnect()}}),[e]),a}(t),o=p.useState(null),c=Object(f.a)(o,2),s=c[0],l=c[1],u=p.useRef(0);return p.useLayoutEffect((function(){return window.clearTimeout(u.current),u.current=window.setTimeout((function(){var e=tt({edge:t,fromTable:n,toTable:a,edgesMids:r});l(e)}),0),function(){return window.clearTimeout(u.current)}}),[t,n,a,r,i]),s},at=function(e,t,n){return"left"===e?"rotate(180, ".concat(t,", ").concat(n,")"):""},rt=function(e,t){var n=t.x,a=t.y;return{transform:at(e,n,a),points:["".concat(n+9,",").concat(a-4),"".concat(n+9,",").concat(a+4),"".concat(n+1,",").concat(a)].join(" ")}},it=function(e){return p.createElement(p.Fragment,null,e.points.inners.map((function(t,n){return p.createElement("polygon",Object.assign({key:n,className:Pe.a.to,id:He(e.edge.id,"to",n)},rt(e.points.side,t)))})))},ot=function(e,t){Object.entries(e).forEach((function(e){var n=Object(f.a)(e,2),a=n[0],r=n[1];t.setAttribute(a,r)}))},ct=function(e){return function(t,n){var a={left:e.table.position.left+n.x,top:e.table.position.top+n.y},r=Object(O.a)(Object(O.a)({},e.table),{},{position:a});e.relatedEdges.forEach(function(e){return function(t){var n=t.edge,a=t.table,r=n.to.table===e.id?[a,e]:[e,a],i=Object(f.a)(r,2),o=i[0],c=i[1],s=tt({edge:n,fromTable:o,toTable:c}),l=s.path,u=s.points;Ce(n.id,"path-main").setAttribute("d",l.main),u.from.inners.forEach((function(e,t){var a=Ce(n.id,"from",t),r=Be(e);ot(r,a)})),u.to.inners.forEach((function(e,t){var a=Ce(n.id,"to",t),r=rt(u.to.side,e);ot(r,a)}));try{Ce(n.id,"highlight").setAttribute("path","")}catch(d){}}}(r))}},st=function(e){return 16*Math.round(e/16)},lt=function(e){return function(t,n){if(0!==n.x||0!==n.y){var a={left:st(e.table.position.left+n.x),top:st(e.table.position.top+n.y)};e.diagramDispatch({type:"set-table-position",payload:{id:e.table.id,position:a}})}}},ut=function(e,t){return e.filter((function(e){return e.type===t})).map((function(e){return e.value}))},dt=function(e){return{tables:new Set(ut(e,"table")),refs:new Set(ut(e,"ref"))}},ft=n(200),mt=n.n(ft),pt=function(e){return function(){var t={tableId:e.tableId};e.diagramDispatch({type:"add-row",payload:t})}},vt=function(e){return v.a.createElement("div",{className:mt.a.container},v.a.createElement(d.c,{onClick:pt(e),icon:g.a.add,size:d.c.size.small,style:d.c.style.flat,isFullWidth:!0},"Add"))},ht=n(116),gt=n.n(ht),bt=function(e,t){return t?e.previousElementSibling:e.nextElementSibling},wt=function(e,t){var n=e.closest(".table-row");if(null===n)throw Error(".table-row is null");for(var a=bt(n,t);null!==a;){if(a.classList.contains("table-row"))return a;a=bt(a,t)}return null},Et=function(e,t){if("first"===t){var n=e.querySelector(".row-control");if(null!==n)return n}else{var a=e.querySelectorAll(".row-control"),r=a["last"===t?a.length-1:t];if(void 0!==r)return r}throw Error(".table-row doesn't have .row-control")},yt=function(e,t){switch(t){case"ArrowRight":case"ArrowLeft":var n="ArrowLeft"===t,a=bt(e,n);if(null!==a&&a.classList.contains("row-control"))return a;var i=wt(e,n);return null===i?null:Et(i,n?"last":"first");case"ArrowUp":case"ArrowDown":var o=wt(e,"ArrowUp"===t);if(null===o)return null;var c=function(e){var t=e.closest(".table-row");if(null===t)throw Error(".table-row is null");var n=t.querySelectorAll(".row-control"),a=Object(r.a)(n).indexOf(e);if(-1!==a)return a;throw Error("curr is not a child of parent")}(e);return Et(o,c)}return null},_t=function(e){var t=e.target;if(t instanceof HTMLElement&&!(t instanceof HTMLInputElement)){var n=t.closest(".row-control");if(null!==n){e.preventDefault();var a=yt(n,e.key);null!==a&&function(e){var t=e.querySelector("select,input,button,[tabindex]");if(t instanceof HTMLElement)return t.focus();throw Error("No focusable element under row-control")}(a)}}},xt=function(e){switch(e.key){case"ArrowUp":case"ArrowRight":case"ArrowDown":case"ArrowLeft":return _t(e)}},jt=n(84),It=n.n(jt),St=[d.q.secondary,d.r.weak,It.a.container,d.u.muted].join(" "),Ot=function(e,t){var n=[It.a.field,1===t?It.a.rightField:""].join(" ");return v.a.createElement("div",{key:e.id,className:n,children:e.value.name})},zt=function(e){return v.a.createElement("div",{className:St},v.a.createElement(d.g,{size:8}),v.a.createElement("div",{className:d.c.size.small.main},v.a.createElement(d.h,{path:g.a.blank,size:d.c.size.small.iconSize})),e.columns.slice(0,e.isExpand?void 0:2).map(Ot),v.a.createElement(d.c,{onClick:function(){return e.setIsExpand((function(e){return!e}))},style:d.c.style.flat,size:d.c.size.small,icon:(t=e.isExpand,t?g.a.doubleChevronLeft:g.a.doubleChevronRight)}),v.a.createElement(d.g,{size:8}));var t},Tt=n(451),Dt=n(452),Mt=n(190),kt=n(117),Rt=n.n(kt),Lt=function(e){var t=v.a.useRef(null),n=e.rowId,a=e.tableId,r=Object(Dt.a)({item:{type:"row",rowId:n,tableId:a,elementRef:t},begin:function(){return function(e){if(null!==e.edge){var t={id:e.edge.id};e.diagramDispatch({type:"remove-ref",payload:t})}}(e)},end:function(t,n){return function(e,t){var n=t.getDropResult();if(null!==n){var a={from:{table:e.tableId,rows:[e.rowId]},to:{table:n.tableId,rows:[n.rowId]}};e.diagramDispatch({type:"add-ref",payload:a})}}(e,n)},collect:function(t){return function(e,t){if(!1===t.isDragging())return!1;if("row"!==t.getItemType())return!1;var n=t.getItem(),a=n.tableId,r=n.rowId;return e.tableId===a&&e.rowId===r}(e,t)}}),i=Object(f.a)(r,3),o=i[0],c=i[1],s=i[2];v.a.useEffect((function(){s(Object(Mt.a)())}),[s]),v.a.useEffect((function(){c(t)}),[c]);var l=v.a.useState(!1),u=Object(f.a)(l,2),m=u[0],p=u[1],h=o||m||null!==e.edge,b=v.a.createElement(d.h,{path:h?g.a.selection:g.a.circle,size:d.c.size.small.iconSize});return v.a.createElement("div",{ref:t,className:Rt.a.container,onMouseEnter:function(){return p(!0)},onMouseLeave:function(){return p(!1)}},v.a.createElement("div",{className:[o?Rt.a.dragging:"",d.c.style.flat.main,d.c.size.small.main,"react-draggable-cancel"].join(" "),children:b}))},Nt=n(201),At=n.n(Nt),Vt=["T","t","1","Y","y"],Ft=function(e){return p.createElement("div",{className:[At.a.container].join(" ")},p.createElement(d.n,{value:(t=e.value,!!Vt.includes(t.charAt(0))),setValue:function(t){e.setValue(t?"TRUE":"FALSE")},options:[{value:!0,label:"TRUE"},{value:!1,label:"FALSE"}],style:d.n.style.flat,size:d.n.size.small}));var t},Pt=n(202),qt=n.n(Pt),Ht={current:!1,timeout:0},Ct=n(53),Bt=n.n(Ct),Ut=function(e){return p.createElement("div",{className:Bt.a.edit},p.createElement(d.i,{key:e.value,defaultValue:e.value,style:d.i.style.flat,size:d.i.size.small,autoFocus:!0,onBlur:function(t){e.setValue(t.currentTarget.value),e.setIsEdit(!1)},onKeyDown:function(e){"Tab"===e.key&&(window.clearTimeout(Ht.timeout),Ht.current=!0,Ht.timeout=window.setTimeout((function(){Ht.current=!1}),500))},onKeyUp:function(t){"Enter"===t.key&&(e.setValue(t.currentTarget.value),e.setIsEdit(!1),function(e){window.setTimeout((function(){var t=e.viewRef.current;if(null===t)throw Error("View is null");t.focus()}),0)}(e))}}))},Jt=[Bt.a.view,d.s.always,d.i.size.small.main,"react-draggable-cancel","row-input-string-view"].join(" "),Wt=function(e){var t=e.value;return 0!==t.length?p.createElement("span",null,t):p.createElement("span",{className:Bt.a.empty},"<empty>")},Kt=function(e){return p.createElement("div",{tabIndex:0,children:p.createElement(Wt,{value:e.value}),className:Jt,onDoubleClick:function(){e.setIsEdit(!0)},onFocus:function(){Ht.current&&e.setIsEdit(!0)},onKeyUp:function(t){"Enter"===t.key&&e.setIsEdit(!0)},ref:e.viewRef})},Gt=function(e){var t=p.useState(!1),n=Object(f.a)(t,2),a=n[0],r=n[1],i=p.useRef(null),o=Object(O.a)(Object(O.a)({},e),{},{isEdit:a,setIsEdit:r,viewRef:i});return p.createElement("div",{className:[Bt.a.container].join(" ")},a?p.createElement(Ut,o):p.createElement(Kt,o))},Yt=function(e){return function(t){var n=e.tableId,a=e.row,r=[e.column.value.name,a.id],i=r[0],o=r[1];if(t!==a.value[i]){var c={tableId:n,rowId:o,property:i,value:t};e.diagramDispatch({type:"update-row",payload:c})}}},Qt=function(e){var t;return v.a.createElement("div",{className:e.isRight?"".concat(qt.a.right," ").concat(d.u.muted):""},function(e){var t=e.column.value.type;switch(t){case"boolean":return Ft;case"string":return Gt;default:throw Error('Unknown column type "'.concat(t,'"'))}}(e)({value:null!==(t=e.row.value[e.column.value.name])&&void 0!==t?t:"",setValue:Yt(e)}))},Zt=function(e){var t={tableId:e.tableId,rowId:e.rowId};e.diagramDispatch({type:"remove-row",payload:t})},$t=n(203),Xt=n.n($t),en=function(e){return function(){var t={tableId:e.tableId,rowId:e.row.id};e.diagramDispatch({type:"remove-row",payload:t})}},tn=function(e){return v.a.createElement("div",{className:[Xt.a.container].join(" ")},v.a.createElement(d.c,{onClick:en(e),style:d.c.style.flat,size:d.c.size.small,icon:g.a.remove}))},nn=n(118),an=n.n(nn),rn=v.a.memo((function(e){e.tableId,e.row.id,e.row.value.id;var t,n=(t={tableId:e.tableId,rowId:e.row.id},Object(Tt.a)({accept:"row",drop:function(){return{tableId:t.tableId,rowId:t.rowId}},collect:function(e){return e.isOver()}})),a=Object(f.a)(n,2),r=a[0],i=a[1];return v.a.createElement("div",Object.assign({},function(e){var t=v.a.useRef(!1);return{onKeyDown:function(e){["Delete","Backspace"].includes(e.key)&&e.target instanceof HTMLInputElement&&(t.current=""===e.target.value)},onKeyUp:function(n){["Delete","Backspace"].includes(n.key)&&(n.target instanceof HTMLInputElement?t.current&&Zt(e):Zt(e))}}}({diagramDispatch:e.diagramDispatch,tableId:e.tableId,rowId:e.row.id}),{className:"".concat(an.a.container," ").concat(r?an.a.over:""),ref:i}),v.a.createElement(d.g,{size:8}),e.isEdit&&v.a.createElement("div",{className:"row-control"},v.a.createElement(tn,{tableId:e.tableId,row:e.row,diagramDispatch:e.diagramDispatch})),e.columns.slice(0,e.isExpand?void 0:2).map((function(t,n){return v.a.createElement("div",{className:"row-control",key:t.id},v.a.createElement(Qt,{tableId:e.tableId,row:e.row,column:t,diagramDispatch:e.diagramDispatch,isRight:1===n}))})),e.isEdit&&v.a.createElement(Lt,{tableId:e.tableId,rowId:e.row.id,diagramDispatch:e.diagramDispatch,edge:e.edge}),v.a.createElement(d.g,{size:8}))})),on=function(e,t){return function(n){var a;return p.createElement("div",{className:"table-row",id:Je(e.tableId,n.id),key:n.id},p.createElement(rn,{row:n,edge:null!==(a=t.get(n.id))&&void 0!==a?a:null,tableId:e.tableId,isEdit:e.isTableEdit,isExpand:e.isTableExpand,columns:e.columns,diagramDispatch:e.diagramDispatch}))}},cn=function(e){return p.createElement(d.a,{color:"secondary"},p.createElement(d.b,{color:"weak"}),p.createElement("div",{style:{marginTop:-1}}),p.createElement(d.c,{style:d.c.style.flat,size:d.c.size.small,isFullWidth:!0,onClick:function(){return e.show()},children:"".concat(e.count," columns hidden")}),p.createElement("div",{style:{marginTop:-1}}),p.createElement(d.b,{color:"weak"}))},sn=function(e){return p.createElement(d.c,{style:d.c.style.flat,size:d.c.size.small,isFullWidth:!0,onClick:function(){return e.hide()},children:"Hide columns"})},ln=function(e){var t=p.useState(!1),n=Object(f.a)(t,2),a=n[0],r=n[1],i=function(e,t){var n=new Map;return t.forEach((function(t){t.edge.from.table===e&&t.edge.from.rows.forEach((function(e){n.set(e,t.edge)}))})),n}(e.tableId,e.relatedEdges),o=function(e,t){var n=50-t.size,a=[],r=[];return e.forEach((function(e){n>0||t.has(e.id)?(0!==r.length&&a.push(r),r=[],a.push(e),n-=1):r.push(e)})),0!==r.length&&a.push(r),a}(e.rows,i),c=function(e,t,n,a){return function(r,i){return Array.isArray(r)?n?p.createElement(p.Fragment,{key:r[0].id},r.map(on(e,t))):p.createElement(cn,{key:"hidden-".concat(i),count:r.length,show:function(){return a(!0)}}):on(e,t)(r)}}(e,i,a,r),s=o.length!==e.rows.length;return p.useEffect((function(){s&&r(e.isRowsExpand)}),[e.isRowsExpand,s]),p.createElement(p.Fragment,null,o.map(c),a&&p.createElement(sn,{hide:function(){return r(!1)}}))},un=function(e){return function(t){var n=t.relatedTarget;t.currentTarget.contains(n)||t.target instanceof HTMLButtonElement||e.setIsEdit(!0)}},dn=function(e){var t=v.a.useState(!1),n=Object(f.a)(t,2),a=n[0],r=n[1];return v.a.useEffect((function(){e.isEdit||r(!1)}),[e.isEdit]),v.a.createElement("div",{className:gt.a.container,onFocus:un(e)},v.a.createElement(d.g,{size:8}),e.isEdit&&v.a.createElement("div",{className:gt.a.header},v.a.createElement(zt,{columns:e.columns,isExpand:a,setIsExpand:r})),v.a.createElement("div",{onKeyDown:xt},v.a.createElement(ln,{rows:e.table.value.rows,tableId:e.table.id,isTableEdit:e.isEdit,isTableExpand:a,columns:e.columns,isRowsExpand:e.isRowsExpand,relatedEdges:e.relatedEdges,diagramDispatch:e.diagramDispatch})),(e.isEdit||0===e.table.value.rows.length)&&v.a.createElement(vt,{tableId:e.table.id,diagramDispatch:e.diagramDispatch}),v.a.createElement(d.g,{size:8}))},fn=n(54),mn=n.n(fn),pn=n(119),vn=n.n(pn),hn=function(e){var t=v.a.useRef({x:0,y:0}),n=v.a.useState(!1),a=Object(f.a)(n,2),r=a[0],i=a[1];return v.a.createElement("div",{className:vn.a.container,style:{width:208}},r?v.a.createElement(d.i,{key:e.table.value.name,defaultValue:e.table.value.name,onBlur:function(t){!function(e,t){var n=t.currentTarget.value;if(n!==e.table.value.name){var a={id:e.table.id,name:n};e.diagramDispatch({type:"update-table-name",payload:a})}}(e,t),i(!1)},onFocus:function(){e.setIsEdit(!1)},style:d.i.style.flat,size:d.i.size.small,autoFocus:!0}):v.a.createElement("div",{className:[vn.a.view,d.i.size.small.main].join(" "),onMouseDown:function(e){t.current.x=e.clientX,t.current.y=e.clientY},onClick:function(e){var n=t.current,a=n.x,r=n.y,o=e.clientX,c=e.clientY;a===o&&r===c&&i(!0)}},e.table.value.name))},gn=n(204),bn=n.n(gn),wn=function(e){return v.a.createElement("div",{className:[bn.a.container,d.q.primary].join(" ")},v.a.createElement(d.c,{style:d.c.style.flat,onClick:function(){var t={id:e.tableId};e.diagramDispatch({type:"remove-table",payload:t})},icon:g.a.cross,size:d.c.size.small}))},En=function(e){return v.a.createElement("div",{className:"".concat(mn.a.container," ").concat(e.isEdit?mn.a.edit:"")},v.a.createElement("div",{className:mn.a.main},v.a.createElement(hn,{table:e.table,setIsEdit:e.setIsEdit,diagramDispatch:e.diagramDispatch}),v.a.createElement("div",{className:mn.a.remove},v.a.createElement(wn,{tableId:e.table.id,diagramDispatch:e.diagramDispatch}))))},yn=function(e,t){if(!e)return function(e){var n=e.relatedTarget;e.currentTarget.contains(n)||t(!1)}},_n=n(85),xn=n.n(_n),jn=function(e,t){var n=[xn.a.container,d.q.primary,d.r.strong];return e.isSelected&&n.push(xn.a.selected),t&&n.push(xn.a.edit),n.join(" ")},In=function(e){return{type:"ref",value:e.edge.id}},Sn=function(e){return function(){e.setSelectIds((function(t){var n=e.relatedEdges.map(In);return n.push({type:"table",value:e.table.id}),function(e,t){if(e.length!==t.length)return!1;var n=dt(e),a=n.tables,r=n.refs;return t.every((function(e){return!("table"!==e.type||!a.has(e.value))||!("ref"!==e.type||!r.has(e.value))}))}(t,n)?t:n}))}},On=v.a.memo((function(e){e.table.id,e.table.value.id;var t=v.a.useState(!1),n=Object(f.a)(t,2),a=n[0],r=n[1],i=Object(h.a)(function(e){return function(t){var n=t.getItem();return null!==n&&("row"===n.type&&n.tableId===e.table.id)}}(e));return v.a.createElement("div",{className:jn(e,a),onBlur:yn(i,r),tabIndex:0,onFocus:Sn(e)},v.a.createElement(En,{table:e.table,isEdit:a,setIsEdit:r,diagramDispatch:e.diagramDispatch}),v.a.createElement(d.b,{color:"weak"}),v.a.createElement("div",{style:{marginTop:-1}}),v.a.createElement(dn,{table:e.table,isEdit:a,setIsEdit:r,isRowsExpand:e.isRowsExpand,relatedEdges:e.relatedEdges,diagramDispatch:e.diagramDispatch,columns:e.columns}))})),zn=function(e){var t=v.a.useRef(null);return v.a.createElement(Ne.a,{position:{x:0,y:0},onDrag:ct(e),onStop:lt(e),nodeRef:t,scale:e.zoom,cancel:"input, button, select, .react-draggable-cancel"},v.a.createElement("div",{ref:t,className:Ve.a.container},v.a.createElement(On,{table:e.table,isSelected:e.isSelected,setSelectIds:e.setSelectId,isRowsExpand:e.isRowsExpand,columns:e.columns,relatedEdges:e.relatedEdges,diagramDispatch:e.diagramDispatch})))},Tn=n(205),Dn=[n.n(Tn).a.container,d.q.primary,d.r.strong].join(" "),Mn=function(e){return p.createElement("div",{className:Dn,style:D(e.table,e.isRowsExpand)})},kn=v.a.memo((function(e){var t=v.a.useRef(null),n=v.a.useState(!1),a=Object(f.a)(n,2),r=a[0],i=a[1];v.a.useEffect((function(){var n,a=(n=i,function(e){e.forEach((function(e){n(e.isIntersecting)}))}),r=new IntersectionObserver(a,{threshold:0,root:e.viewportRef.current});if(null===t.current)throw Error("ref is null");return r.observe(t.current),function(){return r.disconnect()}}),[e.viewportRef]);var o=r||e.forceVisible;return v.a.createElement("div",{id:z(e.table.id),style:{position:"absolute",top:e.table.position.top,left:e.table.position.left,zIndex:e.isSelected?1:0},ref:t,"data-name":e.table.value.name,"data-is-visible":o},o?v.a.createElement(zn,{table:e.table,columns:e.columns,diagramDispatch:e.diagramDispatch,relatedEdges:e.relatedEdges,isRowsExpand:e.isRowsExpand,isSelected:e.isSelected,setSelectId:e.setSelectId,zoom:e.zoom}):v.a.createElement(Mn,{isRowsExpand:e.isRowsExpand,table:e.table}))})),Rn=function(e,t){var n=e.current;if(null===n)throw Error("start is null");var a={left:t.nativeEvent.offsetX,top:t.nativeEvent.offsetY},r=Math.min(n.top,a.top),i=Math.max(n.left,a.left),o=Math.max(n.top,a.top),c=Math.min(n.left,a.left);return{top:r,left:c,width:i-c,height:o-r}},Ln=function(e,t){e.style.opacity=t},Nn={top:0,left:0,width:0,height:0},An=function(e,t){e.style.width="".concat(t.width,"px"),e.style.height="".concat(t.height,"px"),e.style.transform="translate(".concat(t.left,"px, ").concat(t.top,"px)")},Vn=function(e,t){var n=e.current;if(null===n)throw Error("boxRef is null");"start"===t?(An(n,Nn),Ln(n,"1")):"stop"===t?Ln(n,"0"):An(n,t)},Fn=n(86),Pn=n.n(Fn),qn=function(e){if("true"!==e.element.dataset.isVisible)return!1;var t,n,a=e.element,r=a.clientWidth,i=a.clientHeight,o=e.position,c={width:r,height:i,top:o.top,left:o.left};return t=e.target,n=c,!(t.left>n.left+n.width)&&!(n.left>t.left+t.width)&&!(t.top>n.top+n.height)&&!(n.top>t.top+t.height)},Hn=function(e,t){return e.map((function(e){return{type:t,value:e}}))},Cn=function(e,t){var n=function(e,t){return e.diagram.tables.filter((function(e){return qn({target:t,position:e.position,element:T(e.id)})})).map((function(e){return e.id}))}(e,t),a=function(e,t){var n=new Set(t);return e.diagram.refs.filter((function(e){return n.has(e.from.table)||n.has(e.to.table)})).map((function(e){return e.id}))}(e,n);return[].concat(Object(r.a)(Hn(n,"table")),Object(r.a)(Hn(a,"ref")))},Bn=function(e,t){t?e.classList.add("temp-selected"):e.classList.remove("temp-selected")},Un=function(e,t){var n=new Set;t.tables.forEach((function(t){var a=T(t.id),r=t.position,i=qn({target:e,element:a,position:r});i&&n.add(t.id),Bn(a,i)})),t.refs.forEach((function(e){var t=n.has(e.from.table)||n.has(e.to.table),a=function(e){var t=document.getElementById(qe(e));if(t instanceof SVGGElement)return t;throw Error("Element is not SVGGElement")}(e.id);Bn(a,t)}))},Jn=function(e,t){var n=e.current;if(null===n)throw Error("containerRef is null");n.style.zIndex=t?"2":"0"},Wn=[],Kn=v.a.memo((function(e){var t=v.a.useRef(null),n=v.a.useRef(!1),a=v.a.useRef(null),r=v.a.useRef(null),i=v.a.useRef(!1);return v.a.createElement("div",{className:Pn.a.container,tabIndex:0,onKeyDown:function(e){" "===e.key&&(i.current=!0)},onKeyUp:function(e){" "===e.key&&(i.current=!1)},onMouseDown:function(o){if(!0!==i.current){var c=o.nativeEvent,s=c.offsetX,l=c.offsetY;t.current={left:s,top:l},n.current=!0,Jn(r,!0),Vn(a,"start"),e.setSelectIds(Wn)}},onMouseMove:function(r){if(!1!==n.current){var i=Rn(t,r);Vn(a,i),Un(i,e.diagram)}},onMouseUp:function(i){if(!1!==n.current){n.current=!1,document.querySelectorAll(".".concat("temp-selected")).forEach((function(e){e.classList.remove("temp-selected")})),Jn(r,!1),Vn(a,"stop");var o=Rn(t,i),c=Cn({diagram:e.diagram},o);e.setSelectIds(c),t.current=null}},ref:r},v.a.createElement("div",{ref:a,className:Pn.a.box},v.a.createElement("div",{className:Pn.a.boxBg})))})),Gn=n(120),Yn=n.n(Gn),Qn=function(e){return function(){e.setSelectIds([{type:"ref",value:e.refId}])}},Zn=function(e){return p.createElement("circle",{className:Pe.a.dot,r:"4"},p.createElement("animateMotion",{dur:"".concat(e.path.length/150,"s"),repeatCount:"indefinite",id:He(e.edge.id,"highlight"),path:e.path.main}))},$n=function(e){var t=[Pe.a.container];return e.isSelected&&t.push(Pe.a.selected),t.join(" ")},Xn=v.a.memo((function(e){e.edge.from.rows,e.edge.to.rows;var t=e.edge,n=e.fromTable,a=e.toTable,r=e.edgesMids,i=nt({edge:t,fromTable:n,toTable:a,edgesMids:r});if(null===i)return null;var o=i.path,c=i.points;return v.a.createElement("g",{id:qe(e.edge.id),className:$n(e)},v.a.createElement("path",{id:He(t.id,"path-main"),className:Pe.a.path,d:o.main}),v.a.createElement("path",{className:Pe.a.path,d:o.from}),v.a.createElement("path",{className:Pe.a.path,d:o.to}),v.a.createElement(Ue,{edge:e.edge,points:c.from}),v.a.createElement(it,{edge:e.edge,points:c.to}),e.isSelected&&v.a.createElement(Zn,{edge:e.edge,path:o}),v.a.createElement("path",{className:Pe.a.hitarea,d:o.main,onClick:Qn({refId:e.edge.id,setSelectIds:e.setSelectIds})}))})),ea=n(206),ta=n.n(ea),na=function(e){var t=function(t){var n=e.tablesMap.get(t.table);if(void 0!==n)return n;throw Error("Table is undefined")},n=function(e){var t=p.useRef({edgesMap:new Map,usedMids:new Set});return p.useEffect((function(){var n=new Set(e.edges.map((function(e){return e.id})));t.current.edgesMap.forEach((function(e,a){n.has(a)||(t.current.usedMids.delete(e.mid),t.current.edgesMap.delete(a))}))}),[e.edges]),t}({edges:e.diagram.refs});return p.createElement("svg",{className:ta.a.container,width:e.diagram.size.width,height:e.diagram.size.height},e.diagram.refs.map((function(a){return p.createElement(Xn,{key:a.id,edge:a,isSelected:e.selectedRefs.has(a.id),setSelectIds:e.setSelectIds,fromTable:t(a.from),toTable:t(a.to),edgesMids:n,diagramDispatch:e.diagramDispatch})})))},aa=function(e,t){var n=[e,e.diagram.size],a=n[0].zoom,r=n[1],i=r.width,o=r.height,c=(a-1)/2,s="".concat(o*c,"px ").concat(i*c,"px");return{width:i,height:o,transform:1!==a?"scale(".concat(a,")"):"",margin:s,fontSize:"web"===t?void 0:12}},ra=function(e,t){return e.set(t.id,t),e},ia=[],oa=function(e){var t=e.diagram,n=t.refs,a=t.tables,r=v.a.useMemo((function(){return a.reduce(ra,new Map)}),[a]),i=v.a.useMemo((function(){return n.reduce(function(e){return function(t,n){var a,r,i=e.get(n.to.table),o=e.get(n.from.table),c=n.from.table,s=null!==(a=t.get(c))&&void 0!==a?a:[];t.set(c,s.concat({edge:n,table:i}));var l=n.to.table,u=null!==(r=t.get(l))&&void 0!==r?r:[];return t.set(l,u.concat({edge:n,table:o})),t}}(r),new Map)}),[n,r]),o=Ie();return v.a.createElement("div",{id:"canvas",className:[Yn.a.container,d.q.secondary].join(" "),style:aa(e,o)},v.a.createElement("div",{className:Yn.a.grid}),v.a.createElement(Kn,{diagram:e.diagram,setSelectIds:e.setSelectIds}),v.a.createElement(na,{diagram:e.diagram,diagramDispatch:e.diagramDispatch,setSelectIds:e.setSelectIds,selectedRefs:e.selectedRefs,tablesMap:r}),e.diagram.tables.map((function(t){var n;return v.a.createElement(kn,{key:t.id,table:t,isSelected:e.selectedTables.has(t.id),setSelectId:e.setSelectIds,isRowsExpand:e.isRowsExpand,columns:e.diagram.columns,relatedEdges:null!==(n=i.get(t.id))&&void 0!==n?n:ia,diagramDispatch:e.diagramDispatch,viewportRef:e.viewportRef,zoom:e.zoom,forceVisible:e.forceVisible})})))},ca=n(121),sa=n.n(ca),la=(n(442),function(e){return function(t){t.target instanceof HTMLInputElement||" "===t.key&&(t.preventDefault(),e.drag||(e.setDrag(!0),e.element.classList.add("dragscroll"),sa.a.reset(),e.element.addEventListener("keyup",function(e){return function t(){e.setDrag(!1),e.element.classList.remove("dragscroll"),sa.a.reset(),e.element.removeEventListener("keyup",t)}}(e))))}}),ua={behavior:"smooth",block:"center",inline:"center"},da=function(e){return v.a.createElement(d.c,{onClick:function(){var t=oe(e.tables.map((function(e){return e.id})));e.diagramDispatch({type:"add-table",payload:{id:t}}),window.setTimeout((function(){e.setSelectIds([{type:"table",value:t}]),T(t).scrollIntoView(ua)}),0)},size:e.buttonSize,icon:g.a.plus,children:"Table"})},fa=n(13),ma=n.n(fa),pa=n(25),va=n(122),ha=n.n(va),ga={svg:"data:image/svg+xml;charset=utf-8,",png:"data:image/png;base64,"},ba=function(){var e=Object(pa.a)(ma.a.mark((function e(t){return ma.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.format,e.next="png"===e.t0?3:"svg"===e.t0?6:9;break;case 3:return e.next=5,ha.a.toPng(t.canvas);case 5:return e.abrupt("return",e.sent);case 6:return e.next=8,ha.a.toSvg(t.canvas);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),wa=function(){var e=Object(pa.a)(ma.a.mark((function e(t){return ma.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return window.setTimeout((function(){return e()}),t)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ea=function(){var e=Object(pa.a)(ma.a.mark((function e(t){var n,a,r;return ma.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setTableVisible(!0),wa(100),e.next=4,ba(t);case 4:return n=e.sent,t.setTableVisible(!1),a=ga[t.format],r=n.replace(a,""),e.abrupt("return",{prefix:a,body:r});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ya=n(207),_a=["&%23xA;","&%239;"],xa=function(e){if(e.prefix.includes("base64"))return e.body;if(e.prefix.includes("utf-8")){var t=e.body;return _a.forEach((function(e){t=t.replaceAll(e,"")})),Object(ya.a)(t)}throw Error("Unknown file prefix: ".concat(e.prefix))},ja=function(e){switch(e.platform){case"mac":return function(e){var t={data:xa(e.file),ext:e.format,name:"diagram",title:"Save diagram as\u2026"};window.webkit.messageHandlers.saveFile.postMessage(t)}(e);case"web":return function(e){var t=document.createElement("a");t.download="diagram.".concat(e.format),t.href="".concat(e.file.prefix).concat(e.file.body),t.click()}(e)}},Ia=function(){var e=Object(pa.a)(ma.a.mark((function e(t,n,a){var r,i;return ma.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=document.getElementById("canvas"))){e.next=3;break}throw Error("Canvas is null");case 3:return e.next=5,Ea({canvas:r,format:a,setTableVisible:t});case 5:i=e.sent,ja({file:i,format:a,platform:n});case 7:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),Sa=["MySQL","MariaDB","SQLite","PostgreSQL","Cassandra","Snowflake","MicrosoftSQLServer"],Oa=function(e){var t=Ie(),n=[{label:"Save as Image (PNG)",fn:function(){return Ia(e.setTableVisible,t,"png")}},{label:"Save as Web page (SVG)",fn:function(){return Ia(e.setTableVisible,t,"svg")}},{label:"\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500",fn:function(){},disabled:!0}].concat(Object(r.a)(Sa.map((function(n){return{label:"Export to ".concat(n),fn:function(){return function(e,t,n){if("web"===t)return window.alert("Export to SQL requires TablePlus app");var a={data:j(e),driver:n};window.webkit.messageHandlers.exportSQL.postMessage(a)}(e.diagram,t,n)}}}))));return v.a.createElement(d.d,{icon:g.a.share,actions:n,size:e.buttonSize})},za=function(e){return function(t){switch(t){case"undo":return e.dispatch({type:"undo"});case"redo":return e.dispatch({type:"redo"});default:throw Error('Unknown value: "'.concat(t,'"'))}}},Ta={key:"undo",icon:g.a.undo,value:"undo"},Da={key:"redo",icon:g.a.redo,value:"redo"},Ma=function(e){return v.a.createElement(d.p,{value:"",setValue:za(e),options:[Object(O.a)(Object(O.a)({},Ta),{},{disabled:0===e.past.length}),Object(O.a)(Object(O.a)({},Da),{},{disabled:0===e.future.length})],size:e.buttonSize})},ka=n(208),Ra=n.n(ka),La={type:"set-layout",payload:{type:"auto"}},Na=function(e){return[{label:"Expand all columns and Arrange",fn:function(){e.setIsRowsExpand(!0),window.setTimeout((function(){return e.diagramDispatch(La)}),0)}},{label:"Collapse columns and Arrange",fn:function(){e.setIsRowsExpand(!1),window.setTimeout((function(){return e.diagramDispatch(La)}),0)}}]},Aa=function(e){return v.a.createElement("div",{className:Ra.a.container},v.a.createElement(d.c,{icon:g.a.layoutAuto,onClick:function(){e.diagramDispatch(La)},children:"Arrange",size:e.buttonSize}),v.a.createElement(d.d,{actions:Na(e),icon:g.a.caret,size:e.buttonSize}))},Va="https://diagramplus.com/samples",Fa=function(){var e=Object(pa.a)(ma.a.mark((function e(t,n){var a,r,i;return ma.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n).then((function(e){return e.json()}));case 2:a=e.sent,r=JSON.stringify(a),i={text:r,isAppend:!1},t.diagramDispatch({type:"parse-json",payload:i});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Pa=function(e){return p.createElement(d.d,{actions:[{label:"Import from Database (require TablePlus app)",disabled:!0,fn:function(){}},{label:"\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500",fn:function(){},disabled:!0},{label:"Load sample 1 (3 small tables)",fn:function(){return Fa(e,"".concat(Va,"/1.json"))}},{label:"Load sample 2 (Table with many columns)",fn:function(){return Fa(e,"".concat(Va,"/2.json"))}},{label:"Load sample 3 (28 tables)",fn:function(){return Fa(e,"".concat(Va,"/3.json"))}},{label:"Load sample 4 (1710 tables)",fn:function(){return Fa(e,"".concat(Va,"/4.json"))}}]})},qa=function(e,t){var n,a=t.filter((n=e,function(e){return[e.from.table,e.to.table].includes(n)})).map((function(e){return{type:"ref",value:e.id}}));return a.push({type:"table",value:e}),a},Ha={behavior:"smooth",block:"center",inline:"center"},Ca=function(e){var t=e.diagram,n=e.setSelectIds,a=v.a.useMemo((function(){var e=new Set;return t.tables.forEach((function(t){e.add(t.value.name)})),Object(r.a)(e)}),[t.tables]),i=v.a.useState(""),o=Object(f.a)(i,2),c=o[0],s=o[1],l=function(e){!1!==a.includes(e)&&function(e,t,n){var a=e.tables.find((function(e){return e.value.name===n}));if(void 0===a)throw Error("table is undefined");t(qa(a.id,e.refs)),T(a.id).scrollIntoView(Ha)}(t,n,e)};return v.a.createElement("div",{style:{flex:"1 1 0px"}},v.a.createElement(d.i,{icon:g.a.search,placeholder:"Find table\u2026",value:c,setValue:function(e){s(e),l(e)},list:{id:"header-search",values:a},onKeyUp:function(e){"Enter"===e.key&&l(c)},size:e.inputSize}))},Ba=n(123),Ua=n.n(Ba),Ja=n(209),Wa=n.n(Ja),Ka=[{value:"theme-light",icon:g.a.flash,key:"light"},{value:"theme-auto",label:"System",key:"auto"},{value:"theme-dark",icon:g.a.moon,key:"dark"}],Ga=function(e){return v.a.createElement(d.p,{value:e.theme,setValue:e.setTheme,options:Ka,size:e.buttonSize})},Ya=function(e){return function(t){switch(t){case"reset":return e.setZoom(1);case"in":if(e.zoom>=2)return;return e.setZoom(e.zoom+.25);case"out":if(e.zoom<=.25)return;return e.setZoom(e.zoom-.25);default:throw Error('Unknown value: "'.concat(t,'"'))}}},Qa=function(e){return v.a.createElement(d.p,{value:null,setValue:Ya(e),options:[{key:"out",icon:g.a.zoomOut,value:"out"},{label:"".concat(100*e.zoom,"%"),value:"reset"},{key:"in",icon:g.a.zoomIn,value:"in"}],size:e.buttonSize})},Za={web:"",mac:Wa.a.container},$a=v.a.memo((function(e){var t=Ie(),n=function(e){switch(e){case"mac":return[d.c.size.small,d.i.size.small];default:return[d.c.size.medium,d.i.size.medium]}}(t),a=Object(f.a)(n,2),r=a[0],i=a[1],o=function(e){var t="web"===e?v.a.createElement(d.b,{color:"weak"}):null;return v.a.createElement(v.a.Fragment,null,v.a.createElement(d.g,{size:16})," ",t," ",v.a.createElement(d.g,{size:16}))}(t);return v.a.createElement("div",{className:[Ua.a.container,Za[t]].join(" ")},v.a.createElement("div",{className:Ua.a.platformPad}),v.a.createElement(d.g,{size:16}),"web"===t&&v.a.createElement(v.a.Fragment,null,v.a.createElement(Pa,{diagramDispatch:e.diagramDispatch}),o),v.a.createElement(da,{buttonSize:r,tables:e.diagram.tables,diagramDispatch:e.diagramDispatch,setSelectIds:e.setSelectIds}),v.a.createElement(d.g,{size:16}),v.a.createElement(Ma,{buttonSize:r,past:e.diagramPast,future:e.diagramFuture,dispatch:e.diagramDispatch}),o,v.a.createElement(Ca,{inputSize:i,diagram:e.diagram,setSelectIds:e.setSelectIds}),o,v.a.createElement(Aa,{buttonSize:r,setIsRowsExpand:e.setIsRowsExpand,diagramDispatch:e.diagramDispatch}),v.a.createElement(d.g,{size:16}),v.a.createElement(Qa,{buttonSize:r,viewportRef:e.viewportRef,zoom:e.zoom,setZoom:e.setZoom}),v.a.createElement(d.g,{size:16}),v.a.createElement(Oa,{buttonSize:r,diagram:e.diagram,setTableVisible:e.setTableVisible}),"web"===t&&v.a.createElement(v.a.Fragment,null,o,v.a.createElement(Ga,{buttonSize:r,theme:e.theme,setTheme:e.setTheme})),v.a.createElement(d.g,{size:16}))})),Xa=n(124),er=n.n(Xa),tr=c("setProgressIndicator"),nr=function(){var e=v.a.useState(!1),t=Object(f.a)(e,2),n=t[0],a=t[1],r=v.a.useState(void 0),i=Object(f.a)(r,2),o=i[0],c=i[1];return v.a.useEffect((function(){tr((function(e,t){a(e),c(t)}))}),[]),!1===n?null:v.a.createElement("div",{className:[er.a.container,d.q.secondary].join(" ")},v.a.createElement("div",{className:er.a.body},v.a.createElement(d.m,{size:24,value:!0===n?null:n}),void 0!==o&&v.a.createElement(v.a.Fragment,null,v.a.createElement(d.g,{size:16}),v.a.createElement("div",null,o))))},ar=function(e){var t=e.ids,n=e.diagram;p.useEffect((function(){var e=function(e){return function(e,t){var n;if(!(t.target instanceof HTMLInputElement)&&!(t.target instanceof HTMLTextAreaElement)&&0!==e.ids.length){var a=dt(e.ids).tables;if(0!==a.size){var r={columns:e.diagram.columns,tables:e.diagram.tables.filter((function(e){return a.has(e.id)})),refs:e.diagram.refs.filter((function(e){return a.has(e.from.table)&&a.has(e.to.table)})),size:{width:0,height:0},schema:e.diagram.schema},i=j(r),o=JSON.stringify(i);null===(n=t.clipboardData)||void 0===n||n.setData("text/plain",o),t.preventDefault()}}}({ids:t,diagram:n},e)};return document.addEventListener("copy",e),function(){return document.removeEventListener("copy",e)}}),[t,n])},rr=function(e,t){return e.filter((function(e){return e.type===t})).map((function(e){return e.value}))},ir=function(e){var t=e.dispatch;p.useEffect((function(){var e=function(e){return function(e,t){var n,a;if(!(t.target instanceof HTMLInputElement)&&!(t.target instanceof HTMLTextAreaElement)){var r={text:null!==(n=null===(a=t.clipboardData)||void 0===a?void 0:a.getData("text/plain"))&&void 0!==n?n:"",isAppend:!0};e.dispatch({type:"parse-json",payload:r})}}({dispatch:t},e)};return document.addEventListener("paste",e),function(){return document.removeEventListener("paste",e)}}),[t])},or=n(55),cr=n.n(or),sr=function(){var e=function(){var e=De(),t=v.a.useReducer(Re,void 0,(function(){return{past:[],present:e.get(),future:[]}})),n=Object(f.a)(t,2),a=n[0],r=n[1];S(a.present,r),Me({history:a,dispatch:r});var i=e.set;return v.a.useEffect((function(){i(a.present)}),[a.present,i]),{history:a,dispatch:r}}(),t=v.a.useState(1),n=Object(f.a)(t,2),a=n[0],r=n[1],i=v.a.useRef(null),o=function(){var e=p.useState([]),t=Object(f.a)(e,2),n=t[0],a=t[1],r=p.useMemo((function(){return dt(n)}),[n]),i=r.tables,o=r.refs;return{ids:n,setIds:a,tables:i,refs:o}}(),c=Object(m.a)(),s=v.a.useState(!1),l=Object(f.a)(s,2),u=l[0],h=l[1],g=v.a.useState(!1),b=Object(f.a)(g,2),w=b[0],E=b[1];return ar({diagram:e.history.present,ids:o.ids}),ir({dispatch:e.dispatch}),function(e){var t=v.a.useState(!1),n=Object(f.a)(t,2),a=n[0],r=n[1];v.a.useEffect((function(){var t=e.current;if(null!==t){var n={drag:a,setDrag:r,element:t};t.tabIndex=0;var i=la(n);return t.addEventListener("keydown",i),function(){return t.removeEventListener("keydown",i)}}}),[a,e])}(i),v.a.createElement("div",{className:cr.a.container},v.a.createElement("div",{className:cr.a.header},v.a.createElement($a,{diagram:e.history.present,diagramPast:e.history.past,diagramFuture:e.history.future,diagramDispatch:e.dispatch,theme:c.theme,setTheme:c.setTheme,viewportRef:i,zoom:a,setZoom:r,setTableVisible:h,setIsRowsExpand:E,setSelectIds:o.setIds})),v.a.createElement(d.b,{color:"strong"}),v.a.createElement("div",{className:"".concat(cr.a.body," ").concat(d.q.secondary)},v.a.createElement("div",{className:cr.a.viewport,tabIndex:0,ref:i,onKeyUp:function(t){!function(e){var t=e.ids,n=e.event,a=e.diagramDispatch;!1!==["Backspace","Delete"].includes(n.key)&&(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement||(a({type:"remove-multiple-refs",payload:{ids:rr(t,"ref")}}),a({type:"remove-multiple-tables",payload:{ids:rr(t,"table")}}),n.stopPropagation()))}({ids:o.ids,diagramDispatch:e.dispatch,event:t})}},v.a.createElement(oa,{diagram:e.history.present,diagramDispatch:e.dispatch,isRowsExpand:w,zoom:a,viewportRef:i,forceVisible:u,selectedRefs:o.refs,selectedTables:o.tables,setSelectIds:o.setIds})),v.a.createElement(nr,null)),v.a.createElement(_,{viewportRef:i}))},lr=n(87),ur=n.n(lr),dr=n(210),fr=n.n(dr),mr=n(217),pr=n(212),vr=n(125),hr=n.n(vr),gr=function(){return v.a.createElement("a",{className:hr.a.logo,href:"https://tableplus.com",target:"_blank",rel:"noopener noreferrer"},v.a.createElement("img",{alt:"TablePlus logo",src:fr.a,width:"auto",height:32}))},br=function(){return v.a.createElement("div",{className:hr.a.container},v.a.createElement(d.g,{size:16}),v.a.createElement(pr.a,{dataText:"diagram"}),v.a.createElement(d.f,null),v.a.createElement(mr.a,{offlineMode:!1}),v.a.createElement(d.g,{size:16}),v.a.createElement(gr,null),v.a.createElement(d.g,{size:16}))},wr=function(){var e=Ie();return v.a.createElement("div",{className:[ur.a.container,d.t.custom].join(" ")},v.a.createElement("div",{className:ur.a.body},v.a.createElement(sr,null)),"web"===e&&v.a.createElement(v.a.Fragment,null,v.a.createElement(d.b,{color:"strong"}),v.a.createElement("div",{className:ur.a.footer},v.a.createElement(br,null))))},Er=(n(444),n(214)),yr=n(215),_r=n(23),xr=n.n(_r),jr=new a.a("diagram");"5"!==(u=jr).getItem("version")&&(u.clear(),u.setItem("version","5"));var Ir=function(){var e=function(){var e=v.a.useState(xe),t=Object(f.a)(e,2),n=t[0],a=t[1];return v.a.useEffect((function(){Se((function(e){a(e)}))}),[]),n}();return v.a.createElement(v.a.StrictMode,null,v.a.createElement(a.b.Provider,{value:jr},v.a.createElement(Er.a,{options:yr.a},v.a.createElement(je.Provider,{value:e},v.a.createElement(wr,null)))))};xr.a.render(v.a.createElement(Ir,null),document.getElementById("root"))},52:function(e,t,n){e.exports={container:"layer_container__1DSen",svg:"layer_svg__1kDpM",line:"layer_line__24WBc",icon:"layer_icon__1W0JP"}},53:function(e,t,n){e.exports={container:"string_container__6Pyow",view:"string_view__1oiV8",weak:"string_weak__3HpXd",edit:"string_edit__2m0iK",empty:"string_empty__3u9-r"}},54:function(e,t,n){e.exports={container:"header_container__1QU6W",main:"header_main__1XQwN",edit:"header_edit__3vvV8",remove:"header_remove__SIzDW",title:"header_title__l4mqY"}},55:function(e,t,n){e.exports={container:"view_container__2oDm-",body:"view_body__1Z1mW",viewport:"view_viewport__1l3sB",header:"view_header__3f7ol"}},84:function(e,t,n){e.exports={container:"header_container__2zpDr","slide-in":"header_slide-in__TPuT0",field:"header_field__nquLg",rightField:"header_rightField__3R_Ju"}},85:function(e,t,n){e.exports={container:"main_container__24nAp",selected:"main_selected__1OzJ8",edit:"main_edit__KBdPX"}},86:function(e,t,n){e.exports={container:"drag_container__1_FJJ",box:"drag_box__2nmY1",boxBg:"drag_boxBg__32YQk"}},87:function(e,t,n){e.exports={container:"app_container__2pv2U",body:"app_body__3dFS1",footer:"app_footer__1cpy9"}}},[[219,1,2]]]);
//# sourceMappingURL=main.50195283.chunk.js.map